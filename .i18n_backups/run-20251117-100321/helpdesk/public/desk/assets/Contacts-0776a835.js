import{aQ as ee,Z as G,c as I,d as j,A as N,q as _,W as te,Q as x,bi as A,k as P,g as d,w as S,h as n,r as O,e as y,l as f,F as T,G as J,t as ae,v as Q,y as M,f as E,bh as W,bj as le,b2 as oe,I as X,bd as ne,a1 as se,bk as re,aW as ie,a as ue,au as ce,X as de,K as me,O as pe,S as ve}from"./index-70619bb5.js";import{_ as Z}from"./Avatar.vue_vue_type_script_setup_true_lang-e2ccf576.js";import{u as fe}from"./pageMeta-8fdb5c1e.js";import{a as _e}from"./TypingIndicator.vue_vue_type_style_index_0_scoped_3f215bd3_lang-b030ea09.js";import"./dayjs-5868d221.js";import{L as ge}from"./LayoutHeader-330b6449.js";import{P as ye}from"./PhoneIcon-8254e48c.js";import{_ as Ce}from"./ListViewBuilder.vue_vue_type_script_setup_true_lang-8d08270a.js";import{F as he}from"./FileUploader-0ea47db7.js";import{a as be}from"./Link-fff2e6d4.js";import{s as w}from"./dialogState-4a4befac.js";import"./Dropdown-19778bff.js";import"./TabButtons-7d8e5c5a.js";import"./description-7d12a55f.js";import"./DateTimePicker-e0783882.js";import"./useDatePicker-f8eb2ea6.js";import"./DateRangePicker.vue_vue_type_script_setup_true_lang-37cbfe72.js";import"./StarRating.vue_vue_type_script_setup_true_lang-5b0e6a21.js";import"./NestedPopover-1ff912a7.js";import"./portal-399ac095.js";import"./MultipleAvatar.vue_vue_type_script_setup_true_lang-7d84c5a1.js";import"./ticketStatus-b324718d.js";const Ve=ee("contact",()=>{const g=G({doctype:"Contact",fields:["*"],auto:!0,pageLength:99999});return{options:I(()=>{var p;return((p=g.list)==null?void 0:p.data)||[]})}}),ke={class:"space-y-4"},xe={class:"mb-2 block text-sm leading-4 text-gray-700"},Ne={key:0,class:"place-self-center text-red-500"},Ee={class:"flex justify-end space-x-2"},De=j({__name:"NewContactDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","close","contactCreated"],setup(g,{emit:m}){const p=g,v=m,c=Ve(),l=N({emailID:"",firstName:"",lastName:"",phone:"",selectedCustomer:null}),u=N({emailValidationError:"",firstNameValidationError:"",lastNameValidationError:"",phoneValidationError:"",customerValidationError:""}),k=[{label:_("Email Id"),value:"emailID",error:"emailValidationError",type:"input",required:!0,action:()=>R(l.value.emailID)},{label:_("First Name"),value:"firstName",error:"firstNameValidationError",type:"input",required:!0,action:()=>H(l.value.firstName)},{label:_("Last Name"),value:"lastName",error:"lastNameValidationError",type:"input",required:!1},{label:_("Phone"),value:"phone",error:"phoneValidationError",type:"input",required:!1,action:()=>L(l.value.phone)},{label:_("Customer"),value:"selectedCustomer",error:"customerValidationError",type:"autocomplete",required:!1}],i=I({get:()=>p.modelValue,set:o=>{v("update:modelValue",o),o||v("close")}}),r=G({doctype:"HD Customer",fields:["name"],cache:"customers",transform:o=>o.map(e=>({label:e.name,value:e.name})),auto:!0}),a=te({url:"frappe.client.insert",onSuccess:()=>{l.value={emailID:"",firstName:"",lastName:"",phone:"",selectedCustomer:null},x.success("Contact created"),v("contactCreated")}});function D(){if(F())return;let o={doctype:"Contact",first_name:l.value.firstName,last_name:l.value.lastName,email_ids:[{email_id:l.value.emailID,is_primary:!0}],links:[],phone_nos:[]};l.value.phone&&(o.phone_nos=[{phone:l.value.phone}]),l.value.selectedCustomer&&o.links.push({link_doctype:"HD Customer",link_name:l.value.selectedCustomer}),a.submit({doc:o})}function b(o){!o||o.label==="No label"?l.value.selectedCustomer=null:l.value.selectedCustomer=o.value}function F(){let o=R(l.value.emailID);return o+=H(l.value.firstName),o+=L(l.value.phone),o}function R(o){u.value.emailValidationError="";const e=A.string().email().safeParse(o).success;return o?e?U(c.options).includes(o)&&(u.value.emailValidationError="Contact with email already exists"):u.value.emailValidationError="Enter a valid email":u.value.emailValidationError="Email should not be empty",u.value.emailValidationError}function H(o){return u.value.firstNameValidationError="",(!o||o.trim()==="")&&(u.value.firstNameValidationError="First name should not be empty"),u.value.firstNameValidationError}function L(o){return u.value.phoneValidationError="",o&&(!/[0-9]+/.test(o)||o.length<10)&&(u.value.phoneValidationError="Enter a valid phone number"),u.value.phoneValidationError}function U(o){return o.map(e=>e.email_id)}return(o,e)=>{const t=O("Button");return y(),P("div",null,[d(n(X),{modelValue:i.value,"onUpdate:modelValue":e[1]||(e[1]=s=>i.value=s),options:{title:"Create New Contact"}},{"body-content":S(()=>[f("div",ke,[(y(),P(T,null,J(k,s=>f("div",{key:s.label,class:"flex flex-col gap-1"},[f("span",xe,[ae(Q(s.label)+" ",1),s.required?(y(),P("span",Ne," * ")):M("",!0)]),s.type==="input"?(y(),E(n(W),{key:0,modelValue:l.value[s.value],"onUpdate:modelValue":C=>l.value[s.value]=C,type:"text",onBlur:s.action},null,8,["modelValue","onUpdate:modelValue","onBlur"])):(y(),E(n(le),{key:1,modelValue:l.value[s.value],"onUpdate:modelValue":[C=>l.value[s.value]=C,b],options:n(r).data},null,8,["modelValue","onUpdate:modelValue","options"])),d(n(oe),{message:u.value[s.error]},null,8,["message"])])),64)),f("div",Ee,[d(t,{label:n(_)("Create"),loading:n(a).loading,theme:"gray",variant:"solid",onClick:e[0]||(e[0]=s=>D())},null,8,["label","loading"])])])]),_:1},8,["modelValue"])])}}}),$e={__name:"Pill",props:{label:{type:String,default:"Button",require:!0},disabled:{type:Boolean,default:!1}},emits:["click"],setup(g,{emit:m}){const p=m,v=c=>{p("click",c)};return(c,l)=>(y(),E(n(se),{key:g.label,theme:"gray",variant:"outline",label:g.label,disabled:g.disabled},{suffix:S(()=>[d(n(ne),{class:"h-3 w-3",onClick:l[0]||(l[0]=u=>v(g.label))})]),_:1},8,["label","disabled"]))}},we={class:"flex flex-wrap gap-2 rounded-lg bg-gray-100 p-2"},K=j({__name:"MultiSelect",props:{items:{type:Array,required:!0},placeholder:{type:String,required:!1,default:"Type..."},validate:{type:Function,required:!1,default:()=>!1}},emits:["update:items"],setup(g,{emit:m}){const p=g,v=m,{items:c}=re(p),l=N("");function u(i){const r=p.validate(i);if(r){x.error(r);return}const a=[...c.value,i];v("update:items",a),l.value=""}function k(i){const r=c.value.filter(a=>a.value!==i);v("update:items",r)}return(i,r)=>(y(),P("div",we,[(y(!0),P(T,null,J(n(c),a=>(y(),E($e,{key:a.value,label:a.label,onClick:r[0]||(r[0]=D=>k(D))},null,8,["label"]))),128)),d(n(W),{modelValue:l.value,"onUpdate:modelValue":r[1]||(r[1]=a=>l.value=a),class:"w-full",placeholder:g.placeholder,onKeyup:r[2]||(r[2]=ie(a=>u({label:l.value,value:l.value}),["enter"]))},null,8,["modelValue","placeholder"])]))}}),Ie={class:"flex flex-col items-center gap-4 p-6"},Se={class:"text-xl font-medium text-gray-900"},Ue={class:"flex gap-2"},Pe={class:"w-full space-y-2 text-sm text-gray-700"},Be={class:"space-y-1"},qe={class:"space-y-1"},Fe={class:"space-y-1"},Re=j({__name:"ContactDialog",props:{name:{}},emits:["contactUpdated"],setup(g,{emit:m}){const p=g,v=m,c=N(!1),l=I({get(){var t;return(((t=a.doc)==null?void 0:t.email_ids)||[]).map(s=>({label:s.email_id,value:s.email_id}))},set(e){if(e.length===0){x.error("At least one email is required");return}e.length!==a.doc.email_ids.length&&(c.value=!0),a.doc.email_ids=e.map(t=>({email_id:t.value}))}}),u=I({get(){var t;return(((t=a.doc)==null?void 0:t.phone_nos)||[]).map(s=>({label:s.phone,value:s.phone}))},set(e){e.length!==a.doc.phone_nos.length&&(c.value=!0),a.doc.phone_nos=e.map(t=>({phone:t.value}))}}),k=I({get(){var t,s;const e=(s=(t=a.doc)==null?void 0:t.links)==null?void 0:s.find(C=>C.link_doctype==="HD Customer");return(e==null?void 0:e.link_name)||null},set(e){var s,C,$,B,q;const t=($=(C=(s=a.doc)==null?void 0:s.links)==null?void 0:C.find(V=>V.link_doctype==="HD Customer"))==null?void 0:$.link_name;if(e!==t){if(e){const V=(B=a.doc.links)==null?void 0:B.findIndex(h=>h.link_doctype==="HD Customer");V!==-1?a.doc.links[V].link_name=e:a.doc.links.push({link_doctype:"HD Customer",link_name:e})}else a.doc.links=(q=a.doc.links)==null?void 0:q.filter(V=>V.link_doctype!=="HD Customer");c.value=!0}}});G({doctype:"HD Customer",fields:["name"],cache:"customers",transform:e=>e.map(t=>({label:t.name,value:t.name})),auto:!0});const{updateOnboardingStep:i}=_e("helpdesk"),{isManager:r}=ue(),a=ce({doctype:"Contact",name:p.name,auto:!0,setValue:{onSuccess(){v("contactUpdated")}}}),D=I(()=>{var e;return{title:(e=a.doc)==null?void 0:e.name,actions:[{label:_("Save"),theme:"gray",variant:"solid",onClick:()=>b()}]}});function b(){if(!c.value){x.error("No changes to save");return}a.setValue.submit({email_ids:l.value.map(e=>({email_id:e.value,is_primary:e.value===a.doc.email_id})),phone_nos:u.value.map(e=>({phone:e.value,is_primary_phone:e.value===a.doc.phone,is_primary_mobile:e.value===a.doc.phone})),links:a.doc.links}),c.value=!1,v("contactUpdated")}function F(e){a.setValue.submit({image:(e==null?void 0:e.file_url)||null}),c.value=!0}function R(e){if(!A.string().email().safeParse(e.value).success)return"Invalid email"}function H(e){if(!A.string().regex(/^\+[1-9]\d{1,14}$/).min(10).max(15).safeParse(e.value).success)return"Invalid phone number"}function L(e){let t=e.name.split(".").pop().toLowerCase();if(!["png","jpg","jpeg"].includes(t))return x.error("Invalid file type, only PNG and JPG images are allowed"),"Invalid file type, only PNG and JPG images are allowed"}const U=N(!1);async function o(){var e;try{U.value=!0;const t=await de("frappe.contacts.doctype.contact.contact.invite_user",{contact:a.doc.name});x.success("Contact invited successfully"),await a.setValue.submit({user:t}),i("add_invite_contact")}catch(t){U.value=!1;const $=new DOMParser().parseFromString(((e=t.messages)==null?void 0:e[0])||t.message,"text/html").body.innerText;x.error($)}finally{U.value=!1}}return(e,t)=>{const s=O("Button");return y(),E(n(X),{options:D.value},{"body-main":S(()=>{var C,$,B,q,V;return[f("div",Ie,[f("div",Se,Q((C=n(a).doc)==null?void 0:C.full_name),1),d(n(Z),{size:"2xl",label:($=n(a).doc)==null?void 0:$.full_name,image:(B=n(a).doc)==null?void 0:B.image,class:"cursor-pointer hover:opacity-80"},null,8,["label","image"]),f("div",Ue,[d(n(he),{"validate-file":L,onSuccess:t[0]||(t[0]=h=>F(h))},{default:S(({uploading:h,openFileSelector:Y})=>{var z;return[d(s,{label:(z=n(a).doc)!=null&&z.image?"Change photo":"Upload photo",loading:h,onClick:Y},null,8,["label","loading","onClick"])]}),_:1}),(q=n(a).doc)!=null&&q.image?(y(),E(s,{key:0,label:n(_)("Remove photo"),onClick:t[1]||(t[1]=h=>F(null))},null,8,["label"])):M("",!0),!((V=n(a).doc)!=null&&V.user)&&n(r)?(y(),E(s,{key:1,label:n(_)("Invite as user"),onClick:o,loading:U.value},null,8,["label","loading"])):M("",!0)]),f("div",Pe,[f("div",Be,[t[5]||(t[5]=f("div",{class:"text-xs"},"Emails",-1)),d(K,{items:l.value,"onUpdate:items":t[2]||(t[2]=h=>l.value=h),placeholder:n(_)("john.doe@example.com"),validate:R},null,8,["items","placeholder"])]),f("div",qe,[t[6]||(t[6]=f("div",{class:"text-xs"},"Phone Nos",-1)),d(K,{items:u.value,"onUpdate:items":t[3]||(t[3]=h=>u.value=h),placeholder:n(_)("+91 98765 43210"),validate:H},null,8,["items","placeholder"])]),f("div",Fe,[t[7]||(t[7]=f("div",{class:"text-xs"},"Customer",-1)),d(be,{doctype:"HD Customer",class:"form-control flex-1",placeholder:n(_)("Link to a customer"),modelValue:k.value,"onUpdate:modelValue":t[4]||(t[4]=h=>k.value=h),"hide-me":!0},null,8,["placeholder","modelValue"])])])])]}),_:1},8,["options"])}}}),He={class:"flex flex-col"},rt=j({__name:"Contacts",setup(g){const m=N(!1),p=N(null),v=N(null),c=I(()=>({doctype:"Contact",selectable:!0,showSelectBanner:!0,columnConfig:{full_name:{prefix:({row:i})=>me(Z,{shape:"circle",image:i.image,label:i.name,size:"sm"})},mobile_no:{prefix:ye}},emptyState:{title:_("No Contacts Found")}}));function l(){var i;w.value=!1,(i=v.value)==null||i.reload()}function u(i){p.value=i,m.value=!0}function k(){var i;x.success("Contact updated"),m.value=!m.value,(i=v.value)==null||i.reload()}return fe(()=>({title:_("Contacts")})),(i,r)=>{const a=ve,D=O("Button");return y(),P("div",He,[d(n(ge),null,{"left-header":S(()=>[...r[4]||(r[4]=[f("div",{class:"text-lg font-medium text-gray-900"},"Contacts",-1)])]),"right-header":S(()=>[d(D,{label:n(_)("New contact"),theme:"gray",variant:"solid",onClick:r[0]||(r[0]=b=>w.value=!n(w))},{prefix:S(()=>[d(a,{class:"h-4 w-4"})]),_:1},8,["label"])]),_:1}),d(n(Ce),{ref_key:"listViewRef",ref:v,options:c.value,onRowClick:u,onEmptyStateAction:r[1]||(r[1]=b=>w.value=!0)},null,8,["options"]),d(De,{modelValue:n(w),"onUpdate:modelValue":r[2]||(r[2]=b=>pe(w)?w.value=b:null),onContactCreated:l},null,8,["modelValue"]),m.value?(y(),E(Re,{key:p.value,modelValue:m.value,"onUpdate:modelValue":r[3]||(r[3]=b=>m.value=b),name:p.value,onContactUpdated:k},null,8,["modelValue","name"])):M("",!0)])}}});export{rt as default};
//# sourceMappingURL=Contacts-0776a835.js.map
