import{L as ve}from"./mail-3ff2bced.js";import{bc as he,e as a,k as o,l as n,d as oe,q as b,A as S,ak as re,c as f,a4 as ie,g as p,w as $,a9 as z,h as d,ar as ge,bb as _e,z as ye,f as _,y as m,F as w,G as R,aq as xe,ao as ke,am as be,v,a1 as Q,bd as ue,be as ee,x as te,K as J,u as we,s as Se,W as se,N as $e,aW as Ce,t as Te,r as ae,bf as Ve,bg as Oe,b2 as De,an as le}from"./index-70619bb5.js";import{b as Me,q as Le,r as Ie}from"./TypingIndicator.vue_vue_type_style_index_0_scoped_3f215bd3_lang-b030ea09.js";import{_ as Ae}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-345f1ef8.js";import"./dayjs-5868d221.js";import{L as He}from"./LayoutHeader-330b6449.js";import{_ as W}from"./Avatar.vue_vue_type_script_setup_true_lang-e2ccf576.js";import"./Dropdown-19778bff.js";const qe={class:"lucide lucide-message-square",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"};function ze(P,i){return a(),o("svg",qe,[...i[0]||(i[0]=[n("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"},null,-1)])])}const Re=he({name:"lucide-message-square",render:ze}),Fe={class:"relative inline-block text-left"},je={class:"flex"},Ee={class:"flex -space-x-2 isolate"},Ne={class:"text-ink-gray-7"},Be={key:1,class:"text-ink-gray-6"},Ke={key:0,class:"absolute z-50 mt-2 w-64 divide-y divide-outline-gray-modals rounded-lg bg-surface-modal shadow-2xl ring-1 ring-black ring-opacity-5 focus:outline-none left-0 origin-top-left"},Pe={class:"py-1.5 px-1.5"},Ue={class:"flex h-7 items-center text-sm font-medium text-ink-gray-6 justify-between"},Ye=["placeholder"],Ge={class:"px-1.5 pb-1.5 max-h-64 overflow-y-auto"},Je={key:0,class:"pt-1.5"},We=["onClick"],Xe={class:"text-ink-gray-7 flex-1 text-left truncate"},Ze={key:2,class:"text-xs text-ink-gray-5 ml-auto"},Qe={class:"flex h-7 pt-1.5 sticky top-0 bg-surface-white items-center px-2 text-sm font-medium text-ink-gray-6"},et=["onClick"],tt={key:2,class:"mr-2 w-6 h-6 flex-shrink-0"},st={class:"text-ink-gray-7 flex-1 text-left truncate"},at={key:3,class:"text-xs text-ink-gray-5 ml-auto"},lt={key:1,class:"px-2 py-4 text-center text-sm text-ink-gray-5"},K=oe({__name:"SearchMultiSelect",props:{options:{default:()=>[]},modelValue:{},placeholder:{default:b("Select options...")},label:{default:b("Options")},selectionText:{default:"items"}},emits:["update:modelValue"],setup(P,{emit:i}){const r=P,g=i,c=S(!1),x=S(""),y=S(0),O=re("inputRef"),h=f(()=>r.modelValue.length),k=f(()=>r.options.length>0&&"group"in r.options[0]&&"items"in r.options[0]),U=f(()=>k.value?[]:r.options),Y=f(()=>k.value?r.options:[]),F=f(()=>k.value?r.options.flatMap(s=>s.items):r.options),D=f(()=>F.value.filter(s=>r.modelValue.includes(s.value))),M=f(()=>D.value.some(s=>s.image)),j=f(()=>F.value.some(s=>s.image||s.icon)),L=f(()=>{if(!k.value)return[];const s=x.value.toLowerCase();return Y.value.map(e=>({...e,items:e.items.filter(t=>{const l=e.group.toLowerCase().includes(s),V=t.label.toLowerCase().includes(s);return l||V})})).filter(e=>e.items.length>0)}),I=f(()=>U.value.filter(s=>s.label.toLowerCase().includes(x.value.toLowerCase()))),A=f(()=>{const s=I.value,e=L.value.flatMap(t=>t.items);return[...s,...e]}),C=f(()=>A.value[y.value]||null);function T(){c.value=!c.value,c.value&&(y.value=0,xe(()=>{var s;(s=O.value)==null||s.focus()}))}function E(){c.value=!1}function H(s){const e=[...r.modelValue],t=e.indexOf(s.value);t>-1?e.splice(t,1):e.push(s.value),g("update:modelValue",e)}function G(){x.value="",g("update:modelValue",[])}function q(s){c.value&&(s.key==="Escape"?(s.preventDefault(),E()):s.key==="Enter"&&C.value?(s.preventDefault(),s.stopPropagation(),H(C.value)):s.key==="ArrowDown"?(s.preventDefault(),y.value=Math.min(y.value+1,A.value.length-1)):s.key==="ArrowUp"&&(s.preventDefault(),y.value=Math.max(y.value-1,0)))}function N(s){if(!s)return null;const e=typeof s=="string"?J("span",{class:"text-base"},s):J(s,{class:"w-4 h-4"});return J("span",{class:"flex-shrink-0 w-4 h-4 inline-flex items-center justify-center mr-2"},[e])}function B(s){var e;return((e=C.value)==null?void 0:e.value)===s.value}return ie(x,()=>{y.value=0}),(s,e)=>(a(),o("div",Fe,[n("div",je,[p(d(Q),{variant:"outline",class:z({"ring-2 ring-outline-gray-2":c.value}),onClick:T},{suffix:$(()=>[p(d(ke),{class:z(["ml-2 h-4 w-4 transition-transform duration-200",{"rotate-180":c.value}])},null,8,["class"])]),default:$(()=>{var t;return[n("div",{class:z(["flex items-center min-h-[20px]",{"gap-2":M.value&&h.value>0}])},[h.value>0?(a(),o(w,{key:0},[n("div",Ee,[(a(!0),o(w,null,R(D.value.slice(0,3),(l,V)=>(a(),o("div",{key:`avatar-${l.value}`,class:"relative flex",style:be({zIndex:10-V})},[l.image?(a(),_(d(W),{key:0,image:l.image,label:l.label,class:"border-2 border-white flex-shrink-0",size:"sm"},null,8,["image","label"])):m("",!0)],4))),128))]),n("span",Ne,v(h.value===1?(t=D.value[0])==null?void 0:t.label:`${h.value} ${s.selectionText}`),1)],64)):(a(),o("span",Be,v(s.placeholder),1))],2)]}),_:1},8,["class"])]),c.value?(a(),o("div",Ke,[n("div",Pe,[n("div",Ue,[ge(n("input",{ref_key:"inputRef",ref:O,"onUpdate:modelValue":e[0]||(e[0]=t=>x.value=t),placeholder:s.label,class:"px-2 flex-1 bg-transparent border-none outline-none text-sm focus:border-none focus:ring-0 text-ink-gray-6 placeholder-ink-gray-4",onClick:e[1]||(e[1]=ye(()=>{},["stop"])),onKeydown:q},null,40,Ye),[[_e,x.value]]),h.value>0?(a(),_(d(Q),{key:0,variant:"ghost",size:"sm",onClick:G},{icon:$(()=>[p(d(ue),{class:"size-4"})]),_:1})):m("",!0)])]),n("div",Ge,[I.value.length>0?(a(),o("div",Je,[(a(!0),o(w,null,R(I.value,t=>(a(),o("button",{key:`individual-${t.value}`,class:z(["group flex h-7 w-full items-center rounded px-2 text-base hover:bg-surface-gray-3 text-ink-gray-6",{"bg-surface-gray-2":B(t)}]),onClick:l=>H(t)},[p(d(ee),{modelValue:r.modelValue.includes(t.value),class:"mr-2 flex-shrink-0"},null,8,["modelValue"]),t.icon?(a(),_(te(N(t.icon)),{key:0})):j.value?(a(),_(d(W),{key:1,image:t.image,label:t.label,class:"mr-2 flex-shrink-0",size:"sm"},null,8,["image","label"])):m("",!0),n("span",Xe,v(t.label),1),(t.count??0)>0?(a(),o("span",Ze,v(t.count),1)):m("",!0)],10,We))),128))])):m("",!0),(a(!0),o(w,null,R(L.value,t=>(a(),o("div",{key:`group-${t.group}`},[n("div",Qe,v(t.group),1),(a(!0),o(w,null,R(t.items,l=>(a(),o("button",{key:`grouped-${l.value}`,class:z(["group flex h-7 w-full items-center rounded px-2 text-base hover:bg-surface-gray-3 text-ink-gray-6",{"bg-surface-gray-2":B(l)}]),onClick:V=>H(l)},[p(d(ee),{modelValue:r.modelValue.includes(l.value),class:"mr-2 flex-shrink-0"},null,8,["modelValue"]),l.icon?(a(),_(te(N(l.icon)),{key:0})):l.image?(a(),_(d(W),{key:1,image:l.image,label:l.label,class:"mr-2 flex-shrink-0",size:"sm"},null,8,["image","label"])):j.value?(a(),o("div",tt)):m("",!0),n("span",st,v(l.label),1),(l.count??0)>0?(a(),o("span",at,v(l.count),1)):m("",!0)],10,et))),128))]))),128)),A.value.length===0?(a(),o("div",lt," No options found ")):m("",!0)])])):m("",!0),c.value?(a(),o("div",{key:1,class:"fixed inset-0 z-40",onClick:E})):m("",!0)]))}}),nt={class:"mx-auto mt-6 max-w-4xl px-4 sm:px-5"},ot={class:"flex items-center space-x-2 px-2.5"},rt={class:"flex items-center"},it={class:"mt-2 px-2.5"},ut={class:"flex gap-2 items-center"},ct={class:"mt-2 px-2.5 text-sm flex items-center justify-between min-h-6"},dt={key:1,class:"text-ink-gray-6"},mt={key:2,class:"text-ink-gray-6"},ft={key:3,class:"space-y-1"},pt={class:"text-ink-gray-6"},vt={key:0},ht={key:0,class:"text-ink-gray-6"},gt={class:"ml-1 font-medium text-primary"},_t={class:"mt-5"},yt={class:"flex items-start space-x-2"},xt={class:"flex-shrink-0"},kt={class:"w-full"},bt={class:"flex items-center"},wt=["innerHTML"],St={key:1,class:"text-base font-medium"},$t={class:"px-1 leading-none text-sm text-ink-gray-5"},Ct={class:"px-1 leading-none text-sm text-ink-gray-5"},Tt={class:"ml-auto text-sm text-ink-gray-5"},Vt=["innerHTML"],ne="helpdesk_search:",zt=oe({__name:"SearchAgent",setup(P){const i=S(""),r=S(null),g=S(!0),c=S({}),x=re("searchInput"),y=we(),O=Se(),h=se({url:"helpdesk.api.search.search",makeParams(){return{query:i.value,filters:JSON.stringify(c.value),limit:50}},onSuccess(e){r.value=e,g.value=!1,i.value&&B(i.value,e)}}),k=se({url:"helpdesk.api.search.get_filter_options",auto:!0}),U=f(()=>{var t;const e=((t=k.data)==null?void 0:t.teams)||{};return Object.entries(e).map(([l])=>({value:l,label:`${l}`}))}),Y=f(()=>{var t;const e=((t=k.data)==null?void 0:t.statuses)||{};return Object.entries(e).map(([l])=>({value:l,label:`${l}`}))}),F=f(()=>{var t;const e=((t=k.data)==null?void 0:t.priorities)||{};return Object.entries(e).map(([l])=>({value:l,label:`${l}`}))}),D=f(()=>[{value:"HD Ticket",label:b("Tickets"),count:0},{value:"Communication",label:b("Emails"),count:0},{value:"HD Ticket Comment",label:b("Comments"),count:0}]),M=Ve(()=>{i.value.length>2&&h.submit()},500);function j(e){i.value=e,g.value=!0,M()}function L(){i.value.length>2&&(y.replace({name:"SearchAgent",query:{q:i.value}}),h.submit())}function I(){i.value="",r.value=null,g.value=!0,s(),y.replace({name:"SearchAgent"})}function A(){c.value={},i.value.length>2&&M()}function C(){return Object.values(c.value).some(e=>e&&e.length>0)}function T(e,t){!t||t.length===0?delete c.value[e]:c.value[e]=t,i.value.length>2&&M()}function E(e){return!e||!e.doctype||!e.name?{name:"SearchAgent"}:e.doctype==="HD Ticket"?{name:"TicketAgent",params:{ticketId:e.name}}:e.doctype==="HD Ticket Comment"&&e.reference_ticket?{name:"TicketAgent",params:{ticketId:e.reference_ticket},hash:`#comment-${e.name}`}:e.doctype==="Communication"&&e.reference_name?{name:"TicketAgent",params:{ticketId:e.reference_name},hash:`#communication-${e.name}`}:{name:"SearchAgent"}}function H(e){return!e||!e.doctype?"":e.doctype==="HD Ticket"?e.name||"":e.doctype==="HD Ticket Comment"?e.reference_ticket||"":e.doctype==="Communication"&&e.reference_name||""}function G(e){if(!e)return"";let t="MMM D, YYYY hh:mm A";try{return typeof e=="number"?le.unix(e).format(t):le(e).format(t)}catch{return""}}function q(e){return`${ne}${e}`}function N(e){const t=localStorage.getItem(q(e));if(t){const l=JSON.parse(t);if(Date.now()-l.timestamp<30*60*1e3)return r.value=l.results,l.filters&&(c.value=l.filters),g.value=!1,!0;localStorage.removeItem(q(e))}return!1}function B(e,t){const l={results:t,filters:c.value,timestamp:Date.now()};localStorage.setItem(q(e),JSON.stringify(l))}function s(){for(let e=0;e<localStorage.length;e++){const t=localStorage.key(e);t!=null&&t.startsWith(ne)&&localStorage.removeItem(t)}}return ie(()=>O.query.q,e=>{e&&typeof e=="string"&&e!==i.value?(i.value=e,g.value=!1,h.submit()):!e&&i.value&&(i.value="",r.value=null,g.value=!0)}),$e(()=>{const e=O.query.q;e?(i.value=e,N(e)||L()):s(),Me("/",()=>{x.value.el.focus()})}),(e,t)=>{var X,Z;const l=Le,V=ue,ce=ae("Button"),de=Ie,me=Re,fe=ve,pe=ae("router-link");return a(),o("div",null,[n("div",null,[p(d(He),null,{"left-header":$(()=>[p(d(Ae),{items:[{label:"Search",route:{name:"SearchAgent"}}]})]),_:1}),n("div",nt,[n("div",ot,[p(d(Oe),{ref_key:"searchInput",ref:x,class:"flex-1",placeholder:d(b)("Search tickets, comments, and communications..."),autocomplete:"off","model-value":i.value,"onUpdate:modelValue":j,onKeydown:[t[0]||(t[0]=u=>g.value=!0),t[1]||(t[1]=Ce(()=>L(),["enter"]))]},{prefix:$(()=>[p(l,{class:"w-4 text-ink-gray-5"})]),suffix:$(()=>[n("div",rt,[i.value?(a(),o("button",{key:0,onClick:I,class:"p-1 size-6 grid place-content-center focus:outline-none focus:ring focus:ring-outline-gray-3 rounded"},[p(V,{class:"w-4 text-ink-gray-7"})])):m("",!0)])]),_:1},8,["placeholder","model-value"])]),n("div",it,[n("div",ut,[p(K,{options:U.value,"model-value":c.value.agent_group||[],"onUpdate:modelValue":t[2]||(t[2]=u=>T("agent_group",u)),placeholder:"Team",label:"Team"},null,8,["options","model-value"]),p(K,{options:Y.value,"model-value":c.value.status||[],"onUpdate:modelValue":t[3]||(t[3]=u=>T("status",u)),placeholder:"Status",label:"Status"},null,8,["options","model-value"]),p(K,{options:F.value,"model-value":c.value.priority||[],"onUpdate:modelValue":t[4]||(t[4]=u=>T("priority",u)),placeholder:"Priority",label:"Priority"},null,8,["options","model-value"]),p(K,{options:D.value,"model-value":c.value.doctype||[],"onUpdate:modelValue":t[5]||(t[5]=u=>T("doctype",u)),placeholder:"Type",label:"Type"},null,8,["options","model-value"]),C()?(a(),_(ce,{key:0,size:"sm",class:"ml-auto text-ink-gray-5",variant:"gray-ghost",onClick:A,label:d(b)("Clear all filters")},null,8,["label"])):m("",!0)])]),n("div",ct,[n("div",null,[d(h).error?(a(),_(d(De),{key:0,message:d(h).error.type=="HelpdeskSearchIndexMissingError"?"Search index does not exist. Please build the index first.":d(h).error},null,8,["message"])):g.value&&i.value.length>2?(a(),o("p",dt,"Press enter to search")):d(h).loading?(a(),o("p",mt,"Searching...")):(X=r.value)!=null&&X.summary?(a(),o("div",ft,[n("p",pt,[Te(v(r.value.summary.filtered_matches)+" matches ("+v(r.value.summary.duration)+"s) ",1),C()?(a(),o("span",vt," • "+v(Object.keys(r.value.summary.applied_filters||{}).length)+" filter(s) applied ",1)):m("",!0)]),r.value.summary.corrected_query?(a(),o("p",ht,[t[6]||(t[6]=n("span",{class:"text-ink-gray-5"},"Searched for:",-1)),n("span",gt,v(r.value.summary.corrected_query),1)])):m("",!0)])):m("",!0)])]),n("div",_t,[(a(!0),o(w,null,R((Z=r.value)==null?void 0:Z.results,u=>(a(),o(w,{key:u.id},[p(pe,{to:E(u),class:"flex space-x-2 overflow-hidden rounded px-2.5 py-3 hover:bg-surface-gray-2"},{default:$(()=>[n("div",yt,[n("div",xt,[u.doctype==="HD Ticket"?(a(),_(de,{key:0,class:"h-4 w-4 text-ink-gray-6"})):u.doctype==="HD Ticket Comment"?(a(),_(me,{key:1,class:"h-4 w-4 text-ink-gray-6"})):u.doctype==="Communication"?(a(),_(fe,{key:2,class:"h-4 w-4 text-ink-gray-6"})):m("",!0)])]),n("div",kt,[n("div",bt,[u.title?(a(),o("div",{key:0,class:"text-base font-medium",innerHTML:u.title},null,8,wt)):(a(),o("div",St,v(u.name),1)),n("span",$t," · "+v(u.doctype=="Communication"?"Email":u.doctype.replace("HD ","")),1),n("span",Ct," · #"+v(H(u)),1),n("div",Tt,v(G(u.modified)),1)]),u.content?(a(),o("div",{key:0,class:"mt-1 text-p-base text-ink-gray-6",innerHTML:u.content},null,8,Vt)):m("",!0)])]),_:2},1032,["to"]),t[7]||(t[7]=n("div",{class:"border-b mx-2"},null,-1))],64))),128))])])])])}}});export{zt as default};
//# sourceMappingURL=SearchAgent-c5595437.js.map
