import{_ as X}from"./CustomActions-a6a14efb.js";import{d as P,c as b,K as x,aa as H,W as z,e as m,k as f,l as p,t as R,v as Q,y as v,f as F,x as Z,s as ee,u as te,a as ae,A,p as le,J as h,ap as B,q as _,N as se,g,w as T,h as l,F as oe,G as ie,a9 as ne,ar as E,as as j,X as re,a1 as q,aS as de}from"./index-70619bb5.js";import{_ as ue}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-345f1ef8.js";import{u as ce}from"./pageMeta-8fdb5c1e.js";import{g as me,a as pe}from"./TypingIndicator.vue_vue_type_style_index_0_scoped_3f215bd3_lang-b030ea09.js";import"./dayjs-5868d221.js";import{L as fe}from"./LayoutHeader-330b6449.js";import{_ as L}from"./Autocomplete-050816e8.js";import{a as ve}from"./Link-fff2e6d4.js";import{s as he,p as _e,h as ge,a as ke}from"./formCustomisation-8a41b461.js";import{l as be}from"./lodash-93461065.js";import{s as O}from"./index-260fdb53.js";import{_ as ye}from"./SearchArticles.vue_vue_type_script_setup_true_lang-90519ada.js";import{_ as M}from"./TicketTextEditor.vue_vue_type_script_setup_true_lang-5da0286d.js";import"./Dropdown-19778bff.js";import"./FileUploader-0ea47db7.js";import"./AttachmentItem.vue_vue_type_script_setup_true_lang-c6d87231.js";import"./TextEditor.vue_vue_type_script_setup_true_lang-fba2d88c.js";import"./UserAvatar.vue_vue_type_script_setup_true_lang-f3e181f4.js";import"./Avatar.vue_vue_type_script_setup_true_lang-e2ccf576.js";const xe={key:0,class:"space-y-1.5"},Ce={class:"block text-sm text-gray-700"},we={key:0,class:"place-self-center text-red-500"},Se=P({__name:"UniInput",props:{field:{},value:{type:[String,Number,Boolean]}},emits:["change"],setup($,{emit:C}){const o=$,N=C,D=b(()=>o.field.url_method?x(L,{options:U.data,size:"sm"}):o.field.fieldtype==="Link"&&o.field.options?x(ve,{doctype:o.field.options,filters:o.field.filters}):o.field.fieldtype==="Select"?x(L,{options:o.field.options.split(`
`).map(s=>({label:s,value:s})),size:"sm"}):o.field.fieldtype==="Check"?x(L,{options:[{label:"Yes",value:1},{label:"No",value:0}],size:"sm"}):x(H,{debounce:500})),U=z({url:o.field.url_method,auto:!!o.field.url_method,transform:s=>(s==null?void 0:s.map(i=>({label:i,value:i})))||[]}),y=b(()=>o.field.fieldtype==="Check"?o.value?"Yes":"No":o.value),c=b(()=>o.field.placeholder?o.field.placeholder:o.field.fieldtype==="Data"&&!o.field.url_method?"Type something":"Select an option");function u(s,i){N("change",{fieldname:s,value:i})}return(s,i)=>s.field.display_via_depends_on?(m(),f("div",xe,[p("span",Ce,[R(Q(s.field.label)+" ",1),s.field.required?(m(),f("span",we," * ")):v("",!0)]),(m(),F(Z(D.value),{placeholder:c.value,value:y.value,disabled:s.field.disabled,"model-value":y.value,"onUpdate:modelValue":i[0]||(i[0]=n=>u(s.field.fieldname,n)),onChange:i[1]||(i[1]=n=>{var w;return u(s.field.fieldname,((w=n.target)==null?void 0:w.value)||n.value||n)})},null,40,["placeholder","value","disabled","model-value"]))])):v("",!0)}}),Te={class:"flex flex-col overflow-y-auto"},Fe={class:"flex flex-col gap-5 py-6 h-full flex-1 self-center overflow-auto mx-auto w-full max-w-4xl px-5"},$e={key:0,class:""},Ne=["innerHTML"],De={key:1,class:"grid grid-cols-1 gap-4 sm:grid-cols-3"},Ue={class:"flex flex-col gap-2"},Ve={key:1},Ie={class:"text-p-sm text-gray-500 ml-1"},Ae={key:2},tt=P({__name:"TicketNew",props:{templateId:{default:""}},setup($){const C=$;ee();const o=te(),{$dialog:N}=me(),{updateOnboardingStep:D}=pe("helpdesk"),{isManager:U,userId:y}=ae(),c=A(""),u=A(""),s=A([]),i=le({}),n=z({url:"helpdesk.helpdesk.doctype.hd_ticket_template.api.get_one",makeParams:()=>({name:C.templateId||"Default"}),auto:!0,onSuccess:e=>{u.value=e.description_template||"",V=window.structuredClone(e.fields||[]),he(n,{doc:i,call:re,router:o,$dialog:N,applyFilters:Y}),w(e.fields)}});function w(e){e.forEach(a=>{i[a.fieldname]=""})}let V=[];function Y(e,a=null){const r=n.data.fields.find(d=>d.fieldname===e);r&&(r.fieldtype==="Select"?ge(r,e,a,i,V):r.fieldtype==="Link"&&ke(r,e,a,i,V))}const G=b(()=>{var e;return(e=n.data)==null?void 0:e._customOnChange}),I=b(()=>{var a,r;let e=(r=(a=n.data)==null?void 0:a.fields)==null?void 0:r.filter(d=>!h.value||!d.hide_from_customer);return e?e.map(d=>_e(d,i)):[]});function J(e,a,r){var t;i[a]=e.value;const d=(t=G.value)==null?void 0:t[a];d&&d.forEach(k=>{k(e.value,r)})}const S=z({url:"helpdesk.helpdesk.doctype.hd_ticket.api.new",debounce:300,makeParams:()=>({doc:{description:u.value,subject:c.value,template:C.templateId,...i},attachments:s.value}),validate:e=>{var d;const r=[...((d=I.value)==null?void 0:d.filter(t=>t.required))||[],"subject","description"];for(const t of r)if(be.isEmpty(e.doc[t.fieldname||t]))return`${t.label||t} is required`},onSuccess:e=>{o.push({name:h.value?"TicketCustomer":"TicketAgent",params:{ticketId:e.name}}),U&&D("create_first_ticket",!0,!1,()=>localStorage.setItem("firstTicket",e.name)),h.value&&B("new_ticket_submitted",{data:{user:y,ticketID:e.name,subject:c.value,description:u.value,customFields:i}})}});function K(e){return O(e,{allowedTags:O.defaults.allowedTags.concat(["img"])})}const W=b(()=>[{label:_("Tickets"),route:{name:h.value?"TicketsCustomer":"TicketsAgent"}},{label:_("New Ticket"),route:{name:"TicketNew"}}]);return ce(()=>({title:_("New Ticket")})),se(()=>{B("new_ticket_page",{data:{user:y}})}),(e,a)=>{var d;const r=X;return m(),f("div",Te,[g(l(fe),null,{"left-header":T(()=>[g(l(ue),{items:W.value},null,8,["items"])]),"right-header":T(()=>{var t,k;return[(t=l(n).data)!=null&&t._customActions?(m(),F(r,{key:0,actions:(k=l(n).data)==null?void 0:k._customActions},null,8,["actions"])):v("",!0)]}),_:1}),p("div",Fe,[(d=l(n).data)!=null&&d.about?(m(),f("div",$e,[p("div",{class:"prose-f",innerHTML:K(l(n).data.about)},null,8,Ne)])):v("",!0),I.value?(m(),f("div",De,[(m(!0),f(oe,null,ie(I.value,t=>(m(),F(l(Se),{key:t.fieldname,field:t,value:i[t.fieldname],onChange:k=>J(k,t.fieldname,t.fieldtype)},null,8,["field","value","onChange"]))),128))])):v("",!0),p("div",{class:ne(["flex flex-col",(c.value.length>=2||u.value.length)&&"gap-5"])},[p("div",Ue,[a[7]||(a[7]=p("span",{class:"block text-sm text-gray-700"},[R(" Subject "),p("span",{class:"place-self-center text-red-500"}," * ")],-1)),g(l(H),{modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=t=>c.value=t),type:"text",placeholder:l(_)("A short description")},null,8,["modelValue","placeholder"])]),l(h)?(m(),F(ye,{key:0,query:c.value,class:"shadow"},null,8,["query"])):v("",!0),l(h)?(m(),f("div",Ve,[E(p("h4",Ie," Please enter a subject to continue ",512),[[j,c.value.length<=2&&u.value.length===0]]),E(g(M,{ref:"editor",attachments:s.value,"onUpdate:attachments":a[2]||(a[2]=t=>s.value=t),content:u.value,"onUpdate:content":a[3]||(a[3]=t=>u.value=t),placeholder:"Detailed explanation",expand:"",uploadFunction:t=>l(de)(t)},{"bottom-right":T(()=>[g(l(q),{label:l(_)("Submit"),theme:"gray",variant:"solid",disabled:e.$refs.editor.editor.isEmpty||l(S).loading||!c.value,onClick:a[1]||(a[1]=()=>l(S).submit())},null,8,["label","disabled"])]),_:1},8,["attachments","content","uploadFunction"]),[[j,c.value.length>2||u.value.length>0]])])):v("",!0)],2),l(h)?v("",!0):(m(),f("div",Ae,[g(M,{ref:"editor",attachments:s.value,"onUpdate:attachments":a[5]||(a[5]=t=>s.value=t),content:u.value,"onUpdate:content":a[6]||(a[6]=t=>u.value=t),placeholder:l(_)("Detailed explanation"),expand:""},{"bottom-right":T(()=>[g(l(q),{label:l(_)("Submit"),theme:"gray",variant:"solid",disabled:e.$refs.editor.editor.isEmpty||l(S).loading||!c.value,onClick:a[4]||(a[4]=()=>l(S).submit())},null,8,["label","disabled"])]),_:1},8,["attachments","content","placeholder"])]))])])}}});export{tt as default};
//# sourceMappingURL=TicketNew-9e2e4f90.js.map
