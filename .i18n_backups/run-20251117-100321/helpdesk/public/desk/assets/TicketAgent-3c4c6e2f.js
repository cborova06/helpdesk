import{j as re,e as p,k as w,l as d,r as N,h as e,ab as Ke,v as F,D as fe,ac as me,f as B,x as Qe,d as M,m as _e,n as ke,A as D,W as G,Q as ae,Z as Ye,a4 as ie,w as S,t as ge,g as v,q as R,y as U,I as et,a0 as H,$ as be,c as A,ad as tt,F as W,u as He,s as ye,N as he,ae as at,af as nt,ag as E,ah as se,L as ze,a9 as te,ai as st,K as ot,P as lt,X as Ie,aj as it,ak as xe,G as K,al as rt,C as ct,E as ut,am as dt,M as oe,an as mt,ao as qe,U as Ee,ap as pt,aq as vt,z as ne,ar as ft,H as _t,as as gt,a1 as De,at as kt,p as bt,au as yt,a8 as ee,av as ht}from"./index-70619bb5.js";import{A as xt,C as Ct,u as $t,a as wt,b as Tt,c as St,d as Vt,e as Lt,_ as Ne,T as At}from"./useActiveTabManager-bf736e9e.js";import{T as Bt,b as X,u as zt,d as Pe,g as We,t as Dt,e as Ut,s as jt,f as Ft}from"./TypingIndicator.vue_vue_type_style_index_0_scoped_3f215bd3_lang-b030ea09.js";import"./dayjs-5868d221.js";import{L as Rt}from"./LayoutHeader-330b6449.js";import{_ as ce}from"./EmailIcon-6f87f7a6.js";import{P as Ce}from"./PhoneIcon-8254e48c.js";import{u as ue}from"./telephony-7ffcc91b.js";import{_ as Ht}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-345f1ef8.js";import{D as pe}from"./Dropdown-19778bff.js";import{I as Ue}from"./IndicatorIcon-893ac127.js";import{u as Me}from"./ticketStatus-b324718d.js";import{_ as Oe}from"./MultipleAvatar.vue_vue_type_script_setup_true_lang-7d84c5a1.js";import{a as $e}from"./Link-fff2e6d4.js";import{L as Ze}from"./merge-44a03ad1.js";import{s as It,p as je}from"./formCustomisation-8a41b461.js";import{T as qt}from"./TabButtons-7d8e5c5a.js";import{_ as Je}from"./Avatar.vue_vue_type_script_setup_true_lang-e2ccf576.js";import{_ as Et}from"./Section-61b0e7fc.js";import{_ as Fe}from"./UserAvatar.vue_vue_type_script_setup_true_lang-f3e181f4.js";import{_ as Nt}from"./Switch.vue_vue_type_script_setup_true_lang-e2787a9e.js";import{u as Pt}from"./pageMeta-8fdb5c1e.js";import"./FileUploader-0ea47db7.js";import"./TextEditor.vue_vue_type_script_setup_true_lang-fba2d88c.js";import"./AttachmentItem.vue_vue_type_script_setup_true_lang-c6d87231.js";import"./CallLogModal.vue_vue_type_script_setup_true_lang-fb845699.js";import"./EmailContent-6c797d60.js";import"./StarRating.vue_vue_type_script_setup_true_lang-5b0e6a21.js";import"./DateTimePicker-e0783882.js";import"./useDatePicker-f8eb2ea6.js";import"./Autocomplete-050816e8.js";import"./description-7d12a55f.js";const Wt={},Mt={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Ot(C,t){return p(),w("svg",Mt,[...t[0]||(t[0]=[d("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M13.9996 3.54443V8.771C13.9994 9.32318 13.5518 9.771 12.9996 9.771H12.1802C11.9041 9.771 11.6802 9.99485 11.6802 10.271C11.6803 10.547 11.9042 10.771 12.1802 10.771H12.9996C14.104 10.771 14.9994 9.87546 14.9996 8.771V3.54443C14.9996 2.43986 14.1041 1.54443 12.9996 1.54443H6.72124C5.61667 1.54443 4.72124 2.43986 4.72124 3.54443V4.37158C4.72124 4.64772 4.94509 4.87158 5.22124 4.87158C5.49738 4.87158 5.72124 4.64772 5.72124 4.37158V3.54443C5.72124 2.99215 6.16895 2.54443 6.72124 2.54443H12.9996C13.5518 2.54443 13.9996 2.99215 13.9996 3.54443ZM9.27832 6.22928C9.8306 6.22928 10.2783 6.67699 10.2783 7.22928V12.4558C10.2782 13.008 9.83053 13.4558 9.27832 13.4558H3C2.44779 13.4558 2.00012 13.008 2 12.4558V7.22928C2 6.67699 2.44772 6.22928 3 6.22928H9.27832ZM9.27832 14.4558C10.3828 14.4558 11.2782 13.5603 11.2783 12.4558V7.22928C11.2783 6.12471 10.3829 5.22928 9.27832 5.22928H3C1.89543 5.22928 1 6.12471 1 7.22928V12.4558C1.00012 13.5603 1.89551 14.4558 3 14.4558H9.27832Z",fill:"#525252"},null,-1)])])}const Re=re(Wt,[["render",Ot]]),Zt={},Jt={width:"16",height:"17",viewBox:"0 0 16 17",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Gt(C,t){return p(),w("svg",Jt,[...t[0]||(t[0]=[d("path",{d:"M5.66406 2.25C5.94021 2.25 6.16406 2.47386 6.16406 2.75C6.16406 3.02614 5.94021 3.25 5.66406 3.25H4.25C3.42157 3.25 2.75 3.92157 2.75 4.75V12.25L2.75781 12.4033C2.83461 13.1597 3.47334 13.75 4.25 13.75H11.75C12.5784 13.75 13.25 13.0784 13.25 12.25V10.8359C13.25 10.5598 13.4739 10.3359 13.75 10.3359C14.0261 10.3359 14.25 10.5598 14.25 10.8359V12.25C14.25 13.6307 13.1307 14.75 11.75 14.75H4.25C2.95566 14.75 1.89082 13.7664 1.7627 12.5059L1.75 12.25V4.75C1.75 3.36929 2.86929 2.25 4.25 2.25H5.66406ZM13.75 2.25C13.7827 2.25 13.8155 2.25243 13.8477 2.25879C13.8574 2.26071 13.8665 2.2651 13.876 2.26758C13.9592 2.28923 14.0383 2.33126 14.1035 2.39648C14.2012 2.49413 14.25 2.62202 14.25 2.75V7.25C14.25 7.52608 14.0261 7.74994 13.75 7.75C13.4739 7.75 13.25 7.52611 13.25 7.25V3.95703L6.81152 10.3955C6.61626 10.5908 6.29975 10.5908 6.10449 10.3955C5.90923 10.2002 5.90923 9.88374 6.10449 9.68848L12.543 3.25H9.25C8.97388 3.25 8.75003 3.02611 8.75 2.75C8.75 2.47386 8.97386 2.25 9.25 2.25H13.75Z",fill:"#525252"},null,-1)])])}const Xt=re(Zt,[["render",Gt]]),Kt={},Qt={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Yt(C,t){return p(),w("svg",Qt,[...t[0]||(t[0]=[d("g",{"clip-path":"url(#clip0_11163_86342)"},[d("path",{d:"M8 0.75C12.0041 0.75 15.25 3.99594 15.25 8C15.25 12.0041 12.0041 15.25 8 15.25C3.99594 15.25 0.75 12.0041 0.75 8C0.75 3.99594 3.99594 0.75 8 0.75ZM9.83691 4.24902C9.83246 4.31586 9.82822 4.40482 9.80762 4.49316C9.79115 4.5636 9.76659 4.63202 9.73535 4.69727C9.69606 4.77931 9.64388 4.85125 9.60547 4.90625L9.57715 4.94727C9.53169 5.01237 9.47353 5.10016 9.39648 5.1748C9.33512 5.23421 9.26581 5.2852 9.19141 5.32715C9.09793 5.37982 8.99723 5.41143 8.92188 5.43652L7.01367 6.07227C6.96479 6.08854 6.93927 6.09602 6.92188 6.10254L6.9209 6.10449C6.90952 6.11925 6.89436 6.14042 6.86426 6.18262L6.30859 6.96094C6.25045 7.04245 6.17582 7.15257 6.07422 7.24023C5.99357 7.30979 5.9021 7.36646 5.80371 7.40723C5.67989 7.45842 5.54801 7.47592 5.44922 7.49121L5.38574 7.50098C5.29011 7.51579 5.16346 7.53843 5.03418 7.52832C4.93128 7.52017 4.82895 7.4961 4.7334 7.45703C4.61327 7.40776 4.51037 7.32967 4.43164 7.27344L2.19727 5.67773C1.90962 6.39582 1.75 7.17915 1.75 8C1.75 11.4518 4.54822 14.25 8 14.25C11.4518 14.25 14.25 11.4518 14.25 8C14.25 5.2413 12.4623 2.90124 9.98242 2.07227L9.83691 4.24902ZM7.12207 8.18945C7.27526 7.95989 7.58574 7.89776 7.81543 8.05078L10.6025 9.9082C10.7167 9.98443 10.7942 10.1049 10.8174 10.2402C10.8406 10.3756 10.8069 10.5151 10.7246 10.625L9.33203 12.4824C9.23768 12.6082 9.08888 12.6825 8.93164 12.6826H7.07422C6.83589 12.6826 6.63074 12.514 6.58398 12.2803L6.11914 9.95801C6.09321 9.82809 6.1199 9.69327 6.19336 9.58301L7.12207 8.18945ZM7.13965 9.96484L7.48438 11.6826H8.68164L9.60742 10.4463L7.67676 9.15918L7.13965 9.96484ZM8 1.75C5.72993 1.75 3.74217 2.96003 2.64746 4.77051L5.0127 6.45996C5.06466 6.49708 5.09177 6.51562 5.11133 6.52832L5.1123 6.5293H5.11426C5.13745 6.52677 5.16993 6.52251 5.2334 6.5127L5.2959 6.50293C5.3614 6.49279 5.39526 6.48721 5.41895 6.48242L5.41992 6.48145L5.42188 6.48047C5.4368 6.46146 5.45658 6.43391 5.49512 6.37988L6.0498 5.60156C6.09519 5.53793 6.15408 5.45185 6.23047 5.37891C6.29114 5.32101 6.35945 5.27146 6.43262 5.23047C6.52471 5.17891 6.6241 5.14773 6.69824 5.12305L8.60645 4.4873C8.65567 4.47091 8.68058 4.46266 8.69824 4.45605L8.7002 4.45508L8.70117 4.4541C8.71253 4.43905 8.72714 4.41753 8.75684 4.375L8.78613 4.33398C8.81121 4.29807 8.82337 4.27987 8.83203 4.2666V4.26465L8.83301 4.26367C8.83455 4.24789 8.83595 4.22533 8.83887 4.18164L8.99609 1.83008C8.67167 1.77811 8.33907 1.75 8 1.75Z",fill:"#7C7C7C"})],-1),d("defs",null,[d("clipPath",{id:"clip0_11163_86342"},[d("rect",{width:"16",height:"16",fill:"white"})])],-1)])])}const ea=re(Kt,[["render",Yt]]),Ge={__name:"Icon",props:{icon:{type:[String,Object],required:!0}},setup(C){return(t,i)=>{const l=N("FeatherIcon");return e(Ke)(C.icon)?(p(),w("div",fe(me({key:0},t.$attrs)),F(C.icon),17)):typeof C.icon=="string"?(p(),B(l,me({key:1,name:C.icon},t.$attrs),null,16,["name"])):(p(),B(Qe(C.icon),fe(me({key:2},t.$attrs)),null,16))}}},ta={class:"flex flex-col gap-4"},aa={class:"text-p-base text-ink-gray-8"},na={class:"whitespace-nowrap font-semibold"},sa={class:"flex items-center gap-2 rounded-md p-2 ring-1 ring-gray-200"},oa=M({__name:"TicketMergeModal",props:_e({ticket:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:_e(["update"],["update:modelValue"]),setup(C,{emit:t}){const i=C,l=t,_=ke(C,"modelValue");function g(){const k={status_category:["in",["Open","Paused"]],is_merged:0,name:["!=",i.ticket.name]};return i.ticket.customer&&(k.customer=i.ticket.customer),i.ticket.raised_by&&(k.raised_by=["like",`%${i.ticket.raised_by}%`]),k}const a=D(null),r=D(null),f=G({url:"helpdesk.helpdesk.doctype.hd_ticket.api.merge_ticket",makeParams({source:k,target:m}){return{source:k,target:m}},validate({source:k,target:m}){if(!k)throw{message:"Category is required"};if(!m)throw{message:"Ticket to merged with is required"}},onSuccess:()=>{ae.success("Ticket merged successfully"),l("update"),_.value=!1,window.open(window.location.origin+"/helpdesk/tickets/"+a.value,"_blank"),a.value=null}}),h=Ye({doctype:"HD Ticket",filters:{name:["=",a]},fields:["subject"],onSuccess:k=>{k.length>0&&(r.value=k[0].subject)}});ie(()=>a.value,k=>{k&&(h.update({filters:{name:["=",k]}}),h.reload())});function x(){f.submit({source:i.ticket.name,target:a.value})}return(k,m)=>{const b=N("FormControl"),y=N("Button");return p(),B(e(et),{options:{title:"Merge with another ticket"},modelValue:_.value,"onUpdate:modelValue":m[2]||(m[2]=o=>_.value=o)},{"body-content":S(()=>[d("div",ta,[d("p",aa,[m[3]||(m[3]=ge(" All comments and emails of the ticket ",-1)),d("span",na,"#"+F(k.ticket.name),1),m[4]||(m[4]=ge(" will be moved to the selected ticket. ",-1))]),v(e($e),{class:"form-control",doctype:"HD Ticket",placeholder:e(R)("Select Ticket"),filters:g(),label:e(R)("Ticket"),"page-length":10,value:a.value,"show-description":!0,onChange:m[0]||(m[0]=o=>a.value=String(o))},null,8,["placeholder","filters","label","value"]),a.value?(p(),B(b,{key:0,label:e(R)("Ticket Subject"),type:"text",modelValue:r.value,"onUpdate:modelValue":m[1]||(m[1]=o=>r.value=o),disabled:!0},null,8,["label","modelValue"])):U("",!0),d("div",sa,[v(e(Bt),{class:"h-6 w-5 w-min-5 w-max-5 min-h-5 max-w-5 text-yellow-500"}),m[5]||(m[5]=d("div",{class:"text-wrap text-sm text-gray-700"}," This action is irreversible. ",-1))])])]),actions:S(()=>[v(y,{class:"w-full",variant:"solid",label:a.value?`Merge with ticket #${a.value} `:"Select Ticket",loading:e(f).loading,"icon-left":a.value&&e(Ze),onClick:x},null,8,["label","loading","icon-left"])]),_:1},8,["modelValue"])}}}),Q=Symbol("ticket"),we=Symbol("assignees"),Te=Symbol("customizations"),Se=Symbol("ticketContact"),Xe=Symbol("recentSimilarTickets"),le=Symbol("activities"),la={key:1,class:"flex items-center justify-center flex-col mt-20"},ia=M({__name:"TicketActivityPanel",setup(C){const t=H(Q),i=H(le),l=D(null),_=D(null),g=ue(),{isCallingEnabled:a}=be(g),r=A(()=>{const m=[{name:"activity",label:R("Activity"),icon:xt},{name:"email",label:R("Emails"),icon:ce},{name:"comment",label:R("Comments"),icon:Ct}];return a.value&&m.push({name:"call",label:R("Calls"),icon:Ce}),m}),{tabIndex:f,changeTabTo:h}=$t(r),x=A(()=>{var z,I,Y,V,T,L,O,Z;if(!((z=i.value)!=null&&z.data))return[];const m=(Y=(I=i.value)==null?void 0:I.data)==null?void 0:Y.communications.map((u,q)=>{var Ve,Le,Ae,Be;const J=((Ve=u.user)==null?void 0:Ve.name)||((Le=u.user)==null?void 0:Le.full_name),de=(Ae=u.user)==null?void 0:Ae.email;return{subject:u.subject,content:u.content,sender:{name:J||de,full_name:J||de,email:de,image:(Be=u.user)==null?void 0:Be.image},to:u.recipients,type:"email",key:u.creation,cc:u.cc,bcc:u.bcc,creation:u.communication_date||u.creation,attachments:u.attachments,name:u.name,deliveryStatus:u.delivery_status,isFirstEmail:q===0}}),b=i.value.data.comments.map(u=>({name:u.name,type:"comment",key:u.creation,commentedBy:u.commented_by,commenter:u.user.name,creation:u.creation,content:u.content,attachments:u.attachments})),y=[...i.value.data.history,...i.value.data.views].map(u=>({type:"history",key:u.creation,content:u.action?u.action:"viewed this",creation:u.creation,user:u.user.name+" "})),o=i.value.data.calls.map(u=>({...u,type:"call",name:u.name,key:u.creation,call_type:u.type,content:`${u.caller||"Unknown"} made a call to ${u.receiver||"Unknown"}`,duration:u.duration?u.duration+"s":"0s"})),n=[...m,...b,...y,...o].sort((u,q)=>new Date(u.creation)-new Date(q.creation)),c=[];let s=0;for(;s<n.length;){const u=n[s];if(u.type==="history"){u.relatedActivities=[u];for(let q=s+1;q<n.length+1;q++){const J=n[q];if(J&&J.user===u.user&&J.content!=="viewed this"&&!J.content.includes("assigned")&&!J.content.includes("unassigned"))u.relatedActivities.push(J);else{c.push(u),s=q-1;break}}}else c.push(u);s++}if(t.value.doc.feedback_rating===0)return c;let $=[{type:"feedback",key:"feedback-activity",feedback_rating:(V=t.value)==null?void 0:V.doc.feedback_rating,feedback_extra:(T=t.value)==null?void 0:T.doc.feedback_extra,feedback:(L=t.value)==null?void 0:L.doc.feedback,sender:{name:(O=t.value)==null?void 0:O.doc.raised_by,full_name:(Z=t.value)==null?void 0:Z.doc.contact}}];return c.push(...$),c});function k(m){return m==="activity"?x.value:x.value.filter(b=>b.type===m)}return(m,b)=>{var y,o,n;return p(),w(W,null,[v(e(Vt),{modelValue:e(f),tabs:r.value,"onUpdate:modelValue":e(h)},{default:S(()=>[v(e(wt)),v(e(Tt),{class:"flex-1"},{default:S(({tab:c})=>[e(i).data?(p(),B(St,{key:0,ref_key:"ticketAgentActivitiesRef",ref:l,activities:k(c.name),title:c.label,"ticket-status":e(t).doc.status,"onEmail:reply":b[0]||(b[0]=s=>{_.value.replyToEmail(s)}),onUpdate:b[1]||(b[1]=()=>{e(i).reload(),l.value.scrollToLatestActivity()})},null,8,["activities","title","ticket-status"])):(p(),w("div",la,[v(e(tt),{scale:8,class:"text-ink-gray-5"}),b[3]||(b[3]=d("p",{class:"text-xl font-medium text-ink-gray-5 absolute top-[50%]"}," Loading... ",-1))]))]),_:1})]),_:1},8,["modelValue","tabs","onUpdate:modelValue"]),(p(),B(e(Lt),{ref_key:"communicationAreaRef",ref:_,ticketId:String((y=e(t).doc)==null?void 0:y.name),"to-emails":[(o=e(t).doc)==null?void 0:o.raised_by],"cc-emails":[],"bcc-emails":[],key:(n=e(t).doc)==null?void 0:n.name,onUpdate:b[2]||(b[2]=()=>{e(i).reload(),l.value.scrollToLatestActivity()})},null,8,["ticketId","to-emails"]))],64)}}}),P=D(0),j=G({url:"helpdesk.helpdesk.doctype.hd_ticket.api.get_navigation_tickets",cache:["ticketsToNavigate"]});function ra(){const C=He(),t=ye();function i(){if(P.value<j.data.length-1){P.value+=1;const f=j.data[P.value];return r(f),f}return null}function l(){if(P.value>0){P.value-=1;const f=j.data[P.value];return r(f),f}return null}function _(){return j.data[P.value]}function g(){return j.data&&P.value<j.data.length-1?j.data[P.value+1]:null}function a(){return j.data&&P.value>0?j.data[P.value-1]:null}function r(f){let h=t.query.view,x={name:"TicketAgent",params:{ticketId:f},hash:""};h&&(x.query={view:h}),C.push(x)}return{currentTicketIndex:P,ticketsToNavigate:j,goToNextTicket:i,goToPreviousTicket:l,getCurrentTicket:_,getNextTicket:g,getPreviousTicket:a,navigateToTicket:r}}const ca={class:"flex gap-1"},ua=M({__name:"TicketNavigation",setup(C){const{currentTicketIndex:t,goToNextTicket:i,goToPreviousTicket:l,getNextTicket:_,getPreviousTicket:g}=ra();D(null),D(null);const a=A(()=>{var f;return j.loading||!((f=j.data)!=null&&f.length)?!0:t.value==0}),r=A(()=>{var f;return j.loading||!((f=j.data)!=null&&f.length)||j.data.length<=1?!0:t.value>=j.data.length-1});return he(()=>{X({key:">",shift:!0},()=>{r.value||i()}),X({key:"<",shift:!0},()=>{a.value||l()})}),(f,h)=>{const x=N("Button"),k=N("Tooltip");return p(),w("div",ca,[v(k,{text:e(g)()?`Go to previous ticket: #${e(g)()}`:"No previous ticket",disabled:a.value},{default:S(()=>[v(x,{icon:e(at),variant:"ghost",disabled:a.value,onClick:h[0]||(h[0]=m=>e(l)())},null,8,["icon","disabled"])]),_:1},8,["text","disabled"]),v(k,{text:e(_)()?`Go to next ticket: #${e(_)()}`:"No next ticket",disabled:r.value},{default:S(()=>[v(x,{icon:e(nt),variant:"ghost",disabled:r.value,onClick:h[1]||(h[1]=m=>e(i)())},null,8,["icon","disabled"])]),_:1},8,["text","disabled"])])}}}),da={class:"flex items-center mx-5 md:mr-0 text-p-sm gap-3 text-[14px] mb-[13px]"},ma={class:"flex items-center gap-1"},pa={key:0,class:"text-ink-gray-4 flex items-center"},va={key:1,class:"text-ink-gray-4 flex items-center"},fa={class:"flex items-center gap-1"},_a={class:"flex items-center gap-1"},ga=M({__name:"TicketSLA",setup(C){const t=H(Q),i=A(()=>{var g,a;return(a=(g=t.value)==null?void 0:g.get)!=null&&a.loading?{label:"",color:""}:!t.value.doc.first_responded_on&&E().isBefore(E(t.value.doc.response_by))?{label:`Due in ${_(t.value.doc.response_by)}`,color:"orange"}:E(t.value.doc.first_responded_on).isBefore(E(t.value.doc.response_by))?{label:`Fulfilled in ${_(t.value.doc.first_responded_on,t.value.doc.creation)}`,color:"green"}:{label:`Failed by ${_(String(new Date),t.value.doc.response_by)}`,color:"red"}}),l=A(()=>{var g,a,r,f,h,x,k,m,b,y,o,n,c,s;return(a=(g=t.value)==null?void 0:g.get)!=null&&a.loading?{label:"",color:""}:((r=t.value.doc)==null?void 0:r.status_category)==="Paused"&&((f=t.value.doc)!=null&&f.on_hold_since)&&E((h=t.value.doc)==null?void 0:h.resolution_by).isAfter(E((x=t.value.doc)==null?void 0:x.on_hold_since))?{label:"On Hold",color:"blue"}:!((k=t.value.doc)!=null&&k.resolution_date)&&E().isBefore(E((m=t.value.doc)==null?void 0:m.resolution_by))?{label:`Due in ${_((b=t.value.doc)==null?void 0:b.resolution_by)}`,color:"purple"}:E((y=t.value.doc)==null?void 0:y.resolution_date).isBefore(E((o=t.value.doc)==null?void 0:o.resolution_by))?{label:`Fulfilled in ${_((n=t.value.doc)==null?void 0:n.resolution_date,(c=t.value.doc)==null?void 0:c.creation)}`,color:"green"}:{label:`Failed by ${_(String(new Date),(s=t.value.doc)==null?void 0:s.resolution_by)}`,color:"red"}});function _(g,a){a||(a=E().toString());let r=E(g),f=E.duration(r.diff(E(a))),h=f.days(),x=f.hours(),k=f.minutes();return h>0?`${h}d ${x}h`:x>0?`${x}h ${k}m`:`${k}m`}return X({meta:!0,shift:!0,key:"."},()=>{se(window.location.href,"Ticket URL copied to clipboard")}),X({meta:!0,key:"."},()=>{se(t.value.doc.name,`Ticket #${t.value.doc.name} copied to clipboard`)}),(g,a)=>{const r=ce,f=ea;return p(),B(st,{to:"#app-header"},[d("div",da,[d("div",ma,[d("p",{onClick:a[0]||(a[0]=h=>e(se)(e(t).doc.name,`Ticket #${e(t).doc.name} copied to clipboard`)),class:"cursor-copy"}," #"+F(e(t).doc.name),1),e(t).doc.via_customer_portal?(p(),w("div",va,[a[3]||(a[3]=d("span",{class:"text-ink-gray-4 mr-[6px]"},"via",-1)),v(f,{class:"size-4 inline-block mr-1"}),a[4]||(a[4]=d("span",{class:"font-medium"},"Portal",-1))])):(p(),w("div",pa,[a[1]||(a[1]=d("span",{class:"text-ink-gray-4 mr-[6px]"},"via",-1)),v(r,{class:"size-4 inline-block mr-1"}),a[2]||(a[2]=d("span",{class:""},"Email",-1))]))]),a[7]||(a[7]=d("div",{class:"border-l border-outline-gray-2 h-[13px]"},null,-1)),d("div",fa,[a[5]||(a[5]=d("span",null,"First Response",-1)),v(ze,{label:i.value.label,variant:"subtle",theme:i.value.color},null,8,["label","theme"])]),a[8]||(a[8]=d("div",{class:"border-l border-outline-gray-2 h-[13px]"},null,-1)),d("div",_a,[a[6]||(a[6]=d("span",null,"Resolution ",-1)),l.value?(p(),B(ze,{key:0,label:l.value.label,variant:"subtle",theme:l.value.color!=="purple"&&l.value.color,class:te(l.value.color==="purple"&&"!text-[#6B46C1] !bg-[#F3E8FF]")},null,8,["label","theme","class"])):U("",!0)])])])}}}),ka={class:"flex flex-col flex-1 gap-3"},ba=M({__name:"TicketSubjectModal",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(C){var a,r;const t=H(Q),i=ke(C,"modelValue"),l=D(((r=(a=t.value)==null?void 0:a.doc)==null?void 0:r.subject)||""),_=D(!1);function g(){_.value=!0,t.value.setValue.submit({subject:l.value},{onSuccess(){_.value=!1,i.value=!1}})}return(f,h)=>{const x=N("FormControl"),k=N("Button"),m=N("Dialog");return p(),B(m,{modelValue:i.value,"onUpdate:modelValue":h[1]||(h[1]=b=>i.value=b),options:{title:"Rename Subject"}},{"body-content":S(()=>[d("div",ka,[v(x,{modelValue:l.value,"onUpdate:modelValue":h[0]||(h[0]=b=>l.value=b),type:"textarea",size:"sm",variant:"subtle",disabled:!1},null,8,["modelValue"]),v(k,{variant:"solid",loading:_.value,label:e(R)("Rename"),onClick:g},null,8,["loading","label"])])]),_:1},8,["modelValue"])}}}),ya={class:"flex flex-col truncate"},ha={class:"flex gap-2 items-center"},xa={key:0,class:"flex gap-2"},Ca={key:1},$a=M({__name:"TicketHeader",props:{viewers:{type:Array,required:!0}},setup(C){var Y;const t=ye(),i=He(),{findView:l}=zt("HD Ticket"),_=Me(),g=H(Q),a=H(Te),r=H(le),f=D(!1),{notifyTicketUpdate:h}=Pe((Y=g.value)==null?void 0:Y.name),x=A(()=>{var T;return(((T=_.statuses.data)==null?void 0:T.filter(L=>L.enabled))||[]).map(L=>({label:L.label_agent,value:L.label_agent,onClick:()=>{h("Status",L.label_agent),g.value.doc.status!==L.label_agent&&g.value.setValue.submit({status:L.label_agent},{onSuccess(){r.value.reload()}})},icon:()=>ot(Ue,{class:L.parsed_color})}))}),k=A(()=>{var T,L,O,Z;let V=[{label:R("Tickets"),route:{name:"TicketsAgent"}}];if(t.query.view){const u=l(t.query.view);u&&V.push({label:(T=u.value)==null?void 0:T.label,icon:lt((L=u.value)==null?void 0:L.icon),route:{name:"TicketsAgent",query:{view:(O=u.value)==null?void 0:O.name}}})}return V.push({label:(Z=g.value.doc)==null?void 0:Z.subject,onClick:()=>{f.value=!0}}),V});function m(V,T,L=()=>{}){g.value.setValue.submit({[V]:T}),L()}const b=D(!1),y=A(()=>!g.value.doc.is_merged&&["Open","Paused"].includes(g.value.doc.status_category)),o=A(()=>{let V=[];return y.value&&V.push({label:R("Merge Ticket"),icon:Ze,condition:()=>!g.value.doc.is_merged,onClick:()=>b.value=!0}),[{group:"Default actions",hideLabel:!0,items:V}]}),n=D([]),c=A(()=>n.value.filter(V=>!V.group)),s=A(()=>{let V=[];return n.value.filter(T=>T.buttonLabel&&T.group).forEach(T=>{let L=V.findIndex(O=>O.label===T.buttonLabel);L>-1?V[L].action.push(T):V.push({label:T.buttonLabel,action:[T]})}),V}),$=A(()=>{let V=[];return V=V.concat(n.value.filter(T=>T.group&&!T.buttonLabel)),V}),z=A(()=>{var V;return{doc:(V=g==null?void 0:g.value)==null?void 0:V.doc,call:Ie,router:i,toast:ae,$dialog:We().$dialog,updateField:m,createToast:ae.create}});it(async()=>{var V,T,L;(V=a.value)!=null&&V.data&&(await It(a.value.data,z.value),n.value=[...o.value,...((L=(T=a.value)==null?void 0:T.data)==null?void 0:L._customActions)||[]])});const I=xe("statusRef");return he(()=>{X("s",()=>{var V,T,L;(L=(T=(V=I.value)==null?void 0:V.$el)==null?void 0:T.nextElementSibling)==null||L.click()})}),(V,T)=>{const L=Ge,O=N("FeatherIcon"),Z=N("Button");return p(),w(W,null,[v(Rt,null,{"left-header":S(()=>[d("div",ya,[v(e(Ht),{items:k.value,class:"breadcrumbs"},{prefix:S(({item:u})=>[u.icon?(p(),B(L,{key:0,icon:u.icon,class:"mr-1 h-4 flex items-center justify-center self-center"},null,8,["icon"])):U("",!0)]),_:1},8,["items"]),v(ga)])]),"right-header":S(()=>[d("div",ha,[v(e(Oe),{avatars:JSON.stringify(C.viewers),size:"md","hide-name":!0},null,8,["avatars"]),(p(),B(ua,{key:e(g).name})),c.value.length?(p(),w("div",xa,[(p(!0),w(W,null,K(c.value,u=>(p(),B(Z,{key:u.label,label:u.label,onClick:q=>u.onClick()},rt({_:2},[u.icon?{name:"prefix",fn:S(()=>[v(O,{name:u.icon,class:"h-4 w-4"},null,8,["name"])]),key:"0"}:void 0]),1032,["label","onClick"]))),128))])):U("",!0),s.value.length?(p(),w("div",Ca,[(p(!0),w(W,null,K(s.value,u=>(p(),w("div",{key:u.label},[v(e(pe),{options:u.action},{default:S(({open:q})=>[v(Z,{label:u.label},{suffix:S(()=>[v(O,{name:q?"chevron-up":"chevron-down",class:"h-4"},null,8,["name"])]),_:2},1032,["label"])]),_:2},1032,["options"])]))),128))])):U("",!0),v(e(pe),{options:x.value,placement:"right"},{default:S(({open:u})=>[v(Z,{label:e(g).doc.status,ref_key:"statusRef",ref:I},{prefix:S(()=>{var q;return[v(e(Ue),{class:te((q=e(_).getStatus(e(g).doc.status))==null?void 0:q.parsed_color)},null,8,["class"])]}),_:1},8,["label"])]),_:1},8,["options"]),$.value.length?(p(),B(e(pe),{key:2,options:$.value,placement:"right"},{default:S(()=>[v(Z,{icon:"more-horizontal"})]),_:1},8,["options"])):U("",!0)])]),_:1}),b.value?(p(),B(oa,{key:0,ticket:e(g).doc,modelValue:b.value,"onUpdate:modelValue":T[0]||(T[0]=u=>b.value=u),onUpdate:T[1]||(T[1]=u=>e(g).reload())},null,8,["ticket","modelValue"])):U("",!0),f.value?(p(),B(ba,{key:1,modelValue:f.value,"onUpdate:modelValue":T[2]||(T[2]=u=>f.value=u)},null,8,["modelValue"])):U("",!0)],64)}}});const wa={__name:"Resizer",props:{defaultWidth:{type:Number,default:352},minWidth:{type:Number,default:16*16},maxWidth:{type:Number,default:30*16},side:{type:String,default:"left"},parent:{type:Object,default:null}},setup(C){const t=C,i=D(!1),l=D(t.defaultWidth);function _(){document.addEventListener("mousemove",g),document.addEventListener("mouseup",()=>{document.body.classList.remove("select-none"),document.body.classList.remove("cursor-col-resize"),document.querySelectorAll(".select-text1").forEach(r=>{r.classList.remove("select-text1"),r.classList.add("select-text")}),localStorage.setItem("sidebarWidth",l.value),i.value=!1,document.removeEventListener("mousemove",g)})}function g(r){i.value=!0,document.body.classList.add("select-none"),document.body.classList.add("cursor-col-resize"),document.querySelectorAll(".select-text").forEach(x=>{x.classList.remove("select-text"),x.classList.add("select-text1")}),l.value=t.side=="left"?r.clientX:window.innerWidth-r.clientX;let f=t.parent?a():0;l.value=l.value-f;let h=[t.defaultWidth-10,t.defaultWidth+10];l.value>h[0]&&l.value<h[1]&&(l.value=t.defaultWidth),l.value<t.minWidth&&(l.value=t.minWidth),l.value>t.maxWidth&&(l.value=t.maxWidth)}function a(){return t.parent?t.parent.getBoundingClientRect()[t.side]:0}return(r,f)=>(p(),w("div",{class:"relative",style:dt({width:`${l.value}px`})},[ct(r.$slots,"default",fe(ut({sidebarResizing:i.value,sidebarWidth:l.value}))),d("div",{class:te(["absolute z-1 h-full w-1 cursor-col-resize bg-surface-gray-4 opacity-0 transition-opacity hover:opacity-100",{"opacity-100":i.value,"left-0":C.side=="right","right-0":C.side=="left"}]),onMousedown:_},null,34)],4))}},Ta={key:0},Sa={class:"flex gap-3 items-center px-5 py-2.5"},Va={class:"text-ink-gray-8 font-medium text-xl max-w-full truncate"},La={class:"px-5 text-ink-gray-5 pb-2"},Aa={class:"flex gap-2 items-center p-1.5"},Ba={class:"text-p-sm text-ink-gray-6 hover:underline cursor-pointer"},za={key:0,class:"flex gap-2 items-center p-1.5"},Da={class:"text-p-sm text-ink-gray-6 hover:underline cursor-pointer"},Ua={class:"px-5 border-t pb-2.5"},ja={class:"flex gap-2.5 items-center py-[13px] justify-between"},Fa=["onClick"],Ra=["onClick"],Ha={class:"text-base text-ink-gray-8 max-w-[60%] truncate"},Ia={class:"flex items-end justify-between"},qa={class:"text-base text-ink-gray-5"},Ea={class:"transition duration-400 hover:underline"},Na=M({__name:"TicketContactTab",setup(C){const t=ue(),{isCallingEnabled:i}=be(t),l=H(Se),_=H(Xe),g=window.date_format,{getStatus:a,colorMap:r}=Me();function f(m){let{color:b}=a(m);return r[b]?r[b]:r.Default}const h=A(()=>{var o,n,c,s;if(_.value.loading||!_.value.data)return[];const m=((n=(o=_.value)==null?void 0:o.data)==null?void 0:n.recent_tickets)||[],b=((s=(c=_.value)==null?void 0:c.data)==null?void 0:s.similar_tickets)||[],y=[];return m.length&&y.push({label:R("Recent Tickets"),tooltipMessage:"Tickets recently raised by this contact/customer",hideLabel:!1,opened:!0,tickets:m}),b.length&&y.push({label:R("Similar Tickets"),tooltipMessage:"Tickets with similar queries",hideLabel:!1,opened:!0,tickets:b}),y});function x(m){return mt(m).format(g.toUpperCase())}function k(m){let b=window.location.origin+"/helpdesk/tickets/"+m;window.open(b,"_blank")}return(m,b)=>{const y=qe;return p(),w("div",null,[e(l).loading?U("",!0):(p(),w("div",Ta,[d("div",Sa,[v(e(Je),{label:e(l).data.name,image:e(l).data.image,size:"2xl"},null,8,["label","image"]),d("p",Va,F(e(l).data.name),1)]),d("div",La,[d("div",Aa,[v(ce,{class:"size-4"}),d("p",Ba,F(e(l).data.email_id),1),v(e(Re),{class:"size-4 cursor-pointer",onClick:b[0]||(b[0]=o=>e(se)(e(l).data.email_id,`'${e(l).data.email_id}' copied to clipboard`))})]),e(i)&&(e(l).data.mobile_no||e(l).data.phone)?(p(),w("div",za,[v(Ce,{class:"size-4"}),d("p",Da,F(e(l).data.mobile_no||e(l).data.phone),1),e(l).data.mobile_no||e(l).data.phone?(p(),B(e(Re),{key:0,class:"size-4 cursor-pointer",onClick:b[1]||(b[1]=o=>e(se)(e(l).data.mobile_no||e(l).data.phone,`'${e(l).data.mobile_no||e(l).data.phone}' copied to clipboard`))})):U("",!0)])):U("",!0)])])),e(_).loading?U("",!0):(p(!0),w(W,{key:1},K(h.value,o=>(p(),w("div",Ua,[(p(),B(Et,{key:o.label,label:o.label,hideLabel:o.hideLabel,opened:o.opened},{header:S(({opened:n,hide:c,toggle:s})=>[d("div",ja,[v(e(oe),{text:o.tooltipMessage},{default:S(()=>[d("span",{class:"text-ink-gray-8 font-medium text-base cursor-pointer select-none",onClick:s},F(o.label),9,Fa)]),_:2},1032,["text"]),v(y,{class:te(["size-4 text-ink-gray-6 cursor-pointer",{"rotate-180":n}]),onClick:s},null,8,["class","onClick"])])]),default:S(()=>[d("ul",null,[(p(!0),w(W,null,K(o.tickets,n=>(p(),w("li",{key:n.name,class:"py-2.5 cursor-pointer",onClick:c=>k(n.name)},[d("p",Ha,F(n.subject),1),d("div",Ia,[d("p",qa,[ge(F(x(n.creation)+" Â· ")+" ",1),d("span",Ea,F("#"+n.name),1)]),d("p",{class:te(["px-1.5 py-[3px] text-sm rounded-sm max-w-[80px] text-center truncate h-5",f(n.status)])},F(n.status),3)])],8,Ra))),128))])]),_:2},1032,["label","hideLabel","opened"]))]))),256))])}}}),Pa={class:"flex flex-col gap-2 my-2 w-[470px] rounded-lg bg-surface-modal shadow-2xl ring-1 ring-black p-3 ring-opacity-5 focus:outline-none"},Wa={class:"text-base text-ink-gray-5"},Ma=["onClick"],Oa={class:"ml-1"},Za={class:"cursor-pointer text-ink-gray-9"},Ja={class:"flex items-center justify-between gap-2"},Ga={__name:"AssignToBody",props:_e({doctype:{type:String,default:""},docname:{type:String,default:null},open:{type:Boolean,default:!1},onUpdate:{type:Function,default:null}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(C){const t=C,i=ke(C,"modelValue"),l=D([]),_=D(!1),g=D(""),{users:a,getUser:r}=Ee(),f=y=>{y===r("").name&&(_.value=!1),i.value=i.value.filter(o=>o.name!==y)},h=y=>{if(!y)return;y===r("").name&&(_.value=!0),g.value="";let o={name:y,image:r(y).user_image,label:r(y).full_name};i.value.find(n=>n.name===y)||i.value.push(o)};ie(_,y=>{let o=r("");y?h(o.name):f(o.name)}),ie(()=>t.open,y=>{y?(l.value=[...i.value||[]],_.value=i.value.some(o=>o.name===r("").name)):x()},{immediate:!0});async function x(){const y=i.value.map(s=>s.name),o=l.value.map(s=>s.name);if(JSON.stringify(o)===JSON.stringify(y))return;const n=l.value.filter(s=>!i.value.find($=>$.name===s.name)).map(s=>s.name),c=i.value.filter(s=>!l.value.find($=>$.name===s.name)).map(s=>s.name);if(c.length||n.length){let s=`${c.length?`assigned ${c.join(", ")}`:""} ${c.length&&n.length?" & ":""} ${n.length?`unassigned ${n.join(", ")}`:""}`;Ie("frappe.client.insert",{doc:{doctype:"HD Ticket Activity",ticket:t.docname,action:s}})}t.onUpdate?t.onUpdate(c,n,k,m):(n.length&&await m.submit(n),c.length&&await k.submit(c))}const k=G({url:"frappe.desk.form.assign_to.add",makeParams:y=>({doctype:t.doctype,name:t.docname,assign_to:y}),onSuccess:()=>{pt("assign_to",{doctype:t.doctype})}}),m=G({url:"helpdesk.api.doc.remove_assignments",makeParams:y=>({doctype:t.doctype,name:t.docname,assignees:y})}),b=xe("input");return vt(()=>{b.value.click()}),(y,o)=>{const n=N("FeatherIcon"),c=N("Button");return p(),w("div",Pa,[d("div",Wa,F(e(R)("Assign to")),1),v($e,{class:"form-control",value:"",doctype:"HD Agent",onChange:o[2]||(o[2]=s=>h(s)&&(y.$refs.input.value="")),placeholder:e(R)("John Doe"),filters:{is_active:!0,name:["not in",i.value.map(s=>s.name)]},hideMe:!0},{target:S(({togglePopover:s})=>[d("div",{class:"w-full min-h-12 flex flex-wrap items-center gap-1.5 p-1.5 pb-5 rounded-lg bg-surface-gray-2 cursor-text",onClick:ne(s,["stop"]),ref:"input"},[(p(!0),w(W,null,K(i.value,$=>(p(),B(e(oe),{text:$.name,key:$.name,onClick:o[1]||(o[1]=ne(()=>{},["stop"]))},{default:S(()=>[d("div",{class:"flex items-center text-sm p-0.5 text-ink-gray-6 border border-outline-gray-1 bg-surface-modal rounded-full cursor-pointer",onClick:o[0]||(o[0]=ne(()=>{},["stop"]))},[v(Fe,{name:$.name,size:"sm"},null,8,["name"]),d("div",Oa,F(e(r)($.name).full_name),1),v(c,{variant:"ghost",class:"rounded-full !size-4 m-1",onClick:ne(z=>f($.name),["stop"])},{icon:S(()=>[v(n,{name:"x",class:"h-3 w-3 text-ink-gray-6"})]),_:1},8,["onClick"])])]),_:2},1032,["text"]))),128))],8,Ma)]),"item-prefix":S(({option:s})=>[v(Fe,{class:"mr-2",name:s.value,size:"sm"},null,8,["name"])]),"item-label":S(({option:s})=>[v(e(oe),{text:s.value},{default:S(()=>[d("div",Za,F(e(r)(s.value).full_name),1)]),_:2},1032,["text"])]),_:1},8,["placeholder","filters"]),d("div",Ja,[d("div",{class:"text-base text-ink-gray-5 cursor-pointer select-none",onClick:o[3]||(o[3]=s=>_.value=!_.value)},F(e(R)("Assign to me")),1),v(e(Nt),{modelValue:_.value,"onUpdate:modelValue":o[4]||(o[4]=s=>_.value=s),onClick:o[5]||(o[5]=ne(()=>{},["stop"]))},null,8,["modelValue"])])])}}},Xa={class:"flex flex-col gap-1.5 w-full"},Ka={key:0},Qa={key:1,class:"flex gap-1.5 items-center"},Ya={key:0,class:"ml-2 text-sm text-ink-gray-8"},en=M({__name:"AssignTo",setup(C){const t=H(Q),i=H(we),l=H(le);async function _(a,r,f,h){r.length&&await h.submit(r),a.length&&await f.submit(a),l.value.reload()}const g=xe("assigneeButton");return X("a",()=>{var a,r,f;(f=(r=(a=g.value)==null?void 0:a.$el)==null?void 0:r.nextElementSibling)==null||f.click()}),(a,r)=>{const f=Ge,h=N("Button");return p(),B(e(_t),{class:"flex w-full",placement:"bottom-end"},{target:S(({open:x,close:k,togglePopover:m})=>[d("div",Xa,[r[1]||(r[1]=d("span",{class:"block text-xs text-gray-600"},"Assignee",-1)),v(h,{variant:"outline",class:"!flex !justify-start w-full active:!bg-inherit hover:shadow-sm",ref:"assigneeButton",onClick:b=>m()},{suffix:S(()=>[v(f,{icon:e(qe),class:"h-4 w-4 ml-auto text-ink-gray-5"},null,8,["icon"])]),default:S(()=>{var b,y,o,n;return[e(i).loading||((b=e(i).data)==null?void 0:b.length)===0?(p(),w("p",Ka,F(e(R)("No assignees")),1)):((y=e(i).data)==null?void 0:y.length)>=1?(p(),w("div",Qa,[v(Oe,{avatars:e(i).data.map(c=>c.name),size:"sm"},null,8,["avatars"]),((o=e(i).data)==null?void 0:o.length)>1?(p(),w("p",Ya,F((n=e(i).data)==null?void 0:n.length)+" assignees ",1)):U("",!0)])):U("",!0)]}),_:1},8,["onClick"])])]),body:S(({isOpen:x})=>[ft(v(Ga,{modelValue:e(i).data,"onUpdate:modelValue":r[0]||(r[0]=k=>e(i).data=k),doctype:"HD Ticket",docname:e(t).name,open:x,onUpdate:_},null,8,["modelValue","docname","open"]),[[gt,x]])]),_:1})}}}),tn={key:0,class:"my-4 flex items-center justify-start gap-5"},an={class:"flex flex-col gap-1.5"},nn={class:"flex gap-2.5 items-center"},sn={class:"text-ink-gray-8 font-medium text-xl max-w-[170px] truncate"},on={class:"flex gap-1.5"},ln=M({__name:"TicketContact",setup(C){const t=ue(),{getUser:i}=Ee(),{isCallingEnabled:l}=be(t),_=D(!1),g=H(Q),a=H(Se),r=A(()=>{var x,k,m,b,y;return((k=(x=a.value)==null?void 0:x.data)==null?void 0:k.image)||((y=i((b=(m=a.value)==null?void 0:m.data)==null?void 0:b.email_id))==null?void 0:y.user_image)||null});function f(x){let k=window.location.origin+"/app/contact/"+x;window.open(k,"_blank")}const h=()=>{if(!a.value.data.mobile_no&&!a.value.data.phone){_.value=!0;return}t.makeCall({number:a.value.data.mobile_no||a.value.data.phone,doctype:"HD Ticket",docname:g.value.name})};return(x,k)=>e(a).loading?U("",!0):(p(),w("div",tn,[v(e(Je),{label:e(a).data.name,image:r.value,size:"2xl"},null,8,["label","image"]),d("div",an,[v(e(oe),{text:e(a).data.name||e(a).data.email_id},{default:S(()=>[d("div",nn,[d("p",sn,F(e(a).data.name||e(a).data.email_id),1),v(e(Xt),{class:"size-4 text-ink-gray-6 cursor-pointer",onClick:k[0]||(k[0]=m=>f(e(a).data.name))})])]),_:1},8,["text"]),d("div",on,[v(e(oe),{text:e(a).data.email_id},{default:S(()=>[v(e(De),{size:"sm",onClick:k[1]||(k[1]=m=>e(Dt)())},{icon:S(()=>[v(ce,{class:"size-4"})]),_:1}),e(l)?(p(),B(e(De),{key:0,size:"sm",onClick:h},{icon:S(()=>[v(Ce,{class:"size-4"})]),_:1})):U("",!0)]),_:1},8,["text"])])]),v(Ne,{modelValue:_.value,"onUpdate:modelValue":k[2]||(k[2]=m=>_.value=m),name:e(a).data.name,onOnUpdate:e(a).reload},null,8,["modelValue","name","onOnUpdate"])]))}}),rn={class:"h-full overflow-y-hidden flex flex-1 flex-col justify-between overflow-hidden max-h-full"},cn={class:"px-5 pb-4 flex flex-col"},un={class:"border-t flex flex-col flex-1 h-full pb-3 overflow-y-hidden"},dn={class:"overflow-y-scroll max-h-[80%]"},mn=M({__name:"TicketDetailsTab",setup(C){var y;const t=H(Q),i=H(we),l=H(Te),_=H(le),{getFields:g,getField:a}=kt("HD Ticket"),{notifyTicketUpdate:r}=Pe((y=t.value)==null?void 0:y.name),f=A(()=>{const o=g();if(!o||o.length===0)return[];const n=[{group:!0,fields:[a("ticket_type"),a("priority")]},{group:!1,fields:[a("customer")]},{group:!0,fields:[a("agent_group")]}];return n.forEach(c=>{c.fields=c.fields.map(s=>(s=je(s,t.value.doc),s.required=s.reqd,s.ref=s.fieldname,s=x(s,s),s.visible=!0,s))}),n}),h=A(()=>{var $;const o=g();if(!o||o.length===0)return[];if(!l.value.data||l.value.loading)return[];let n=(($=l.value.data)==null?void 0:$.custom_fields)||[];const c=["ticket_type","priority","customer","agent_group","subject","status"];return n=n.filter(z=>!c.includes(z.fieldname)),n.map(z=>{let I=a(z.fieldname);return I=je(I,t.value.doc),I.required=I.reqd||z.required,x(z,I)})});function x(o,n){return{label:(n==null?void 0:n.label)||o.fieldname,value:t.value.doc[o.fieldname],fieldtype:n==null?void 0:n.fieldtype,doctype:(n==null?void 0:n.options)||"",options:(n==null?void 0:n.options)||"",placeholder:o.placeholder||`Enter ${(n==null?void 0:n.label)||o.fieldname}`,readonly:!!n.read_only,disabled:!!n.read_only,url_method:o.url_method||"",fieldname:o.fieldname,required:o.required||(n==null?void 0:n.required)||!1,visible:n.display_via_depends_on&&!n.hidden}}function k(o,n,c=!1){var s;if(t.value.doc[o]!=n){if(c){const $=((s=a(o))==null?void 0:s.label)||o;r($,n)}t.value.setValue.submit({[o]:n},{onSuccess:()=>{o==="agent_group"&&i.value.reload(),_.value.reload()}})}}const m=D({}),b=(o,n)=>{n&&(m.value[o]=n)};return X("t",()=>{var o,n,c,s;(s=(c=(n=(o=m.value)==null?void 0:o.ticket_type)==null?void 0:n.$el)==null?void 0:c.querySelector("button"))==null||s.click()}),X("p",()=>{var o,n,c,s;(s=(c=(n=(o=m.value)==null?void 0:o.priority)==null?void 0:n.$el)==null?void 0:c.querySelector("button"))==null||s.click()}),X({key:"t",shift:!0},()=>{var o,n,c,s;(s=(c=(n=(o=m.value)==null?void 0:o.agent_group)==null?void 0:n.$el)==null?void 0:c.querySelector("button"))==null||s.click()}),(o,n)=>(p(),w("div",rn,[d("div",cn,[v(ln),d("div",null,[(p(!0),w(W,null,K(f.value,(c,s)=>(p(),w("div",{key:s,class:te(c.group?"flex gap-2 items-center w-full mb-3":"mb-3")},[(p(!0),w(W,null,K(c.fields,$=>(p(),w(W,null,[$.visible?(p(),B(e($e),{key:$.fieldname,ref_for:!0,ref:z=>b($.fieldname,z),class:te(["form-control-core",c.group?"flex-1":"w-full"]),id:$.fieldname,"page-length":10,label:$.label,placeholder:$.placeholder,doctype:$.doctype,modelValue:$.value,required:$.required,"onUpdate:modelValue":z=>k($.fieldname,z,!0)},null,8,["id","class","label","placeholder","doctype","modelValue","required","onUpdate:modelValue"])):U("",!0)],64))),256))],2))),128)),v(en)])]),d("div",un,[d("div",dn,[(p(!0),w(W,null,K(h.value,c=>(p(),w(W,null,[c.visible?(p(),B(At,{key:c.fieldname,field:c,value:c.value,onChange:n[0]||(n[0]=({fieldname:s,value:$})=>k(s,$))},null,8,["field","value"])):U("",!0)],64))),256))])])]))}});const pn=re(mn,[["__scopeId","data-v-419c42cd"]]),vn={class:"flex-1 max-h-full"},fn=M({__name:"TicketSidebar",setup(C){const t=D("details"),i=[{label:R("Details"),value:"details"},{label:R("Contact"),value:"contact"}];return(l,_)=>(p(),B(wa,{class:"flex flex-col justify-between border-l",side:"right"},{default:S(()=>[v(e(qt),{buttons:i,modelValue:t.value,"onUpdate:modelValue":_[0]||(_[0]=g=>t.value=g),class:"tab-buttons mb-1 px-5 mt-3.5"},null,8,["modelValue"]),d("div",vn,[t.value==="details"?(p(),B(pn,{key:0})):(p(),B(Na,{key:1}))])]),_:1}))}});const ve=bt({}),_n=C=>{let t=!1;return ve[C]||(ve[C]={ticket:yt({doctype:"HD Ticket",name:C,whitelistedMethods:{markSeen:"mark_seen"},setValue:{onSuccess:()=>{ae.success(__("Ticket updated")),t=!1},onError:i=>{if(t)return;t=!0;const l=i.exc_type?(i.messages||i.message||[]).join(", "):i.message;ae.error(l)}}}),assignees:G({url:"helpdesk.helpdesk.doctype.hd_ticket.api.get_ticket_assignees",params:{ticket:C},auto:!0,transform:i=>JSON.parse(i).map(l=>({name:l}))}),contact:G({url:"helpdesk.helpdesk.doctype.hd_ticket.api.get_ticket_contact",params:{ticket:C},auto:!0}),recentSimilarTickets:G({url:"helpdesk.helpdesk.doctype.hd_ticket.api.get_recent_similar_tickets",params:{ticket:C},auto:!0}),activities:G({url:"helpdesk.helpdesk.doctype.hd_ticket.api.get_ticket_activities",params:{ticket:C},auto:!0})}),ve[C]},gn={key:0,class:"flex-1"},kn={class:"h-full flex overflow-hidden"},bn={class:"flex-1 flex flex-col overflow-hidden"},Qn=M({__name:"TicketAgent",props:{ticketId:{type:String,required:!0}},setup(C){const t=ue(),{$socket:i}=We(),l=C,_=ye(),g=D(!1),a=A(()=>_n(l.ticketId)),r=A(()=>a.value.ticket),f=()=>{r.value.reload(),a.value.activities.reload()},h=G({url:"helpdesk.helpdesk.doctype.hd_ticket.api.get_ticket_customizations",cache:["HD Ticket","customizations"],auto:!0});ee(Q,r),ee(we,A(()=>a.value.assignees)),ee(Se,A(()=>a.value.contact)),ee(Te,A(()=>h)),ee(Xe,A(()=>a.value.recentSimilarTickets)),ee(le,A(()=>a.value.activities)),ee("makeCall",()=>{var c,s,$,z;if(!((c=a.value.contact.data)!=null&&c.mobile_no)&&!((s=a.value.contact.data)!=null&&s.phone)){g.value=!0;return}t.makeCall({number:(($=a.value.contact.data)==null?void 0:$.phone)||((z=a.value.contact.data)==null?void 0:z.mobile_no),doctype:"HD Ticket",docname:l.ticketId})});const x=A(()=>Ut(r.value.name)),k=A(()=>x.value.currentViewers[l.ticketId]||[]),{startViewing:m,stopViewing:b}=x.value;ie(()=>_.params.ticketId,(c,s)=>{c!==s&&(s&&b(s),m(c))},{immediate:!0});const y=c=>{var s;String(c)===String((s=r.value)==null?void 0:s.name)&&f()},o=c=>{var s;String(c.ticket_id)===String((s=r.value)==null?void 0:s.name)&&(ae.info(`User ${c.user} updated ${c.field} to ${c.value}`),f())},n=c=>{var s;String(c.ticket)===String((s=r.value)==null?void 0:s.name)&&f()};return he(()=>{j.update({params:{ticket:l.ticketId,current_view:_.query.view}}),j.reload(),r.value.markSeen.reload(),i.on("ticket_update",o),i.on("helpdesk:ticket-update",y),i.on("helpdesk:ticket-communication",n)}),ht(()=>{b(l.ticketId),jt.value=!1,Ft.value=!1,i.off("ticket_update",o),i.off("helpdesk:ticket-update",y),i.off("helpdesk:ticket-communication",n)}),Pt(()=>({title:l.ticketId})),(c,s)=>{var $,z,I;return($=r.value.doc)!=null&&$.name?(p(),w("div",gn,[v($a,{viewers:k.value},null,8,["viewers"]),d("div",kn,[d("div",bn,[v(ia)]),v(fn)]),v(Ne,{modelValue:g.value,"onUpdate:modelValue":s[0]||(s[0]=Y=>g.value=Y),name:(I=(z=r.value.data)==null?void 0:z.contact)==null?void 0:I.name,onOnUpdate:r.value.reload},null,8,["modelValue","name","onOnUpdate"])])):U("",!0)}}});export{Qn as default};
//# sourceMappingURL=TicketAgent-3c4c6e2f.js.map
