import{d as O,A as T,K as j,aw as Mt,ax as rt,c as V,ay as ye,a8 as Ue,N as se,a4 as Y,aj as At,az as Z,aA as Ce,aB as Ft,F as H,aC as ut,a6 as He,a0 as J,aD as Dt,aE as tt,aF as Te,aG as te,aH as $e,aI as Pt,aJ as jt,aK as de,aL as le,aq as oe,e as r,f as L,w as C,k as _,G as X,h as e,C as be,ac as ke,l as a,a9 as K,x as Ve,y as R,t as Se,v as B,m as ae,n as ie,g,D as lt,E as at,Z as ct,r as U,q as D,a as Ee,U as Ze,W as ue,Q as fe,aM as pe,a3 as re,a7 as he,al as Rt,aN as Ke,aO as Ge,I as We,aP as _e,j as ne,aQ as Ut,aR as dt,av as Je,z as Q,aS as mt,aT as ft,b as pt,aU as Ot,aV as nt,ar as Oe,as as Ne,aW as me,$ as Ye,aX as Pe,O as Nt,aY as zt,H as qt,aZ as Ht,a_ as Zt,a$ as Kt,b0 as Gt,b1 as Wt,b2 as Jt,M as vt,L as Ie,s as gt,u as xt,R as Yt,b3 as Qt,aa as st,ag as ot,b4 as Xt}from"./index-70619bb5.js";import{s as G,a as yt,h as Qe,P as bt,i as el,d as tl,f as W,b as it,T as ll,L as ht,t as ze,j as qe}from"./TypingIndicator.vue_vue_type_style_index_0_scoped_3f215bd3_lang-b030ea09.js";import"./dayjs-5868d221.js";import{u as al}from"./LayoutHeader-330b6449.js";import{F as _t}from"./FileUploader-0ea47db7.js";import{_ as Me,T as Ct}from"./TextEditor.vue_vue_type_script_setup_true_lang-fba2d88c.js";import{_ as Ae}from"./AttachmentItem.vue_vue_type_script_setup_true_lang-c6d87231.js";import{_ as Fe}from"./EmailIcon-6f87f7a6.js";import{_ as kt}from"./UserAvatar.vue_vue_type_script_setup_true_lang-f3e181f4.js";import{_ as Xe}from"./Avatar.vue_vue_type_script_setup_true_lang-e2ccf576.js";import{_ as nl,a as sl}from"./MultipleAvatar.vue_vue_type_script_setup_true_lang-7d84c5a1.js";import{C as ol,D as il,s as rl,a as ul,b as cl,_ as wt}from"./CallLogModal.vue_vue_type_script_setup_true_lang-fb845699.js";import{P as $t}from"./PhoneIcon-8254e48c.js";import{u as It}from"./telephony-7ffcc91b.js";import{D as Le}from"./Dropdown-19778bff.js";import{_ as dl}from"./EmailContent-6c797d60.js";import{_ as ml}from"./StarRating.vue_vue_type_script_setup_true_lang-5b0e6a21.js";import{D as fl,_ as pl}from"./DateTimePicker-e0783882.js";import{_ as je}from"./Autocomplete-050816e8.js";import{a as vl}from"./Link-fff2e6d4.js";let gl=O({props:{onFocus:{type:Function,required:!0}},setup(t){let o=T(!0);return()=>o.value?j(rt,{as:"button",type:"button",features:Mt.Focusable,onFocus(m){m.preventDefault();let i,v=50;function f(){var n;if(v--<=0){i&&cancelAnimationFrame(i);return}if((n=t.onFocus)!=null&&n.call(t)){o.value=!1,cancelAnimationFrame(i);return}i=requestAnimationFrame(f)}i=requestAnimationFrame(f)}}):null}});var xl=(t=>(t[t.Forwards=0]="Forwards",t[t.Backwards=1]="Backwards",t))(xl||{}),yl=(t=>(t[t.Less=-1]="Less",t[t.Equal=0]="Equal",t[t.Greater=1]="Greater",t))(yl||{});let Tt=Symbol("TabsContext");function we(t){let o=J(Tt,null);if(o===null){let m=new Error(`<${t} /> is missing a parent <TabGroup /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(m,we),m}return o}let et=Symbol("TabsSSRContext"),bl=O({name:"TabGroup",emits:{change:t=>!0},props:{as:{type:[Object,String],default:"template"},selectedIndex:{type:[Number],default:null},defaultIndex:{type:[Number],default:0},vertical:{type:[Boolean],default:!1},manual:{type:[Boolean],default:!1}},inheritAttrs:!1,setup(t,{slots:o,attrs:m,emit:i}){var v;let f=T((v=t.selectedIndex)!=null?v:t.defaultIndex),n=T([]),u=T([]),c=V(()=>t.selectedIndex!==null),h=V(()=>c.value?t.selectedIndex:f.value);function l(x){var I;let S=ye(s.tabs.value,Z),p=ye(s.panels.value,Z),y=S.filter(d=>{var b;return!((b=Z(d))!=null&&b.hasAttribute("disabled"))});if(x<0||x>S.length-1){let d=Te(f.value===null?0:Math.sign(x-f.value),{[-1]:()=>1,0:()=>Te(Math.sign(x),{[-1]:()=>0,0:()=>0,1:()=>1}),1:()=>0}),b=Te(d,{0:()=>S.indexOf(y[0]),1:()=>S.indexOf(y[y.length-1])});b!==-1&&(f.value=b),s.tabs.value=S,s.panels.value=p}else{let d=S.slice(0,x),b=[...S.slice(x),...d].find(E=>y.includes(E));if(!b)return;let M=(I=S.indexOf(b))!=null?I:s.selectedIndex.value;M===-1&&(M=s.selectedIndex.value),f.value=M,s.tabs.value=S,s.panels.value=p}}let s={selectedIndex:V(()=>{var x,I;return(I=(x=f.value)!=null?x:t.defaultIndex)!=null?I:null}),orientation:V(()=>t.vertical?"vertical":"horizontal"),activation:V(()=>t.manual?"manual":"auto"),tabs:n,panels:u,setSelectedIndex(x){h.value!==x&&i("change",x),c.value||l(x)},registerTab(x){var I;if(n.value.includes(x))return;let S=n.value[f.value];if(n.value.push(x),n.value=ye(n.value,Z),!c.value){let p=(I=n.value.indexOf(S))!=null?I:f.value;p!==-1&&(f.value=p)}},unregisterTab(x){let I=n.value.indexOf(x);I!==-1&&n.value.splice(I,1)},registerPanel(x){u.value.includes(x)||(u.value.push(x),u.value=ye(u.value,Z))},unregisterPanel(x){let I=u.value.indexOf(x);I!==-1&&u.value.splice(I,1)}};Ue(Tt,s);let $=T({tabs:[],panels:[]}),k=T(!1);se(()=>{k.value=!0}),Ue(et,V(()=>k.value?null:$.value));let w=V(()=>t.selectedIndex);return se(()=>{Y([w],()=>{var x;return l((x=t.selectedIndex)!=null?x:t.defaultIndex)},{immediate:!0})}),At(()=>{if(!c.value||h.value==null||s.tabs.value.length<=0)return;let x=ye(s.tabs.value,Z);x.some((I,S)=>Z(s.tabs.value[S])!==Z(I))&&s.setSelectedIndex(x.findIndex(I=>Z(I)===Z(s.tabs.value[h.value])))}),()=>{let x={selectedIndex:f.value};return j(H,[n.value.length<=0&&j(gl,{onFocus:()=>{for(let I of n.value){let S=Z(I);if((S==null?void 0:S.tabIndex)===0)return S.focus(),!0}return!1}}),Ce({theirProps:{...m,...Ft(t,["selectedIndex","defaultIndex","manual","vertical","onChange"])},ourProps:{},slot:x,slots:o,attrs:m,name:"TabGroup"})])}}}),hl=O({name:"TabList",props:{as:{type:[Object,String],default:"div"}},setup(t,{attrs:o,slots:m}){let i=we("TabList");return()=>{let v={selectedIndex:i.selectedIndex.value},f={role:"tablist","aria-orientation":i.orientation.value};return Ce({ourProps:f,theirProps:t,slot:v,attrs:o,slots:m,name:"TabList"})}}}),_l=O({name:"Tab",props:{as:{type:[Object,String],default:"button"},disabled:{type:[Boolean],default:!1},id:{type:String,default:null}},setup(t,{attrs:o,slots:m,expose:i}){var v;let f=(v=t.id)!=null?v:`headlessui-tabs-tab-${ut()}`,n=we("Tab"),u=T(null);i({el:u,$el:u}),se(()=>n.registerTab(u)),He(()=>n.unregisterTab(u));let c=J(et),h=V(()=>{if(c.value){let p=c.value.tabs.indexOf(f);return p===-1?c.value.tabs.push(f)-1:p}return-1}),l=V(()=>{let p=n.tabs.value.indexOf(u);return p===-1?h.value:p}),s=V(()=>l.value===n.selectedIndex.value);function $(p){var y;let d=p();if(d===$e.Success&&n.activation.value==="auto"){let b=(y=jt(u))==null?void 0:y.activeElement,M=n.tabs.value.findIndex(E=>Z(E)===b);M!==-1&&n.setSelectedIndex(M)}return d}function k(p){let y=n.tabs.value.map(d=>Z(d)).filter(Boolean);if(p.key===te.Space||p.key===te.Enter){p.preventDefault(),p.stopPropagation(),n.setSelectedIndex(l.value);return}switch(p.key){case te.Home:case te.PageUp:return p.preventDefault(),p.stopPropagation(),$(()=>de(y,le.First));case te.End:case te.PageDown:return p.preventDefault(),p.stopPropagation(),$(()=>de(y,le.Last))}if($(()=>Te(n.orientation.value,{vertical(){return p.key===te.ArrowUp?de(y,le.Previous|le.WrapAround):p.key===te.ArrowDown?de(y,le.Next|le.WrapAround):$e.Error},horizontal(){return p.key===te.ArrowLeft?de(y,le.Previous|le.WrapAround):p.key===te.ArrowRight?de(y,le.Next|le.WrapAround):$e.Error}}))===$e.Success)return p.preventDefault()}let w=T(!1);function x(){var p;w.value||(w.value=!0,!t.disabled&&((p=Z(u))==null||p.focus({preventScroll:!0}),n.setSelectedIndex(l.value),Pt(()=>{w.value=!1})))}function I(p){p.preventDefault()}let S=Dt(V(()=>({as:t.as,type:o.type})),u);return()=>{var p,y;let d={selected:s.value,disabled:(p=t.disabled)!=null?p:!1},{...b}=t,M={ref:u,onKeydown:k,onMousedown:I,onClick:x,id:f,role:"tab",type:S.value,"aria-controls":(y=Z(n.panels.value[l.value]))==null?void 0:y.id,"aria-selected":s.value,tabIndex:s.value?0:-1,disabled:t.disabled?!0:void 0};return Ce({ourProps:M,theirProps:b,slot:d,attrs:o,slots:m,name:"Tab"})}}}),Cl=O({name:"TabPanels",props:{as:{type:[Object,String],default:"div"}},setup(t,{slots:o,attrs:m}){let i=we("TabPanels");return()=>{let v={selectedIndex:i.selectedIndex.value};return Ce({theirProps:t,ourProps:{},slot:v,attrs:m,slots:o,name:"TabPanels"})}}}),kl=O({name:"TabPanel",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},id:{type:String,default:null},tabIndex:{type:Number,default:0}},setup(t,{attrs:o,slots:m,expose:i}){var v;let f=(v=t.id)!=null?v:`headlessui-tabs-panel-${ut()}`,n=we("TabPanel"),u=T(null);i({el:u,$el:u}),se(()=>n.registerPanel(u)),He(()=>n.unregisterPanel(u));let c=J(et),h=V(()=>{if(c.value){let $=c.value.panels.indexOf(f);return $===-1?c.value.panels.push(f)-1:$}return-1}),l=V(()=>{let $=n.panels.value.indexOf(u);return $===-1?h.value:$}),s=V(()=>l.value===n.selectedIndex.value);return()=>{var $;let k={selected:s.value},{tabIndex:w,...x}=t,I={ref:u,id:f,role:"tabpanel","aria-labelledby":($=Z(n.tabs.value[l.value]))==null?void 0:$.id,tabIndex:s.value?w:-1};return!s.value&&t.unmount&&!t.static?j(rt,{as:"span","aria-hidden":!0,...I}):Ce({ourProps:I,theirProps:x,slot:k,attrs:o,slots:m,features:tt.Static|tt.RenderStrategy,visible:s.value,name:"TabPanel"})}}});const wl={__name:"TabList",setup(t){const o=J("tab"),m=T([]),i=T(null),v=V(()=>{var u;return(u=o.value.tabs.value)==null?void 0:u.length}),f=T("");function n(u){u>=v.value&&(u=v.value-1);const c=m.value[u].el;o.value.vertical.value?(i.value.style.height=`${c.offsetHeight}px`,i.value.style.top=`${c.offsetTop}px`):(i.value.style.width=`${c.offsetWidth}px`,i.value.style.left=`${c.offsetLeft}px`)}return Y(()=>o.value.tabIndex.value,u=>{u>=v.value&&(o.value.tabIndex.value=v.value-1),f.value="transition-all duration-300 ease-in-out",oe(()=>n(u))}),se(()=>{oe(()=>n(o.value.tabIndex.value)),setTimeout(()=>n(o.value.tabIndex.value),100)}),(u,c)=>(r(),L(e(hl),{class:K(["relative flex",e(o).vertical?"flex-col border-r overflow-y-auto":"gap-7.5 border-b overflow-x-auto items-center px-5"])},{default:C(()=>[(r(!0),_(H,null,X(e(o).tabs,(h,l)=>(r(),L(e(_l),{ref_for:!0,ref_key:"tabRef",ref:m,as:"template",key:l,class:"focus:outline-none focus:transition-none"},{default:C(({selected:s})=>[be(u.$slots,"default",ke({ref_for:!0},{tab:h,selected:s}),()=>[a("button",{class:K(["flex items-center gap-1.5 text-base text-ink-gray-5 duration-300 ease-in-out hover:text-ink-gray-9",[s?"text-ink-gray-9":"",e(o).vertical?"py-2.5 px-4 border-r border-transparent hover:border-outline-gray-3":"py-3 border-b border-transparent hover:border-outline-gray-3"]])},[h.icon?(r(),L(Ve(h.icon),{key:0,class:"size-4"})):R("",!0),Se(" "+B(h.label),1)],2)])]),_:2},1024))),128)),a("div",{ref_key:"indicator",ref:i,class:K(["tab-indicator absolute bg-surface-gray-7",[e(o).vertical?"right-0 w-px":"bottom-0 h-px",f.value]])},null,2)]),_:3},8,["class"]))}},$l={__name:"TabPanel",setup(t){const o=J("tab");return(m,i)=>(r(),L(e(Cl),{class:"flex flex-1 overflow-hidden"},{default:C(()=>[(r(!0),_(H,null,X(e(o).tabs,(v,f)=>(r(),L(e(kl),{class:"flex flex-1 flex-col overflow-y-auto focus:outline-none",key:f},{default:C(()=>[be(m.$slots,"default",ke({ref_for:!0},{tab:v}))]),_:2},1024))),128))]),_:3}))}},Cs={__name:"Tabs",props:ae({as:{type:String,default:"template"},tabs:{type:Array,required:!0},vertical:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const o=t,m=ie(t,"modelValue");return Ue("tab",V(()=>({tabIndex:m,tabs:o.tabs,vertical:o.vertical}))),(i,v)=>(r(),L(e(bl),ke(t.as!=="template"?{as:t.as,class:["flex flex-1 overflow-hidden",t.vertical?"":"flex-col "]}:{},{defaultIndex:m.value,selectedIndex:m.value,onChange:v[0]||(v[0]=f=>m.value=f)}),{default:C(()=>[be(i.$slots,"default",{},()=>[g(wl,null,{default:C(({tab:f,selected:n})=>[be(i.$slots,"tab-item",lt(at({tab:f,selected:n})))]),_:3}),g($l,null,{default:C(({tab:f})=>[be(i.$slots,"tab-panel",lt(at({tab:f})))]),_:3})])]),_:3},16,["defaultIndex","selectedIndex"]))}},Il={key:0,class:"mt-2 grid max-h-[560px] grid-cols-1 md:grid-cols-3 gap-2 overflow-y-auto"},Tl=["onClick"],Sl={class:"border-b pb-2 text-base font-semibold"},Ll={key:1,class:"mt-2"},Bl={class:"flex justify-end mt-4"},Vl={__name:"CannedResponseSelectorModal",props:ae({doctype:{type:String,default:""}},{modelValue:{},modelModifiers:{}}),emits:ae(["apply"],["update:modelValue"]),setup(t,{emit:o}){const m=t,i=ie(t,"modelValue"),v=T(""),f=o,n=T(""),u=ct({type:"list",doctype:"HD Canned Response",cache:["cannedResponses",m.doctype],fields:["title","message","modified"],orderBy:"modified desc",pageLength:99999});se(()=>{u.data==null&&u.fetch()}),He(()=>{G.value=!0});const c=V(()=>{var h;return((h=u.data)==null?void 0:h.filter(l=>l.title.toLowerCase().includes(n.value.toLowerCase())))??[]});return Y(i,h=>h&&oe(()=>{var l,s;return(s=(l=v.value)==null?void 0:l.el)==null?void 0:s.focus()})),(h,l)=>{const s=U("FeatherIcon"),$=U("TextInput"),k=U("Button"),w=U("Dialog");return r(),L(w,{modelValue:i.value,"onUpdate:modelValue":l[2]||(l[2]=x=>i.value=x),options:{title:"Canned Responses",size:"4xl"}},{"body-content":C(()=>[g($,{ref_key:"searchInput",ref:v,modelValue:n.value,"onUpdate:modelValue":l[0]||(l[0]=x=>n.value=x),type:"text",placeholder:e(D)("Site Down")},{prefix:C(()=>[g(s,{name:"search",class:"h-4 w-4 text-gray-500"})]),_:1},8,["modelValue","placeholder"]),c.value.length?(r(),_("div",Il,[(r(!0),_(H,null,X(c.value,x=>(r(),_("div",{key:x.name,class:"flex h-56 cursor-pointer flex-col gap-2 rounded-lg border p-3 hover:bg-gray-100",onClick:I=>f("apply",x)},[a("div",Sl,B(x.title),1),x.message?(r(),L(e(Me),{key:0,content:x.message,editable:!1,"editor-class":"!prose-sm max-w-none !text-sm text-gray-600 focus:outline-none",class:"flex-1 overflow-hidden"},null,8,["content"])):R("",!0)],8,Tl))),128))])):(r(),_("div",Ll,[...l[3]||(l[3]=[a("div",{class:"flex h-56 flex-col items-center justify-center"},[a("div",{class:"text-lg text-gray-500"},B("No templates found"))],-1)])])),a("div",Bl,[g(k,{label:e(D)("New Canned Response"),onClick:l[1]||(l[1]=()=>{h.$router.push("/canned-responses#new"),e(u).data=null})},null,8,["label"])])]),_:1},8,["modelValue"])}}},El={class:"mb-1 ml-0.5 flex items-center justify-between"},Ml={class:"text-gray-600 flex items-center gap-2"},Al={class:"font-medium text-gray-800"},Fl={class:"flex items-center gap-1"},Dl={class:"pl-0.5 text-sm text-gray-600"},Pl={key:0},jl=["id"],Rl={class:"flex flex-row-reverse gap-2"},Ul={key:0,class:"flex flex-wrap gap-2"},Ol=O({__name:"CommentBox",props:{activity:{type:Object,required:!0}},emits:["update"],setup(t,{emit:o}){const m=Ee(),i=t,{getUser:v}=Ze(),{name:f,creation:n,content:u,commenter:c,commentedBy:h,attachments:l}=i.activity,s=V(()=>/has been merged with ticket #\d+/.test(u)),$=o,k=T(!1),w=T(!1),x=T(u),I=T(null),S=T(null);function p(){w.value=!0,S.value.editor.chain().focus("start")}function y(){x.value=u,w.value=!1}const d=ue({url:"frappe.client.delete",makeParams:()=>({doctype:"HD Ticket Comment",name:f}),onSuccess(){$("update"),k.value=!1,fe.success("Comment deleted")}});function b(){if(u===x.value){w.value=!1;return}if(_e(x.value)){fe.error("Comment cannot be empty");return}al.submit({doctype:"HD Ticket Comment",name:f,fieldname:"content",value:x.value},{onSuccess:()=>{w.value=!1,$("update"),fe.success("Comment updated")}})}return se(()=>{I.value.style.width="0px"}),(M,E)=>{const F=U("Tooltip"),q=U("Button");return r(),_(H,null,[a("div",{class:"flex-col text-base flex-1",ref_key:"commentBoxRef",ref:I},[a("div",El,[a("div",Ml,[g(e(Xe),{size:"md",label:e(c),image:e(v)(e(h)).user_image},null,8,["label","image"]),a("p",null,[a("span",Al,B(e(c)),1),E[2]||(E[2]=a("span",null," added a",-1)),E[3]||(E[3]=a("span",{class:"max-w-xs truncate font-medium text-gray-800"}," comment ",-1))])]),a("div",Fl,[g(F,{text:e(re)(e(n),e(he))},{default:C(()=>[a("span",Dl,B(e(pe)(e(n))),1)]),_:1},8,["text"]),e(m).userId===e(h)&&!w.value?(r(),_("div",Pl,[g(e(Le),{placement:"right",options:[{label:"Edit",onClick:()=>p(),icon:"edit-2",condition:()=>!s.value},{label:"Delete",onClick:()=>k.value=!0,icon:"trash-2"}]},{default:C(()=>[g(q,{icon:"more-horizontal",class:"text-gray-600",variant:"ghost"})]),_:1},8,["options"])])):R("",!0)])]),a("div",{id:`comment-${e(f)}`,class:"rounded bg-gray-50 transition-colors px-4 py-3"},[g(e(Me),{ref_key:"editorRef",ref:S,"editor-class":["prose-f shrink text-p-sm transition-all duration-300 ease-in-out block w-full content",e(Ke)(x.value)],content:x.value,editable:w.value,"bubble-menu":e(Ge),onChange:E[0]||(E[0]=N=>{x.value=N})},Rt({_:2},[w.value?{name:"bottom",fn:C(()=>[a("div",Rl,[g(q,{label:e(D)("Save"),onClick:b,variant:"solid"},null,8,["label"]),g(q,{label:e(D)("Discard"),onClick:y},null,8,["label"])])]),key:"0"}:void 0]),1032,["editor-class","content","editable","bubble-menu"]),w.value?R("",!0):(r(),_("div",Ul,[(r(!0),_(H,null,X(e(l),N=>(r(),L(e(Ae),{key:N.file_url,label:N.file_name,url:N.file_url},null,8,["label","url"]))),128))]))],8,jl)],512),g(e(We),{modelValue:k.value,"onUpdate:modelValue":E[1]||(E[1]=N=>k.value=N),options:{title:"Delete Comment",message:"Are you sure you want to confirm this action?",actions:[{label:"Cancel",onClick:()=>k.value=!1},{label:"Delete",onClick:()=>e(d).submit(),variant:"solid"}]}},null,8,["modelValue","options"])],64)}}}),Nl={},zl={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function ql(t,o){return r(),_("svg",zl,[...o[0]||(o[0]=[a("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M6.29021 2.64272C6.68375 0.785763 9.33429 0.785757 9.72783 2.64272L10.3657 5.65238L13.3753 6.29021C15.2323 6.68375 15.2323 9.33429 13.3753 9.72783L10.3657 10.3657L9.72783 13.3753C9.33429 15.2323 6.68375 15.2323 6.29021 13.3753L5.65238 10.3657L2.64272 9.72783C0.785763 9.33429 0.785757 6.68375 2.64272 6.29021L5.65238 5.65238L6.29021 2.64272ZM8.74956 2.85004C8.58 2.04999 7.43804 2.04998 7.26848 2.85004L6.56324 6.17777L6.49584 6.49583L6.17777 6.56324L2.85004 7.26848C2.04999 7.43804 2.04998 8.58 2.85004 8.74956L6.17777 9.4548L6.49584 9.5222L6.56324 9.84027L7.26848 13.168C7.43804 13.9681 8.58 13.9681 8.74956 13.168L9.4548 9.84027L9.5222 9.5222L9.84027 9.4548L13.168 8.74956C13.9681 8.58 13.9681 7.43804 13.168 7.26848L9.84027 6.56324L9.5222 6.49583L9.4548 6.17777L8.74956 2.85004Z",fill:"currentColor"},null,-1)])])}const Hl=ne(Nl,[["render",ql]]),Zl={},Kl={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Gl(t,o){return r(),_("svg",Kl,[...o[0]||(o[0]=[a("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M12.5684 2.50774C11.5403 1.49742 9.95026 1.49742 8.92215 2.50774L3.62404 7.71417C2.12532 9.18695 2.12532 11.669 3.62404 13.1418C5.12762 14.6194 7.66861 14.6194 9.17219 13.1418L12.1609 10.2049C12.3578 10.0113 12.6744 10.0141 12.8679 10.211C13.0615 10.408 13.0587 10.7246 12.8618 10.9181L9.8731 13.8551C7.98045 15.715 4.81578 15.715 2.92313 13.8551C1.02562 11.9904 1.02562 8.86558 2.92313 7.00091L8.22124 1.79449C9.63842 0.401838 11.8521 0.401838 13.2693 1.79449C14.6914 3.19191 14.6914 5.38225 13.2693 6.77968L13.2668 6.78213L13.2668 6.78212L8.37876 11.5189C8.37834 11.5193 8.37793 11.5197 8.37752 11.5201C7.51767 12.3638 6.11144 12.3939 5.29119 11.5097C4.43611 10.6596 4.40778 9.26893 5.30922 8.46081L7.33823 6.46692C7.53518 6.27337 7.85175 6.27613 8.04531 6.47309C8.23886 6.67005 8.23609 6.98662 8.03913 7.18017L6.0014 9.18264L5.99203 9.19185L5.98219 9.20055C5.5391 9.59243 5.5104 10.3231 6.0014 10.8056L6.01078 10.8148L6.01967 10.8245C6.42299 11.2649 7.18224 11.2926 7.67785 10.8056L7.68034 10.8032L7.68035 10.8032L12.5684 6.06643C12.5688 6.06604 12.5692 6.06565 12.5696 6.06526C13.5917 5.05969 13.5913 3.51289 12.5684 2.50774Z",fill:"currentColor"},null,-1)])])}const St=ne(Zl,[["render",Gl]]),Wl={},Jl={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Yl(t,o){return r(),_("svg",Jl,[...o[0]||(o[0]=[a("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M8 2.5C4.2911 2.5 1.5 4.84419 1.5 7.5C1.5 9.14452 2.54729 10.6518 4.25112 11.5816C4.50048 11.7177 4.758 12.0041 4.7326 12.4082C4.71107 12.7508 4.61659 13.2533 4.47175 13.6657C4.44071 13.7541 4.40789 13.8389 4.37434 13.9195C4.62005 13.8524 4.91964 13.7411 5.26646 13.5579C5.48882 13.4404 5.69385 13.2901 5.9102 13.1207C5.95058 13.089 5.9922 13.056 6.03481 13.0222C6.20816 12.8848 6.39803 12.7342 6.58835 12.6102C6.7875 12.4803 7.01146 12.4447 7.20831 12.4631C7.46767 12.4875 7.73186 12.5 8 12.5C11.7089 12.5 14.5 10.1558 14.5 7.5C14.5 4.84419 11.7089 2.5 8 2.5ZM0.5 7.5C0.5 4.08068 3.97691 1.5 8 1.5C12.0231 1.5 15.5 4.08068 15.5 7.5C15.5 10.9193 12.0231 13.5 8 13.5C7.70158 13.5 7.40709 13.4861 7.11751 13.459C6.97583 13.5528 6.83777 13.6621 6.67569 13.7905C6.62832 13.828 6.5789 13.8671 6.52674 13.908C6.30071 14.085 6.03818 14.2812 5.73354 14.4421C4.73389 14.9702 3.9948 15.0302 3.62977 15.0147C3.39759 15.0048 3.20936 14.8646 3.12194 14.6754C3.03801 14.4938 3.05143 14.2816 3.15736 14.1099C3.24804 13.963 3.40655 13.6808 3.52825 13.3343C3.62961 13.0457 3.70134 12.6878 3.72712 12.4347C1.81521 11.3748 0.5 9.58517 0.5 7.5Z",fill:"currentColor"},null,-1)])])}const Be=ne(Wl,[["render",Yl]]),Ql={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Xl=["r"],ea={__name:"DotIcon",props:{radius:{type:Number,default:3.5}},setup(t){return(o,m)=>(r(),_("svg",Ql,[a("circle",{cx:"8",cy:"8",r:t.radius,fill:"currentColor"},null,8,Xl)]))}},ta={},la={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function aa(t,o){return r(),_("svg",la,[...o[0]||(o[0]=[a("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M5.85355 3.14645C5.65829 2.95118 5.34171 2.95118 5.14645 3.14645L1.14645 7.14645C0.951184 7.34171 0.951184 7.65829 1.14645 7.85355L5.14645 11.8536C5.34171 12.0488 5.65829 12.0488 5.85355 11.8536C6.04882 11.6583 6.04882 11.3417 5.85355 11.1464L2.20711 7.5L5.85355 3.85355C6.04882 3.65829 6.04882 3.34171 5.85355 3.14645ZM10 8C11.933 8 13.5 9.567 13.5 11.5V12C13.5 12.2761 13.7239 12.5 14 12.5C14.2761 12.5 14.5 12.2761 14.5 12V11.5C14.5 9.01472 12.4853 7 10 7H6.6728L9.81924 3.85355C10.0145 3.65829 10.0145 3.34171 9.81924 3.14645C9.62398 2.95118 9.3074 2.95118 9.11214 3.14645L5.11214 7.14645C4.91688 7.34171 4.91688 7.65829 5.11214 7.85355L9.11214 11.8536C9.3074 12.0488 9.62398 12.0488 9.81924 11.8536C10.0145 11.6583 10.0145 11.3417 9.81924 11.1464L6.6728 8H10Z",fill:"currentColor"},null,-1)])])}const na=ne(ta,[["render",aa]]),sa={},oa={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function ia(t,o){return r(),_("svg",oa,[...o[0]||(o[0]=[a("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M5.64645 3.14645C5.84171 2.95118 6.15829 2.95118 6.35355 3.14645C6.54882 3.34171 6.54882 3.65829 6.35355 3.85355L3.20711 7H10C12.4853 7 14.5 9.01472 14.5 11.5V12C14.5 12.2761 14.2761 12.5 14 12.5C13.7239 12.5 13.5 12.2761 13.5 12V11.5C13.5 9.567 11.933 8 10 8H3.20711L6.35355 11.1464C6.54882 11.3417 6.54882 11.6583 6.35355 11.8536C6.15829 12.0488 5.84171 12.0488 5.64645 11.8536L1.64645 7.85355C1.45118 7.65829 1.45118 7.34171 1.64645 7.14645L5.64645 3.14645Z",fill:"currentColor"},null,-1)])])}const ra=ne(sa,[["render",ia]]),ua={},ca={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function da(t,o){return r(),_("svg",ca,[...o[0]||(o[0]=[a("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M5.85355 9.64645C5.65829 9.45118 5.34171 9.45118 5.14645 9.64645C4.95118 9.84171 4.95118 10.1583 5.14645 10.3536L7.64645 12.8536C7.84171 13.0488 8.15829 13.0488 8.35355 12.8536L10.8536 10.3536C11.0488 10.1583 11.0488 9.84171 10.8536 9.64645C10.6583 9.45118 10.3417 9.45118 10.1464 9.64645L8 11.7929L5.85355 9.64645ZM5.85355 6.35355C5.65829 6.54882 5.34171 6.54882 5.14645 6.35355C4.95118 6.15829 4.95118 5.84171 5.14645 5.64645L7.64645 3.14645C7.84171 2.95118 8.15829 2.95118 8.35355 3.14645L10.8536 5.64645C11.0488 5.84171 11.0488 6.15829 10.8536 6.35355C10.6583 6.54882 10.3417 6.54882 10.1464 6.35355L8 4.20711L5.85355 6.35355Z",fill:"currentColor"},null,-1)])])}const ma=ne(ua,[["render",da]]),fa=Ut("agent",()=>{const t=ct({doctype:"HD Agent",fields:["name","agent_name","user","user.user_image"],filters:{is_active:1},pageLength:99999}),o=V(()=>{var i;return(i=t.data)==null?void 0:i.map(v=>({label:v.agent_name,value:v.name}))});function m(i){return t.data.filter(v=>{var f;return(f=v.user)==null?void 0:f.toLowerCase().includes(i.toLowerCase())})}return{dropdown:o,agents:t,searchAgents:m}}),pa={key:0,class:"flex flex-col gap-2 px-6 md:pl-10 md:pr-9"},va={class:"flex flex-wrap gap-2"},ga={class:"flex justify-between overflow-hidden border-t py-2.5"},xa={class:"flex items-center overflow-x-auto w-[60%]"},ya={class:"flex items-center justify-end space-x-2 w-[40%]"},ba=O({__name:"CommentTextEditor",props:{ticketId:{type:String,default:null},placeholder:{type:String,default:null},label:{type:String,default:"Comment"},editable:{type:Boolean,default:!0},doctype:{type:String,default:"HD Ticket"}},emits:["submit","discard"],setup(t,{expose:o,emit:m}){const{updateOnboardingStep:i}=yt("helpdesk"),{agents:v}=fa(),{isManager:f}=Ee();se(()=>{var d;v.loading||(d=v.data)!=null&&d.length||v.list.promise||v.fetch()});const n=t,u=m,c=dt("commentBoxContent"+n.ticketId,null),{onUserType:h,cleanup:l}=Qe(n.ticketId),s=T([]),$=V(()=>_e(c.value)),k=T(!1);Y(c,(d,b)=>{d!==b&&d&&h()}),Je(()=>{l()});const w=V(()=>k.value?"Sending...":n.label),x=V(()=>{var d;return((d=v.data)==null?void 0:d.map(b=>({label:b.agent_name.trimEnd(),value:b.name})))||[]});function I(d){s.value=s.value.filter(b=>b!==d),ft(d.name)}async function S(){if(_e(c.value))return!1;ue({url:"run_doc_method",makeParams:()=>({dt:n.doctype,dn:n.ticketId,method:"new_comment",args:{content:c.value,attachments:s.value}}),onSuccess:()=>{f&&i("comment_on_ticket"),u("submit"),k.value=!1,s.value=[],c.value=null},onError:()=>{k.value=!1}}).submit()}const p=T(null),y=V(()=>{var d;return(d=p.value)==null?void 0:d.editor});return o({submitComment:S,editor:y}),(d,b)=>{const M=U("FeatherIcon"),E=U("Button");return e(v).data?(r(),L(e(Me),{key:0,ref_key:"editorRef",ref:p,"editor-class":["prose-sm max-w-none",t.editable&&"min-h-[7rem] mx-6 md:ml-10 md:mr-9 max-h-[50vh] overflow-y-auto border-t py-3",e(Ke)(e(c))],content:e(c),"starterkit-options":{heading:{levels:[2,3,4,5,6]}},placeholder:t.placeholder,editable:t.editable,mentions:x.value,onChange:b[3]||(b[3]=F=>t.editable?c.value=F:null),extensions:[e(bt)],uploadFunction:F=>e(mt)(F,t.doctype,t.ticketId)},{bottom:C(()=>[t.editable?(r(),_("div",pa,[a("div",va,[(r(!0),_(H,null,X(s.value,F=>(r(),L(e(Ae),{key:F.file_url,label:F.file_name,url:["MOV","MP4"].includes(F.file_type)?null:F.file_url},{suffix:C(()=>[g(M,{class:"h-3.5",name:"x",onClick:Q(q=>I(F),["stop"])},null,8,["onClick"])]),_:2},1032,["label","url"]))),128))]),a("div",ga,[a("div",xa,[g(e(Ct),{class:"-ml-1",buttons:e(Ge)},null,8,["buttons"]),g(e(_t),{"upload-args":{doctype:t.doctype,docname:t.ticketId,private:!0},onSuccess:b[0]||(b[0]=F=>s.value.push(F))},{default:C(({openFileSelector:F})=>[g(E,{theme:"gray",variant:"ghost",onClick:q=>F()},{icon:C(()=>[g(e(St),{class:"h-4",style:{color:"#000000","stroke-width":"1.5 !important"}})]),_:1},8,["onClick"])]),_:1},8,["upload-args"])]),a("div",ya,[g(E,{label:e(D)("Discard"),onClick:b[1]||(b[1]=()=>{c.value="",s.value=[],u("discard")})},null,8,["label"]),g(E,{variant:"solid",label:w.value,disabled:$.value,loading:k.value,onClick:b[2]||(b[2]=()=>{k.value=!0,S(),c.value=""})},null,8,["label","disabled","loading"])])])])):R("",!0)]),_:1},8,["editor-class","content","placeholder","editable","mentions","extensions","uploadFunction"])):R("",!0)}}}),ha={class:"comm-area"},_a={class:"flex justify-between gap-3 border-t px-6 md:px-10 py-4 md:py-2.5"},Ca={class:"flex gap-1.5 items-center"},ka=["onKeydownCapture"],wa=["onKeydownCapture"],ks=O({__name:"CommunicationArea",props:ae({doctype:{type:String,default:"HD Ticket"},ticketId:{type:String,default:null},toEmails:{type:Array,default:()=>[]},ccEmails:{type:Array,default:()=>[]},bccEmails:{type:Array,default:()=>[]}},{content:{},contentModifiers:{},modelValue:{},modelModifiers:{}}),emits:ae(["update"],["update:content","update:modelValue"]),setup(t,{expose:o,emit:m}){const i=m,v=ie(t,"content"),{isMac:f}=el(),{isMobileView:n}=pt();ie(t,"modelValue");const u=T(null),c=T(null),h=T(null),l=T(null),s=t,{notifyTicketUpdate:$}=tl(Ot(s,"ticketId"));function k(){W.value&&(W.value=!1),G.value=!G.value}function w(){G.value&&(G.value=!1),W.value=!W.value}function x(){u.value.submitMail()&&(i("update"),$("communication",new Date().toISOString()))}function I(){c.value.submitComment()&&(i("update"),$("comment",new Date().toISOString()))}function S(y){return typeof y=="string"?y.split(","):y}function p(y){G.value=!0,u.value.addToReply(y.content,S(y.to),S(y.cc),S(y.bcc))}return Y(()=>G.value,y=>{var d,b,M;y&&((M=(b=(d=u.value)==null?void 0:d.editor)==null?void 0:b.commands)==null||M.focus())}),Y(()=>W.value,y=>{var d,b,M;y&&((M=(b=(d=c.value)==null?void 0:d.editor)==null?void 0:b.commands)==null||M.focus())}),it("r",()=>{k()}),it("c",()=>{w()}),o({replyToEmail:p,toggleEmailBox:k,toggleCommentBox:w,editor:u}),nt(h,()=>{G.value&&(G.value=!1)}),nt(l,()=>{W.value&&(W.value=!1)}),(y,d)=>{const b=U("Button");return r(),_("div",ha,[a("div",_a,[a("div",Ca,[g(b,{ref:"sendEmailRef",variant:"ghost",label:e(D)("Reply"),class:K([e(G)?"!bg-gray-300 hover:!bg-gray-200":""]),onClick:d[0]||(d[0]=M=>k())},{prefix:C(()=>[g(e(Fe),{class:"h-4"})]),_:1},8,["label","class"]),g(b,{variant:"ghost",label:e(D)("Comment"),class:K([e(W)?"!bg-gray-300 hover:!bg-gray-200":""]),onClick:d[1]||(d[1]=M=>w())},{prefix:C(()=>[g(e(Be),{class:"h-4"})]),_:1},8,["label","class"]),g(e(kn),{ticketId:t.ticketId},null,8,["ticketId"])])]),Oe(a("div",{ref_key:"emailBoxRef",ref:h,class:"flex gap-1.5 flex-1",onKeydownCapture:[me(Q(x,["ctrl","stop"]),["enter"]),me(Q(x,["meta","stop"]),["enter"])]},[g(e(en),{ref_key:"emailEditorRef",ref:u,label:e(n)?"Send":e(f)?"Send (⌘ + ⏎)":"Send (Ctrl + ⏎)",content:v.value,"onUpdate:content":d[2]||(d[2]=M=>v.value=M),placeholder:e(D)("Hi John, we are looking into this issue."),ticketId:t.ticketId,"to-emails":t.toEmails,"cc-emails":t.ccEmails,"bcc-emails":t.bccEmails,onSubmit:d[3]||(d[3]=()=>{G.value=!1,i("update")}),onDiscard:d[4]||(d[4]=()=>{G.value=!1})},null,8,["label","content","placeholder","ticketId","to-emails","cc-emails","bcc-emails"])],40,ka),[[Ne,e(G)]]),Oe(a("div",{ref_key:"commentBoxRef",ref:l,onKeydownCapture:[me(Q(I,["ctrl","stop"]),["enter"]),me(Q(I,["meta","stop"]),["enter"])]},[g(e(ba),{ref_key:"commentTextEditorRef",ref:c,label:e(n)?"Comment":e(f)?"Comment (⌘ + ⏎)":"Comment (Ctrl + ⏎)",ticketId:t.ticketId,editable:e(W),doctype:t.doctype,placeholder:e(D)("@John could you please look into this?"),onSubmit:d[5]||(d[5]=()=>{W.value=!1,i("update")}),onDiscard:d[6]||(d[6]=()=>{W.value=!1})},null,8,["label","ticketId","editable","doctype","placeholder"])],40,wa),[[Ne,e(W)]])])}}}),$a={class:"flex flex-col gap-4"},Ia={class:"flex items-center gap-2 rounded-md p-2 ring-1 ring-gray-200"},Ta=O({__name:"TicketSplitModal",props:ae({ticket_id:{},communication_id:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:ae(["update"],["update:modelValue"]),setup(t,{emit:o}){const m=t,i=ie(t,"modelValue"),v=T(null),f=ue({url:"helpdesk.helpdesk.doctype.hd_ticket.api.split_ticket",makeParams({subject:u,communication_id:c}){return{subject:u,communication_id:c}},validate({subject:u,communication_id:c}){if(!u)throw{message:"Subject is required"};if(!c)throw{message:"Communication ID is required"}},onSuccess:u=>{fe.success("Ticket split successfully"),i.value=!1,window.open(window.location.origin+"/helpdesk/tickets/"+u,"_blank"),window.location.reload()}});function n(){f.submit({subject:v.value,communication_id:m.communication_id})}return(u,c)=>{const h=U("FormControl"),l=U("Button");return r(),L(e(We),{options:{title:"Split ticket"},modelValue:i.value,"onUpdate:modelValue":c[1]||(c[1]=s=>i.value=s)},{"body-content":C(()=>[a("div",$a,[c[3]||(c[3]=a("p",{class:"text-p-base text-ink-gray-8"},[Se(" All "),a("span",{class:"underline"},"emails/ comments"),Se(" from this email onwards will be moved to new ticket. ")],-1)),g(h,{label:e(D)("New Ticket Subject"),type:"text",modelValue:v.value,"onUpdate:modelValue":c[0]||(c[0]=s=>v.value=s),placeholder:e(D)("Add a subject for the new ticket")},null,8,["label","modelValue","placeholder"]),a("div",Ia,[g(e(ll),{class:"h-6 w-5 w-min-5 w-max-5 min-h-5 max-w-5 text-yellow-500"}),c[2]||(c[2]=a("div",{class:"text-wrap text-sm text-gray-700"}," This action is irreversible. ",-1))])])]),actions:C(()=>[g(l,{class:"w-full",variant:"solid",label:e(D)("Split into new ticket"),loading:e(f).loading,"icon-left":e(ht),onClick:n},null,8,["label","loading","icon-left"])]),_:1},8,["modelValue"])}}}),Sa=["id"],La={key:0,class:"flex items-center gap-2 text-sm"},Ba={class:"leading-tight"},Va={class:"text-xs md:text-sm text-gray-600"},Ea={key:0,class:"sm:flex hidden text-sm text-gray-600"},Ma={key:1,class:"flex items-center gap-1"},Aa={key:0,class:"sm:flex hidden text-sm text-gray-600"},Fa={class:"flex gap-0.5 items-center"},Da={class:"text-xs md:text-sm text-gray-600"},Pa={class:"text-sm leading-5 text-gray-600"},ja={key:0,class:"text-2xs mr-1 font-bold text-gray-500"},Ra={key:1},Ua={key:2},Oa={key:3,class:"text-2xs mr-1 font-bold text-gray-500"},Na={key:4},za={key:5},qa={key:6,class:"text-2xs mr-1 font-bold text-gray-500"},Ha={key:7},Za={class:"flex flex-wrap gap-2"},Ka=O({__name:"EmailArea",props:{activity:{type:Object,required:!0},showSplitOption:{type:Boolean,default:!1}},emits:["reply"],setup(t,{emit:o}){const m=t,{sender:i,to:v,cc:f,bcc:n,creation:u,subject:c,attachments:h,content:l,name:s,deliveryStatus:$}=m.activity,k=o,w=Ye(Ee()),{isMobileView:x}=pt(),I=T(!1),S=V(()=>{let d=$,b="red";return["Sent","Clicked"].includes(d)?b="green":["Sending","Scheduled"].includes(d)?b="orange":["Opened","Read"].includes(d)?b="blue":d=="Error"&&(b="red"),{label:d,color:b}}),p=()=>{const d=w.user.value;k("reply",{content:l,to:d===i.name?v:i.name})},y=()=>{const d=w.user.value,b=ge=>{let xe;return typeof ge=="string"?xe=ge.split(",").map(ce=>ce.trim()):xe=ge||[],xe.filter(ce=>ce!==d&&ce!==i.name)},M=b(v),E=b(f),F=b(n);let q,N,ve;d===i.name?(q=M.join(", "),N=E,ve=F):(q=i.name,N=[...M,...E],ve=F),k("reply",{content:l,to:q,cc:N.filter(Boolean),bcc:ve.filter(Boolean)})};return(d,b)=>{const M=U("Tooltip"),E=U("Badge"),F=U("Button"),q=dl;return r(),_(H,null,[a("div",ke({id:`communication-${e(s)}`},d.$attrs,{class:"grow cursor-pointer border-transparent bg-white rounded-md shadow text-base leading-6 transition-all duration-300 ease-in-out"}),[a("div",{class:K(["flex items-center justify-between gap-2",e(x)&&"items-start"])},[e(x)?(r(),_("div",La,[a("div",Ba,[a("p",null,B(e(i).full_name||"No name found"),1),g(M,{text:e(re)(e(u),e(he))},{default:C(()=>[a("p",Va,B(e(pe)(e(u))),1)]),_:1},8,["text"]),e(i).name?(r(),_("p",Ea,B("<"+e(i).name+">"),1)):R("",!0)])])):(r(),_("div",Ma,[a("span",null,B(e(i).full_name||"No name found"),1),e(i).name?(r(),_("span",Aa,B("<"+e(i).name+">"),1)):R("",!0)])),a("div",Fa,[S.value.label?(r(),L(E,{key:0,label:e(D)(S.value.label),variant:"subtle",theme:S.value.color,class:"mr-1.5"},null,8,["label","theme"])):R("",!0),e(x)?R("",!0):(r(),L(M,{key:1,text:e(re)(e(u),e(he))},{default:C(()=>[a("p",Da,B(e(pe)(e(u))),1)]),_:1},8,["text"])),g(F,{variant:"ghost",class:"text-gray-700",onClick:p},{default:C(()=>[g(e(ra),{class:"h-4 w-4"})]),_:1}),g(F,{variant:"ghost",class:"text-gray-700",onClick:y},{default:C(()=>[g(e(na),{class:"h-4 w-4"})]),_:1}),t.showSplitOption?(r(),L(e(Le),{key:2,placement:"right",options:[{label:"Split Ticket",icon:e(ht),onClick:()=>I.value=!0}]},{default:C(()=>[g(F,{icon:"more-horizontal",class:"text-gray-600",variant:"ghost"})]),_:1},8,["options"])):R("",!0)])],2),a("div",Pa,[e(v)?(r(),_("span",ja,"TO:")):R("",!0),e(v)?(r(),_("span",Ra,B(e(v)),1)):R("",!0),e(f)?(r(),_("span",Ua,", ")):R("",!0),e(f)?(r(),_("span",Oa," CC: ")):R("",!0),e(f)?(r(),_("span",Na,B(e(f)),1)):R("",!0),e(n)?(r(),_("span",za,", ")):R("",!0),e(n)?(r(),_("span",qa," BCC: ")):R("",!0),e(n)?(r(),_("span",Ha,B(e(n)),1)):R("",!0)]),b[1]||(b[1]=a("div",{class:"border-0 border-t my-3 border-outline-gray-modals"},null,-1)),g(q,{content:e(l)},null,8,["content"]),a("div",Za,[(r(!0),_(H,null,X(e(h),N=>(r(),L(e(Ae),{key:N.file_url,label:N.file_name,url:N.file_url},null,8,["label","url"]))),128))])],16,Sa),g(Ta,{modelValue:I.value,"onUpdate:modelValue":b[0]||(b[0]=N=>I.value=N),ticket_id:e(s),communication_id:e(s)},null,8,["modelValue","ticket_id","communication_id"])],64)}}}),Ga={class:"mx-6 md:mx-10 flex items-center gap-2 border-y py-2.5"},Wa={class:"flex flex-wrap gap-2 px-10"},Ja={class:"flex justify-between overflow-scroll pl-10 py-2.5 items-center"},Ya={class:"flex items-center overflow-x-auto w-[60%]"},Qa={class:"flex gap-1"},Xa={class:"flex items-center justify-end space-x-2 sm:mt-0 w-[40%] mr-9"},en=O({__name:"EmailEditor",props:{ticketId:{type:String,default:null},placeholder:{type:String,default:null},label:{type:String,default:"Send"},editable:{type:Boolean,default:!0},doctype:{type:String,default:"HD Ticket"},toEmails:{type:Array,default:()=>[]},ccEmails:{type:Array,default:()=>[]},bccEmails:{type:Array,default:()=>[]}},emits:["submit","discard"],setup(t,{expose:o,emit:m}){const i=T(null),v=T(!1),f=t,n=V(()=>q.loading?"Sending...":f.label),u=m,c=dt("emailBoxContent"+f.ticketId,null),{updateOnboardingStep:h}=yt("helpdesk"),{isManager:l}=Ee(),{onUserType:s,cleanup:$}=Qe(f.ticketId),k=T([]),w=V(()=>_e(c.value));Y(c,(z,A)=>{z!==A&&z&&s()}),Je(()=>{$()});const x=T([...f.toEmails]),I=T([...f.ccEmails]),S=T([...f.bccEmails]),p=T(!1),y=T(!1),d=V(()=>{var z;return!!((z=I.value)!=null&&z.length)}),b=V(()=>{var z;return!!((z=S.value)!=null&&z.length)}),M=T(null),E=T(null);function F(z){c.value=z.message,v.value=!1}const q=ue({url:"run_doc_method",makeParams:()=>{var z,A;return{dt:f.doctype,dn:f.ticketId,method:"reply_via_agent",args:{attachments:k.value.map(ee=>ee.name),to:x.value.join(","),cc:(z=I.value)==null?void 0:z.join(","),bcc:(A=S.value)==null?void 0:A.join(","),message:c.value}}},onSuccess:()=>{Lt(),u("submit"),l&&h("reply_on_ticket")},debounce:300});function N(){if(_e(c.value))return!1;if(!x.value.length)return fe.warning("Email has no recipients. Please add at least one email address in the 'TO' field."),!1;q.submit()}function ve(){p.value=!p.value,p.value&&oe(()=>{M.value.setFocus()})}function ge(){y.value=!y.value,y.value&&oe(()=>{E.value.setFocus()})}async function xe(z){k.value=k.value.filter(A=>A!==z),await ft(z.name)}function ce(z,A,ee,De){x.value=A,I.value=ee,S.value=De,i.value.editor.chain().clearContent().insertContent(z).focus("all").setBlockquote().insertContentAt(0,{type:"paragraph"}).focus("start").run()}function Lt(){c.value=null,k.value=[]}function Bt(){k.value=[],c.value=null,I.value=[],S.value=[],I.value=[],p.value=!1,y.value=!1,u("discard")}const Vt=V(()=>i.value.editor);return o({addToReply:ce,editor:Vt,submitMail:N}),(z,A)=>{const ee=U("Button"),De=U("FeatherIcon");return r(),_(H,null,[g(e(Me),{ref_key:"editorRef",ref:i,"editor-class":["prose-sm max-w-full mx-6 md:mx-10 max-h-[50vh] py-3","min-h-[7rem]",e(Ke)(e(c)),t.editable&&"!max-h-[35vh] overflow-y-auto"],content:e(c),"starterkit-options":{heading:{levels:[2,3,4,5,6]}},placeholder:t.placeholder,editable:t.editable,onChange:A[8]||(A[8]=P=>t.editable?c.value=P:null),extensions:[e(bt)],uploadFunction:P=>e(mt)(P,t.doctype,t.ticketId)},{top:C(()=>[a("div",Ga,[A[10]||(A[10]=a("span",{class:"text-xs text-gray-500"},"TO:",-1)),g(e(Re),{modelValue:x.value,"onUpdate:modelValue":A[0]||(A[0]=P=>x.value=P),class:"flex-1",validate:e(Pe),"error-message":P=>`${P} is an invalid email address`},null,8,["modelValue","validate","error-message"]),g(ee,{label:e(D)("CC"),class:K([d.value?"bg-gray-300 hover:bg-gray-200":""]),onClick:A[1]||(A[1]=P=>ve())},null,8,["label","class"]),g(ee,{label:e(D)("BCC"),class:K([b.value?"bg-gray-300 hover:bg-gray-200":""]),onClick:A[2]||(A[2]=P=>ge())},null,8,["label","class"])]),p.value||d.value?(r(),_("div",{key:0,class:K(["mx-10 flex items-center gap-2 py-2.5",d.value||p.value?"border-b":""])},[A[11]||(A[11]=a("span",{class:"text-xs text-gray-500"},"CC:",-1)),g(e(Re),{ref_key:"ccInput",ref:M,modelValue:I.value,"onUpdate:modelValue":A[3]||(A[3]=P=>I.value=P),class:"flex-1",validate:e(Pe),"error-message":P=>`${P} is an invalid email address`},null,8,["modelValue","validate","error-message"])],2)):R("",!0),y.value||b.value?(r(),_("div",{key:1,class:K(["mx-10 flex items-center gap-2 py-2.5",b.value||y.value?"border-b":""])},[A[12]||(A[12]=a("span",{class:"text-xs text-gray-500"},"BCC:",-1)),g(e(Re),{ref_key:"bccInput",ref:E,modelValue:S.value,"onUpdate:modelValue":A[4]||(A[4]=P=>S.value=P),class:"flex-1",validate:e(Pe),"error-message":P=>`${P} is an invalid email address`},null,8,["modelValue","validate","error-message"])],2)):R("",!0)]),bottom:C(()=>[a("div",Wa,[(r(!0),_(H,null,X(k.value,P=>(r(),L(e(Ae),{key:P.file_url,label:P.file_name,url:["MOV","MP4"].includes(P.file_type)?null:P.file_url},{suffix:C(()=>[g(De,{class:"h-3.5",name:"x",onClick:Q(Et=>xe(P),["self","stop"])},null,8,["onClick"])]),_:2},1032,["label","url"]))),128))]),a("div",Ja,[a("div",Ya,[a("div",Qa,[g(e(_t),{"upload-args":{doctype:t.doctype,docname:t.ticketId,private:!0},onSuccess:A[5]||(A[5]=P=>{k.value.push(P)})},{default:C(({openFileSelector:P})=>[g(ee,{variant:"ghost",onClick:Et=>P()},{icon:C(()=>[g(e(St),{class:"h-4",style:{color:"#000000","stroke-width":"1.5 !important"}})]),_:1},8,["onClick"])]),_:1},8,["upload-args"]),g(ee,{variant:"ghost",onClick:A[6]||(A[6]=P=>v.value=!0)},{icon:C(()=>[g(e(Fe),{class:"h-4",style:{color:"#000000","stroke-width":"1.2"}})]),_:1})]),g(e(Ct),{class:"ml-1",buttons:e(Ge)},null,8,["buttons"])]),a("div",Xa,[g(ee,{label:e(D)("Discard"),onClick:Bt},null,8,["label"]),g(ee,{variant:"solid",disabled:w.value,loading:e(q).loading,label:n.value,onClick:A[7]||(A[7]=()=>{N()})},null,8,["disabled","loading","label"])])])]),_:1},8,["editor-class","content","placeholder","editable","extensions","uploadFunction"]),v.value?(r(),L(e(Vl),{key:0,modelValue:v.value,"onUpdate:modelValue":A[9]||(A[9]=P=>v.value=P),doctype:t.doctype,onApply:F},null,8,["modelValue","doctype"])):R("",!0)],64)}}}),tn={class:"flex-1"},ln={class:"mt-1.5 flex justify-between text-base items-start md:items-center"},an={key:0,class:"inline-flex flex-wrap gap-1.5 text-ink-gray-8 font-medium w-4/5"},nn={key:1,class:"text-gray-600 w-4/6"},sn={class:"font-medium text-gray-800"},on={class:"text-gray-600 text-sm w-2/6 flex justify-end"},rn={key:0},un={class:"text-gray-600 w-4/6"},cn={class:"font-medium text-gray-800"},dn={class:"text-gray-600 text-sm w-2/6 flex justify-end"},mn=O({__name:"HistoryBox",props:{activity:{type:Object,required:!0}},setup(t){const o=t,{user:m,content:i,creation:v,relatedActivities:f}=o.activity;let n=T(!1);return(u,c)=>{const h=U("Button"),l=U("Tooltip");return r(),_("div",tn,[a("div",ln,[e(f).length>1?(r(),_("div",an,[a("span",null,B(`${e(n)?"Hide ":"Show "}`),1),a("span",null,"+"+B(e(f).length),1),c[1]||(c[1]=a("span",null,"changes from ",-1)),a("span",null,B(e(m)),1),g(h,{class:"!size-4",variant:"ghost",onClick:c[0]||(c[0]=s=>Nt(n)?n.value=!e(n):n=!e(n))},{icon:C(()=>[g(e(ma))]),_:1})])):(r(),_("div",nn,[a("span",sn,B(e(m)),1),a("span",null,B(e(i)),1)])),g(l,{text:e(re)(e(v),e(he))},{default:C(()=>[a("div",on,B(e(pe)(e(v))),1)]),_:1},8,["text"])]),e(n)?(r(),_("div",rn,[(r(!0),_(H,null,X(e(f),s=>(r(),_("div",{key:s.creation,class:"mt-2 flex justify-between text-base"},[a("div",un,[a("span",cn,B(s.user),1),a("span",null,B(s.content),1)]),g(l,{text:e(re)(s.creation,e(he))},{default:C(()=>[a("div",dn,B(e(pe)(s.creation)),1)]),_:2},1032,["text"])]))),128))])):R("",!0)])}}}),fn={class:"flex flex-wrap gap-1"},pn={class:"flex-1"},vn={class:"mt-1 rounded-lg bg-white py-1 text-base shadow-2xl"},gn={class:"flex flex-col gap-1 p-1 text-gray-800"},xn={class:"text-base font-medium"},yn={class:"text-sm text-gray-600"},Re=O({__name:"MultiSelectInput",props:ae({validate:{type:Function,default:null},errorMessage:{type:Function,default:t=>`${t} is an Invalid value`}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(t,{expose:o}){const m=t,i=ie(t,"modelValue"),v=T([]),f=T(null),n=T(null),u=T(""),c=T(""),h=T(!1),l=V({get:()=>u.value||"",set:p=>{u.value="",p&&(h.value=!1),p!=null&&p.value&&w(p.value)}});zt(u,p=>{p=p||"",c.value!==p&&(c.value=p,k(p))},{debounce:300,immediate:!0});const s=ue({url:"helpdesk.api.contact.search_contacts",method:"GET",cache:["Contact",c.value],params:{txt:c.value},transform:p=>p.map(({full_name:y,email_id:d,name:b})=>({label:y||b||d,value:d}))}),$=V(()=>{let p=s.data||[];return!p.length&&u.value&&p.push({label:u.value,value:u.value}),p});function k(p){s.update({params:{txt:p}}),s.reload()}const w=p=>{n.value=null,p&&(p.split(",").forEach(d=>{var b;if(d=d.trim(),d&&!((b=i.value)!=null&&b.includes(d))){if(d&&m.validate&&!m.validate(d)){n.value=m.errorMessage(d);return}i.value?i.value.push(d):i.value=[d],d=d.replace(d,"")}}),!n.value&&(p=""))},x=p=>{i.value=i.value.filter(y=>y!==p)},I=()=>{var y;if(u.value)return;let p=(y=v.value[v.value.length-1])==null?void 0:y.$el;document.activeElement===p?(i.value.pop(),oe(()=>{i.value.length?(p=v.value[v.value.length-1].$el,p==null||p.focus()):S()})):p==null||p.focus()};function S(){f.value.$el.focus()}return o({setFocus:S}),(p,y)=>{const d=U("FeatherIcon"),b=U("Button"),M=U("ErrorMessage");return r(),_("div",null,[a("div",fn,[(r(!0),_(H,null,X(i.value,E=>(r(),L(b,{ref_for:!0,ref_key:"emails",ref:v,key:E,label:E,theme:"gray",variant:"subtle",class:"rounded-full",onKeydownCapture:me(Q(I,["stop"]),["delete"])},{suffix:C(()=>[g(d,{class:"h-3.5",name:"x",onClick:Q(F=>x(E),["stop"])},null,8,["onClick"])]),_:2},1032,["label","onKeydownCapture"]))),128)),a("div",pn,[g(e(Gt),{modelValue:l.value,"onUpdate:modelValue":y[2]||(y[2]=E=>l.value=E),nullable:""},{default:C(()=>[g(e(qt),{show:h.value,"onUpdate:show":y[1]||(y[1]=E=>h.value=E),class:"w-full"},{target:C(({togglePopover:E})=>[g(e(Ht),{ref_key:"search",ref:f,class:"search-input form-input w-full border-none bg-white hover:bg-white focus:border-none focus:!shadow-none focus-visible:!ring-0",type:"text",value:u.value,autocomplete:"off",onChange:y[0]||(y[0]=F=>{u.value=F.target.value,h.value=!0}),onFocus:()=>E(),onKeydownCapture:me(Q(I,["stop"]),["delete"])},null,8,["value","onFocus","onKeydownCapture"])]),body:C(({isOpen:E})=>[Oe(a("div",null,[a("div",vn,[g(e(Zt),{class:"my-1 max-h-[12rem] overflow-y-auto px-1.5",static:""},{default:C(()=>[(r(!0),_(H,null,X($.value,F=>(r(),L(e(Kt),{key:F.value,value:F},{default:C(({active:q})=>[a("li",{class:K(["flex cursor-pointer items-center rounded px-2 py-1 text-base",{"bg-gray-100":q}])},[g(e(kt),{class:"mr-2",name:F.value,size:"lg"},null,8,["name"]),a("div",gn,[a("div",xn,B(F.label),1),a("div",yn,B(F.value),1)])],2)]),_:2},1032,["value"]))),128))]),_:1})])],512),[[Ne,E]])]),_:1},8,["show"])]),_:1},8,["modelValue"])])]),n.value?(r(),L(M,{key:0,class:"mt-2 pl-2",message:n.value},null,8,["message"])):R("",!0)])}}}),bn={key:0,class:"pl-2"},hn={class:"flex items-center gap-2 text-sm text-gray-600"},_n={class:"flex items-center gap-1.5"},Cn=O({__name:"TypingIndicator",props:{ticketId:{type:String,required:!0}},setup(t){const o=t,{typingUsers:m,cleanup:i}=Qe(o.ticketId),v=V(()=>{var c,h;const f=m.length;if(f===0)return null;const{getUser:n}=Ze();let u=((c=n(m[0]))==null?void 0:c.full_name)||m[0];return console.log(u),console.log(m),f===1?j("div",{class:"flex items-center gap-1"},[j(kt,{name:m[0],size:"sm"}),j("span",{class:"text-ink-gray-6 font-medium"},u),j("span",{class:"text-ink-gray-5"}," is typing")]):f===2?j("div",{class:"flex items-center gap-1"},[j("span",{class:"text-ink-gray-6 font-medium"},u),j("span",{class:"text-ink-gray-5"}," and "),j("span",{class:"text-ink-gray-6 font-medium"},(h=n(m[1]))==null?void 0:h.full_name),j("span",{class:"text-ink-gray-5"}," are typing")]):j("div",{class:"flex items-center gap-1"},[j("span",{class:"text-ink-gray-6 font-medium"},u),j("span",{class:"text-ink-gray-5"}," and "),j("span",{class:"text-ink-gray-6 font-medium"},`${f-1} others`),j("span",{class:"text-ink-gray-5"}," are typing")])});return Je(()=>{i()}),(f,n)=>e(m).length>0?(r(),_("div",bn,[a("div",hn,[a("div",_n,[(r(),L(Ve(v.value))),n[0]||(n[0]=a("div",{class:"typing-dots"},[a("span"),a("span"),a("span")],-1))])])])):R("",!0)}}),kn=ne(Cn,[["__scopeId","data-v-3f215bd3"]]),wn={class:"text-base text-ink-gray-6"},$n={class:"flex flex-col gap-2 mt-6"},ws=O({__name:"SetContactPhoneModal",props:ae({name:{type:String,required:!0}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:ae(["onUpdate"],["update:modelValue"]),setup(t,{emit:o}){const m=o,i=ie(t,"modelValue"),v=T(""),f=t,n=T({name:"",phone:""}),u=()=>{if(Wt().regex(/^\+(?:[0-9]){6,14}[0-9]$/).safeParse(n.value.phone).success)v.value="";else{v.value="Invalid phone number";return}ue({url:"frappe.client.set_value",params:{doctype:"Contact",name:f.name,fieldname:"phone_nos",value:[{phone:n.value.phone,is_primary_phone:!0}]},auto:!0,onSuccess:()=>{m("onUpdate"),fe.success("Contact updated"),i.value=!1}})};return Y(i,c=>{c&&(n.value={name:f.name,phone:""})}),(c,h)=>{const l=U("FormControl");return r(),L(e(We),{modelValue:i.value,"onUpdate:modelValue":h[1]||(h[1]=s=>i.value=s),options:{title:"Set Phone Number",actions:[{label:"Set Phone Number",variant:"solid",onClick:u}]}},{"body-content":C(()=>[a("div",null,[a("div",wn,[a("b",null,B(n.value.name),1),h[2]||(h[2]=Se(" does not have a phone number, set one to call them. ",-1))]),a("div",$n,[g(l,{modelValue:n.value.phone,"onUpdate:modelValue":h[0]||(h[0]=s=>n.value.phone=s),label:e(D)("Phone"),type:"text",size:"sm",variant:"subtle",placeholder:e(D)("+918956895623"),disabled:!1},null,8,["modelValue","label","placeholder"]),g(e(Jt),{message:v.value},null,8,["message"])])])]),_:1},8,["modelValue","options"])}}}),In={},Tn={width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Sn(t,o){return r(),_("svg",Tn,[...o[0]||(o[0]=[a("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M3.76527 2.76476L3.76515 2.76469C3.76518 2.76471 3.76516 2.7647 3.76508 2.76466C3.76417 2.76417 3.75528 2.75942 3.73828 2.7571V9.24215C3.75528 9.23982 3.76418 9.23508 3.76508 9.23459C3.76516 9.23455 3.76518 9.23454 3.76515 9.23456L3.76527 9.23448L8.75611 5.99962L3.76527 2.76476ZM9.5471 6.67863L4.30917 10.0736C4.01166 10.2665 3.61363 10.2975 3.28101 10.1538C2.94839 10.01 2.73828 9.71611 2.73828 9.39463V2.60462C2.73828 2.28313 2.94839 1.98924 3.28101 1.84547C3.61363 1.7017 4.01166 1.73272 4.30917 1.92561L9.5471 5.32062C9.79432 5.48091 9.93982 5.73247 9.93982 5.99962C9.93982 6.26677 9.79432 6.51833 9.5471 6.67863Z",fill:"currentColor"},null,-1)])])}const Ln=ne(In,[["render",Sn]]),Bn={class:"w-full"},Vn={class:"mb-1 flex items-center justify-stretch gap-2 py-1 text-base"},En={class:"inline-flex items-center flex-wrap gap-1 text-ink-gray-5"},Mn={class:"font-medium text-ink-gray-8 ml-1"},An={class:"ml-auto whitespace-nowrap"},Fn={class:"text-sm text-ink-gray-5"},Dn={class:"flex items-center justify-between"},Pn={class:"inline-flex gap-2 items-center text-base font-medium"},jn={class:"flex items-center flex-wrap gap-2"},Rn=O({__name:"CallArea",props:{activity:Object},setup(t){const o=t,m=T(!1),i=T(!1),v=J("refreshTicket");return(f,n)=>{var u,c,h,l,s,$;return r(),_("div",Bn,[a("div",Vn,[a("div",En,[g(e(Xe),{image:(c=(u=t.activity)==null?void 0:u._caller)==null?void 0:c.image,label:(l=(h=t.activity)==null?void 0:h._caller)==null?void 0:l.label,size:"md"},null,8,["image","label"]),a("span",Mn,B(($=(s=t.activity)==null?void 0:s._caller)==null?void 0:$.label),1),a("span",null,B(t.activity.call_type=="Incoming"?e(D)("has reached out"):e(D)("has made a call")),1)]),a("div",An,[g(e(vt),{text:e(re)(t.activity.creation,"MMM D, dddd")},{default:C(()=>[a("div",Fn,B(e(D)(e(pe)(t.activity.creation))),1)]),_:1},8,["text"])])]),a("div",{onClick:n[0]||(n[0]=k=>m.value=!0),class:"flex flex-col gap-2 cursor-pointer border-transparent shadow rounded-md bg-surface-cards px-3 py-2.5 text-ink-gray-9"},[a("div",Dn,[a("div",Pn,[a("div",null,B(t.activity.call_type=="Incoming"?e(D)("Inbound Call"):e(D)("Outbound Call")),1)]),a("div",null,[g(nl,{avatars:[{name:t.activity._caller.label,label:t.activity._caller.label,image:t.activity._caller.image},{name:t.activity._receiver.label,label:t.activity._receiver.label,image:t.activity._receiver.image}],size:"sm"},null,8,["avatars"])])]),a("div",jn,[g(e(Ie),{label:e(re)(t.activity.creation,"MMM D, dddd")},{prefix:C(()=>[g(ol,{class:"size-3"})]),_:1},8,["label"]),t.activity.status=="Completed"?(r(),L(e(Ie),{key:0,label:t.activity.duration},{prefix:C(()=>[g(il,{class:"size-3"})]),_:1},8,["label"])):R("",!0),t.activity.recording_url?(r(),L(e(Ie),{key:1,label:e(D)("Listen"),class:"cursor-pointer"},{prefix:C(()=>[g(Ln,{class:"size-3"})]),_:1},8,["label"])):R("",!0),g(e(Ie),{label:e(rl)[t.activity.status],theme:e(ul)[t.activity.status]},null,8,["label","theme"])])]),g(cl,{modelValue:m.value,"onUpdate:modelValue":n[1]||(n[1]=k=>m.value=k),callLogModal:i.value,"onUpdate:callLogModal":n[2]||(n[2]=k=>i.value=k),callLogId:o.activity.name,hideTicket:!0},null,8,["modelValue","callLogModal","callLogId"]),g(wt,{modelValue:i.value,"onUpdate:modelValue":n[3]||(n[3]=k=>i.value=k),callLogId:o.activity.name,onAfterInsert:n[4]||(n[4]=k=>e(v)())},null,8,["modelValue","callLogId"])])}}}),Un={class:"md:mx-10 md:my-4 flex items-center justify-between text-lg font-medium mx-6 mb-4 !mt-8"},On={class:"flex h-8 items-center text-xl font-semibold text-gray-800"},Nn=O({__name:"ActivityHeader",props:{title:{type:String,required:!0}},setup(t){const o=J("communicationArea"),m=J("makeCall"),i=J("refreshTicket"),v=T(!1),{isCallingEnabled:f}=Ye(It()),n=J("ticketId"),u=V(()=>{let h=[{icon:j(Fe,{class:"h-4 w-4"}),label:D("Email"),onClick:()=>{var l;return((l=o==null?void 0:o.value)==null?void 0:l.toggleEmailBox())??ze()}},{icon:j(Be,{class:"h-4 w-4"}),label:D("Comment"),onClick:()=>{var l;return((l=o==null?void 0:o.value)==null?void 0:l.toggleCommentBox())??qe()}}];return f.value&&h.push(...c.value),h}),c=V(()=>[{icon:j($t,{class:"h-4 w-4"}),label:D("Make a Call"),onClick:()=>m()},{icon:"edit-3",label:D("Log a Call"),onClick:()=>{v.value=!0}}]);return(h,l)=>{const s=U("FeatherIcon"),$=U("Button");return r(),_(H,null,[a("div",Un,[a("div",On,B(t.title),1),t.title=="Emails"?(r(),L($,{key:0,variant:"solid",onClick:l[0]||(l[0]=k=>{var w;return((w=e(o))==null?void 0:w.toggleEmailBox())??e(ze)()})},{prefix:C(()=>[g(s,{name:"plus",class:"h-4 w-4"})]),default:C(()=>[l[5]||(l[5]=a("span",null,B("New Email"),-1))]),_:1})):t.title=="Comments"?(r(),L($,{key:1,variant:"solid",onClick:l[1]||(l[1]=k=>{var w;return((w=e(o))==null?void 0:w.toggleCommentBox())??e(qe)()})},{prefix:C(()=>[g(s,{name:"plus",class:"h-4 w-4"})]),default:C(()=>[l[6]||(l[6]=a("span",null,B("New Comment"),-1))]),_:1})):t.title=="Calls"?(r(),L(e(Le),{key:2,options:c.value,onClick:l[2]||(l[2]=Q(()=>{},["stop"]))},{default:C(({open:k})=>[g($,{variant:"solid",class:"flex items-center gap-1"},{prefix:C(()=>[g(s,{name:"plus",class:"h-4 w-4"})]),suffix:C(()=>[g(s,{name:k?"chevron-up":"chevron-down",class:"h-4 w-4"},null,8,["name"])]),default:C(()=>[l[7]||(l[7]=a("span",null,B("New"),-1))]),_:2},1024)]),_:1},8,["options"])):(r(),L(e(Le),{key:3,options:u.value,onClick:l[3]||(l[3]=Q(()=>{},["stop"]))},{default:C(({open:k})=>[g($,{variant:"solid",class:"flex items-center gap-1"},{prefix:C(()=>[g(s,{name:"plus",class:"h-4 w-4"})]),suffix:C(()=>[g(s,{name:k?"chevron-up":"chevron-down",class:"h-4 w-4"},null,8,["name"])]),default:C(()=>[l[8]||(l[8]=a("span",null,B("New"),-1))]),_:2},1024)]),_:1},8,["options"]))]),g(wt,{modelValue:v.value,"onUpdate:modelValue":l[4]||(l[4]=k=>v.value=k),ticketId:e(n),onAfterInsert:e(i)},null,8,["modelValue","ticketId","onAfterInsert"])],64)}}}),zn={class:"flex gap-[9px] mb-1.5 items-center"},qn={class:"text-base text-ink-gray-8 font-medium"},Hn={key:0},Zn={class:"mt-2 text-sm text-gray-700"},Kn=O({__name:"FeedbackBox",props:{activity:{type:Object,required:!0}},setup(t){const o=t,m=V(()=>o.activity.feedback_rating<=.4?["bg-surface-red-1","red"]:o.activity.feedback_rating<=.6?["bg-surface-amber-1","yellow"]:["bg-surface-green-1","yellow"]);return(i,v)=>(r(),_("div",{class:K(["w-full p-4 rounded",m.value[0]])},[a("div",zn,[a("p",qn,B(t.activity.feedback),1),g(ml,{rating:t.activity.feedback_rating},null,8,["rating"])]),t.activity.feedback_extra?(r(),_("div",Hn,[a("p",Zn,B(t.activity.feedback_extra),1)])):R("",!0)],2))}}),Gn={key:0,class:"activities flex-1 h-full mt-1"},Wn={class:"w-full px-6 md:px-10 grid grid-cols-[30px_minmax(auto,_1fr)] gap-2 sm:gap-4"},Jn={key:1,class:"h-full flex flex-col items-center justify-center gap-3 text-xl font-medium text-gray-500"},$s=O({__name:"TicketAgentActivities",props:{activities:{type:Array,required:!0},title:{type:String,required:!0},ticketStatus:{type:String,default:""}},emits:["email:reply","update"],setup(t,{expose:o,emit:m}){const i=t,v=m,f=gt(),n=xt(),{getUser:u}=Ze(),c=J("communicationArea"),h=J("makeCall"),l=V(()=>{let w="No Activities";if(i.title=="Emails")w="No Email Communications";else{if(i.title=="Comments")return w="No Comments",w;if(i.title=="Calls")return w="No Calls",w}}),s=V(()=>{let w=Hl;return i.title=="Emails"?w=Fe:i.title=="Comments"?w=Be:i.title=="Calls"&&(w=$t),j(w,{class:"text-gray-500"})});function $(){if(f.hash){k();return}setTimeout(()=>{let w,x=document.getElementsByClassName("activity");w=x[x.length-1],w&&!Qt(w)&&(w.scrollIntoViewIfNeeded(),w.focus())},500)}function k(){const w=f.hash;if(w){const x=w.substring(1);oe(()=>{setTimeout(()=>{const I=document.getElementById(x);I&&(I.scrollIntoViewIfNeeded(),I.classList.add("bg-yellow-100"),setTimeout(()=>{I.classList.remove("bg-yellow-100"),n.replace({hash:""})},2e3))},1e3)})}}return Y(()=>f.hash,()=>{$()}),Y(()=>i.title,()=>{$()},{immediate:!0}),o({scrollToLatestActivity:$}),(w,x)=>{const I=Nn,S=Rn,p=U("Button");return r(),_(H,null,[g(I,{title:t.title},null,8,["title"]),g(e(sl),{class:"flex flex-col flex-1 overflow-y-scroll","mask-length":20},{default:C(()=>[t.activities.length?(r(),_("div",Gn,[(r(!0),_(H,null,X(t.activities,(y,d)=>{var b,M;return r(),_("div",{key:y.key,class:"activity"},[a("div",Wn,[a("div",{class:K(["relative flex justify-center after:absolute after:left-[50%] after:top-2 after:-z-10 after:border-l after:border-gray-200",[d!=t.activities.length-1?"after:h-full":"after:h-4"]])},[a("div",{class:K(["z-1 flex h-7 w-7 items-center justify-center rounded-full bg-white",[["email","feedback"].includes(y.type)&&"mt-2"]])},[y.type==="email"||y.type==="feedback"?(r(),L(e(Xe),{key:0,size:"lg",label:(b=y.sender)==null?void 0:b.full_name,image:e(u)((M=y.sender)==null?void 0:M.name).user_image,class:"bg-white absolute left-[1px]"},null,8,["label","image"])):y.type==="comment"?(r(),L(e(Be),{key:1,class:"text-gray-600 absolute left-[7.5px]"})):y.type==="call"?(r(),L(e(Yt),{key:2,name:y.call_type==="Incoming"?"phone-incoming":"phone-outgoing",class:"text-gray-600 absolute left-[7.5px] size-4"},null,8,["name"])):(r(),L(e(ea),{key:3,class:"text-gray-600 absolute left-[7.5px]"}))],2)],2),a("div",{class:K(["mb-4 flex flex-1",[d==t.activities.length-1&&"mb-5"]])},[y.type==="email"?(r(),L(e(Ka),{key:0,activity:y,"show-split-option":!y.isFirstEmail&&t.ticketStatus!=="Closed",class:"py-2 px-3",onReply:x[0]||(x[0]=E=>v("email:reply",E))},null,8,["activity","show-split-option"])):y.type==="comment"?(r(),L(e(Ol),{key:1,activity:y,onUpdate:x[1]||(x[1]=()=>v("update"))},null,8,["activity"])):y.type==="call"?(r(),L(S,{key:2,activity:y},null,8,["activity"])):y.type==="feedback"?(r(),L(Kn,{key:3,activity:y},null,8,["activity"])):(r(),L(e(mn),{key:4,activity:y},null,8,["activity"]))],2)])])}),128))])):(r(),_("div",Jn,[(r(),L(Ve(s.value),{class:"h-10 w-10"})),a("span",null,B(l.value),1),t.title=="Emails"?(r(),L(p,{key:0,label:e(D)("New Email"),onClick:x[2]||(x[2]=y=>{var d;return((d=e(c))==null?void 0:d.toggleEmailBox())??e(ze)()})},null,8,["label"])):t.title=="Comments"?(r(),L(p,{key:1,label:e(D)("New Comment"),onClick:x[3]||(x[3]=y=>{var d;return((d=e(c))==null?void 0:d.toggleCommentBox())??e(qe)()})},null,8,["label"])):t.title=="Calls"?(r(),L(p,{key:2,label:e(D)("Make a Call"),onClick:x[4]||(x[4]=y=>e(h)())},null,8,["label"])):R("",!0)]))]),_:1})],64)}}}),Yn={class:"flex gap-2 px-5 pb-1 leading-5 first:mt-3 items-center"},Qn={class:"w-[106px] shrink-0 truncate text-sm text-gray-600"},Xn={key:0,class:"text-red-500"},es={class:"-m-0.5 min-h-[28px] flex-1 items-center overflow-hidden p-0.5 text-base"},ts=O({__name:"TicketField",props:{field:{},value:{type:[String,Number,Boolean,null]}},emits:["change"],setup(t,{emit:o}){const m=t,i=o,v=ue({url:m.field.url_method,auto:!!m.field.url_method,transform:l=>l!=null&&l.length?(l==null?void 0:l.map(s=>({label:s,value:s})))||[]:[]}),f=["Long Text","Small Text","Text","Text Editor","Data"],n=["Int","Float","Currency","Percent"],u=V(()=>m.field.url_method?j(je,{options:v.data}):m.field.fieldtype==="Link"&&m.field.options?j(vl,{doctype:m.field.options,hideMe:!0}):m.field.fieldtype==="Select"?j(je,{options:m.field.options.split(`
`).map(l=>({label:l,value:l}))}):m.field.fieldtype==="Check"?j(je,{options:[{label:"Yes",value:1},{label:"No",value:0}]}):f.includes(m.field.fieldtype)?j(st,{type:"textarea",rows:m.field.fieldtype==="Data"?1:2}):m.field.fieldtype==="Datetime"?j(fl,{formatter:l=>l&&ot(l).format(`${window.date_format.toUpperCase()} ${window.time_format}`)}):m.field.fieldtype==="Date"?j(pl,{id:m.field.fieldname}):j(st)),c=V(()=>{const l=m.field.fieldtype;return l==="Check"?m.value?"Yes":"No":l==="Date"&&m.value?ot(m.value).format(window.date_format.toUpperCase()):m.value});function h(l,s){i("change",{fieldname:l,value:s})}return(l,s)=>(r(),_("div",Yn,[a("div",Qn,[g(e(vt),{text:l.field.label},{default:C(()=>[a("span",null,B(l.field.label),1)]),_:1},8,["text"]),l.field.required?(r(),_("span",Xn," * ")):R("",!0)]),a("div",es,[(r(),L(Ve(u.value),ke({key:l.field.fieldname,readonly:l.field.readonly,disabled:l.field.disabled,class:"form-control",placeholder:l.field.placeholder||`Add ${l.field.label}`,"model-value":c.value,autocomplete:"off"},Xt([...f,...n].includes(l.field.fieldtype)?{blur:$=>{h(l.field.fieldname,$.target.value)}}:{"update:model-value":$=>{var k;h(l.field.fieldname,($==null?void 0:$.value)||((k=$==null?void 0:$.target)==null?void 0:k.value)||$)}})),null,16,["readonly","disabled","placeholder","model-value"]))])]))}});const Is=ne(ts,[["__scopeId","data-v-a4b613f0"]]);function Ts(t){const o=gt(),m=xt(),i=It(),{isLoading:v}=Ye(i),f=l=>{var s,$;c.value=l,l==0?m.replace({path:o.path}):n((($=(s=t.value)==null?void 0:s[l])==null?void 0:$.name)||t.value[0].name)};function n(l){let s="#"+(l==null?void 0:l.toLowerCase());o.hash!==s&&m.push({hash:s,query:o.query})}function u(l){var s;return(s=t.value)==null?void 0:s.findIndex($=>$.name.toLowerCase()===l)}const c=T(0),h=()=>{let l=o.hash.replace("#","");if(l){let s=u(l);if(s!==-1||s===0){c.value=s,n(t.value[s].name);return}}c.value=0,m.replace({path:o.path})};return Y(()=>o.hash,l=>{let s=u(l.replace("#",""));s===-1&&(s=0),s==0&&m.replace({path:o.path}),c.value=s}),Y([t,v],([l,s])=>{l!=null&&l.length&&(s||h())},{deep:!0,flush:"post"}),{tabIndex:c,changeTabTo:f}}export{Hl as A,Be as C,Is as T,ws as _,wl as a,$l as b,$s as c,Cs as d,ks as e,Ts as u};
//# sourceMappingURL=useActiveTabManager-bf736e9e.js.map
