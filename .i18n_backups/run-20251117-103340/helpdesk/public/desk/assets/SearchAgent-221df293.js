import{L as ve}from"./mail-5a1b0823.js";import{bc as he,e as a,k as o,l as n,d as oe,q as x,A as S,ak as re,c as p,a4 as ie,g as v,w as $,a9 as z,h as c,ar as ge,bb as _e,z as ye,f as _,y as f,F as w,G as R,aq as xe,ao as ke,am as be,v as m,a1 as Q,bd as ue,be as ee,x as te,K as J,u as we,s as Se,W as se,N as $e,aW as Ce,t as Te,r as ae,bf as Ve,bg as Oe,b2 as De,an as le}from"./index-0570e060.js";import{b as Me,q as Le,r as Ie}from"./TypingIndicator.vue_vue_type_style_index_0_scoped_3f215bd3_lang-f290abcf.js";import{_ as Ae}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-71e83eb3.js";import"./dayjs-2cebe90e.js";import{L as He}from"./LayoutHeader-6b26ba5d.js";import{_ as W}from"./Avatar.vue_vue_type_script_setup_true_lang-a0f98d49.js";import"./Dropdown-1e1fbbdd.js";const qe={class:"lucide lucide-message-square",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"};function ze(P,i){return a(),o("svg",qe,[...i[0]||(i[0]=[n("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"},null,-1)])])}const Re=he({name:"lucide-message-square",render:ze}),Fe={class:"relative inline-block text-left"},je={class:"flex"},Ee={class:"flex -space-x-2 isolate"},Ne={class:"text-ink-gray-7"},Be={key:1,class:"text-ink-gray-6"},Ke={key:0,class:"absolute z-50 mt-2 w-64 divide-y divide-outline-gray-modals rounded-lg bg-surface-modal shadow-2xl ring-1 ring-black ring-opacity-5 focus:outline-none left-0 origin-top-left"},Pe={class:"py-1.5 px-1.5"},Ue={class:"flex h-7 items-center text-sm font-medium text-ink-gray-6 justify-between"},Ye=["placeholder"],Ge={class:"px-1.5 pb-1.5 max-h-64 overflow-y-auto"},Je={key:0,class:"pt-1.5"},We=["onClick"],Xe={class:"text-ink-gray-7 flex-1 text-left truncate"},Ze={key:2,class:"text-xs text-ink-gray-5 ml-auto"},Qe={class:"flex h-7 pt-1.5 sticky top-0 bg-surface-white items-center px-2 text-sm font-medium text-ink-gray-6"},et=["onClick"],tt={key:2,class:"mr-2 w-6 h-6 flex-shrink-0"},st={class:"text-ink-gray-7 flex-1 text-left truncate"},at={key:3,class:"text-xs text-ink-gray-5 ml-auto"},lt={key:1,class:"px-2 py-4 text-center text-sm text-ink-gray-5"},K=oe({__name:"SearchMultiSelect",props:{options:{default:()=>[]},modelValue:{},placeholder:{default:x("Select options...")},label:{default:x("Options")},selectionText:{default:"items"}},emits:["update:modelValue"],setup(P,{emit:i}){const r=P,g=i,d=S(!1),k=S(""),y=S(0),O=re("inputRef"),h=p(()=>r.modelValue.length),b=p(()=>r.options.length>0&&"group"in r.options[0]&&"items"in r.options[0]),U=p(()=>b.value?[]:r.options),Y=p(()=>b.value?r.options:[]),F=p(()=>b.value?r.options.flatMap(s=>s.items):r.options),D=p(()=>F.value.filter(s=>r.modelValue.includes(s.value))),M=p(()=>D.value.some(s=>s.image)),j=p(()=>F.value.some(s=>s.image||s.icon)),L=p(()=>{if(!b.value)return[];const s=k.value.toLowerCase();return Y.value.map(e=>({...e,items:e.items.filter(t=>{const l=e.group.toLowerCase().includes(s),V=t.label.toLowerCase().includes(s);return l||V})})).filter(e=>e.items.length>0)}),I=p(()=>U.value.filter(s=>s.label.toLowerCase().includes(k.value.toLowerCase()))),A=p(()=>{const s=I.value,e=L.value.flatMap(t=>t.items);return[...s,...e]}),C=p(()=>A.value[y.value]||null);function T(){d.value=!d.value,d.value&&(y.value=0,xe(()=>{var s;(s=O.value)==null||s.focus()}))}function E(){d.value=!1}function H(s){const e=[...r.modelValue],t=e.indexOf(s.value);t>-1?e.splice(t,1):e.push(s.value),g("update:modelValue",e)}function G(){k.value="",g("update:modelValue",[])}function q(s){d.value&&(s.key==="Escape"?(s.preventDefault(),E()):s.key==="Enter"&&C.value?(s.preventDefault(),s.stopPropagation(),H(C.value)):s.key==="ArrowDown"?(s.preventDefault(),y.value=Math.min(y.value+1,A.value.length-1)):s.key==="ArrowUp"&&(s.preventDefault(),y.value=Math.max(y.value-1,0)))}function N(s){if(!s)return null;const e=typeof s=="string"?J("span",{class:"text-base"},s):J(s,{class:"w-4 h-4"});return J("span",{class:"flex-shrink-0 w-4 h-4 inline-flex items-center justify-center mr-2"},[e])}function B(s){var e;return((e=C.value)==null?void 0:e.value)===s.value}return ie(k,()=>{y.value=0}),(s,e)=>(a(),o("div",Fe,[n("div",je,[v(c(Q),{variant:"outline",class:z({"ring-2 ring-outline-gray-2":d.value}),onClick:T},{suffix:$(()=>[v(c(ke),{class:z(["ml-2 h-4 w-4 transition-transform duration-200",{"rotate-180":d.value}])},null,8,["class"])]),default:$(()=>{var t;return[n("div",{class:z(["flex items-center min-h-[20px]",{"gap-2":M.value&&h.value>0}])},[h.value>0?(a(),o(w,{key:0},[n("div",Ee,[(a(!0),o(w,null,R(D.value.slice(0,3),(l,V)=>(a(),o("div",{key:`avatar-${l.value}`,class:"relative flex",style:be({zIndex:10-V})},[l.image?(a(),_(c(W),{key:0,image:l.image,label:l.label,class:"border-2 border-white flex-shrink-0",size:"sm"},null,8,["image","label"])):f("",!0)],4))),128))]),n("span",Ne,m(h.value===1?(t=D.value[0])==null?void 0:t.label:`${h.value} ${s.selectionText}`),1)],64)):(a(),o("span",Be,m(s.placeholder),1))],2)]}),_:1},8,["class"])]),d.value?(a(),o("div",Ke,[n("div",Pe,[n("div",Ue,[ge(n("input",{ref_key:"inputRef",ref:O,"onUpdate:modelValue":e[0]||(e[0]=t=>k.value=t),placeholder:s.label,class:"px-2 flex-1 bg-transparent border-none outline-none text-sm focus:border-none focus:ring-0 text-ink-gray-6 placeholder-ink-gray-4",onClick:e[1]||(e[1]=ye(()=>{},["stop"])),onKeydown:q},null,40,Ye),[[_e,k.value]]),h.value>0?(a(),_(c(Q),{key:0,variant:"ghost",size:"sm",onClick:G},{icon:$(()=>[v(c(ue),{class:"size-4"})]),_:1})):f("",!0)])]),n("div",Ge,[I.value.length>0?(a(),o("div",Je,[(a(!0),o(w,null,R(I.value,t=>(a(),o("button",{key:`individual-${t.value}`,class:z(["group flex h-7 w-full items-center rounded px-2 text-base hover:bg-surface-gray-3 text-ink-gray-6",{"bg-surface-gray-2":B(t)}]),onClick:l=>H(t)},[v(c(ee),{modelValue:r.modelValue.includes(t.value),class:"mr-2 flex-shrink-0"},null,8,["modelValue"]),t.icon?(a(),_(te(N(t.icon)),{key:0})):j.value?(a(),_(c(W),{key:1,image:t.image,label:t.label,class:"mr-2 flex-shrink-0",size:"sm"},null,8,["image","label"])):f("",!0),n("span",Xe,m(t.label),1),(t.count??0)>0?(a(),o("span",Ze,m(t.count),1)):f("",!0)],10,We))),128))])):f("",!0),(a(!0),o(w,null,R(L.value,t=>(a(),o("div",{key:`group-${t.group}`},[n("div",Qe,m(t.group),1),(a(!0),o(w,null,R(t.items,l=>(a(),o("button",{key:`grouped-${l.value}`,class:z(["group flex h-7 w-full items-center rounded px-2 text-base hover:bg-surface-gray-3 text-ink-gray-6",{"bg-surface-gray-2":B(l)}]),onClick:V=>H(l)},[v(c(ee),{modelValue:r.modelValue.includes(l.value),class:"mr-2 flex-shrink-0"},null,8,["modelValue"]),l.icon?(a(),_(te(N(l.icon)),{key:0})):l.image?(a(),_(c(W),{key:1,image:l.image,label:l.label,class:"mr-2 flex-shrink-0",size:"sm"},null,8,["image","label"])):j.value?(a(),o("div",tt)):f("",!0),n("span",st,m(l.label),1),(l.count??0)>0?(a(),o("span",at,m(l.count),1)):f("",!0)],10,et))),128))]))),128)),A.value.length===0?(a(),o("div",lt," No options found ")):f("",!0)])])):f("",!0),d.value?(a(),o("div",{key:1,class:"fixed inset-0 z-40",onClick:E})):f("",!0)]))}}),nt={class:"mx-auto mt-6 max-w-4xl px-4 sm:px-5"},ot={class:"flex items-center space-x-2 px-2.5"},rt={class:"flex items-center"},it={class:"mt-2 px-2.5"},ut={class:"flex gap-2 items-center"},ct={class:"mt-2 px-2.5 text-sm flex items-center justify-between min-h-6"},dt={key:1,class:"text-ink-gray-6"},mt={key:2,class:"text-ink-gray-6"},ft={key:3,class:"space-y-1"},pt={class:"text-ink-gray-6"},vt={key:0},ht={key:0,class:"text-ink-gray-6"},gt={class:"text-ink-gray-5"},_t={class:"ml-1 font-medium text-primary"},yt={class:"mt-5"},xt={class:"flex items-start space-x-2"},kt={class:"flex-shrink-0"},bt={class:"w-full"},wt={class:"flex items-center"},St=["innerHTML"],$t={key:1,class:"text-base font-medium"},Ct={class:"px-1 leading-none text-sm text-ink-gray-5"},Tt={class:"px-1 leading-none text-sm text-ink-gray-5"},Vt={class:"ml-auto text-sm text-ink-gray-5"},Ot=["innerHTML"],ne="helpdesk_search:",Rt=oe({__name:"SearchAgent",setup(P){const i=S(""),r=S(null),g=S(!0),d=S({}),k=re("searchInput"),y=we(),O=Se(),h=se({url:"helpdesk.api.search.search",makeParams(){return{query:i.value,filters:JSON.stringify(d.value),limit:50}},onSuccess(e){r.value=e,g.value=!1,i.value&&B(i.value,e)}}),b=se({url:"helpdesk.api.search.get_filter_options",auto:!0}),U=p(()=>{var t;const e=((t=b.data)==null?void 0:t.teams)||{};return Object.entries(e).map(([l])=>({value:l,label:`${l}`}))}),Y=p(()=>{var t;const e=((t=b.data)==null?void 0:t.statuses)||{};return Object.entries(e).map(([l])=>({value:l,label:`${l}`}))}),F=p(()=>{var t;const e=((t=b.data)==null?void 0:t.priorities)||{};return Object.entries(e).map(([l])=>({value:l,label:`${l}`}))}),D=p(()=>[{value:"HD Ticket",label:x("Tickets"),count:0},{value:"Communication",label:x("Emails"),count:0},{value:"HD Ticket Comment",label:x("Comments"),count:0}]),M=Ve(()=>{i.value.length>2&&h.submit()},500);function j(e){i.value=e,g.value=!0,M()}function L(){i.value.length>2&&(y.replace({name:"SearchAgent",query:{q:i.value}}),h.submit())}function I(){i.value="",r.value=null,g.value=!0,s(),y.replace({name:"SearchAgent"})}function A(){d.value={},i.value.length>2&&M()}function C(){return Object.values(d.value).some(e=>e&&e.length>0)}function T(e,t){!t||t.length===0?delete d.value[e]:d.value[e]=t,i.value.length>2&&M()}function E(e){return!e||!e.doctype||!e.name?{name:"SearchAgent"}:e.doctype==="HD Ticket"?{name:"TicketAgent",params:{ticketId:e.name}}:e.doctype==="HD Ticket Comment"&&e.reference_ticket?{name:"TicketAgent",params:{ticketId:e.reference_ticket},hash:`#comment-${e.name}`}:e.doctype==="Communication"&&e.reference_name?{name:"TicketAgent",params:{ticketId:e.reference_name},hash:`#communication-${e.name}`}:{name:"SearchAgent"}}function H(e){return!e||!e.doctype?"":e.doctype==="HD Ticket"?e.name||"":e.doctype==="HD Ticket Comment"?e.reference_ticket||"":e.doctype==="Communication"&&e.reference_name||""}function G(e){if(!e)return"";let t="MMM D, YYYY hh:mm A";try{return typeof e=="number"?le.unix(e).format(t):le(e).format(t)}catch{return""}}function q(e){return`${ne}${e}`}function N(e){const t=localStorage.getItem(q(e));if(t){const l=JSON.parse(t);if(Date.now()-l.timestamp<30*60*1e3)return r.value=l.results,l.filters&&(d.value=l.filters),g.value=!1,!0;localStorage.removeItem(q(e))}return!1}function B(e,t){const l={results:t,filters:d.value,timestamp:Date.now()};localStorage.setItem(q(e),JSON.stringify(l))}function s(){for(let e=0;e<localStorage.length;e++){const t=localStorage.key(e);t!=null&&t.startsWith(ne)&&localStorage.removeItem(t)}}return ie(()=>O.query.q,e=>{e&&typeof e=="string"&&e!==i.value?(i.value=e,g.value=!1,h.submit()):!e&&i.value&&(i.value="",r.value=null,g.value=!0)}),$e(()=>{const e=O.query.q;e?(i.value=e,N(e)||L()):s(),Me("/",()=>{k.value.el.focus()})}),(e,t)=>{var X,Z;const l=Le,V=ue,ce=ae("Button"),de=Ie,me=Re,fe=ve,pe=ae("router-link");return a(),o("div",null,[n("div",null,[v(c(He),null,{"left-header":$(()=>[v(c(Ae),{items:[{label:"Search",route:{name:"SearchAgent"}}]})]),_:1}),n("div",nt,[n("div",ot,[v(c(Oe),{ref_key:"searchInput",ref:k,class:"flex-1",placeholder:c(x)("Search tickets, comments, and communications..."),autocomplete:"off","model-value":i.value,"onUpdate:modelValue":j,onKeydown:[t[0]||(t[0]=u=>g.value=!0),t[1]||(t[1]=Ce(()=>L(),["enter"]))]},{prefix:$(()=>[v(l,{class:"w-4 text-ink-gray-5"})]),suffix:$(()=>[n("div",rt,[i.value?(a(),o("button",{key:0,onClick:I,class:"p-1 size-6 grid place-content-center focus:outline-none focus:ring focus:ring-outline-gray-3 rounded"},[v(V,{class:"w-4 text-ink-gray-7"})])):f("",!0)])]),_:1},8,["placeholder","model-value"])]),n("div",it,[n("div",ut,[v(K,{options:U.value,"model-value":d.value.agent_group||[],"onUpdate:modelValue":t[2]||(t[2]=u=>T("agent_group",u)),placeholder:"Team",label:"Team"},null,8,["options","model-value"]),v(K,{options:Y.value,"model-value":d.value.status||[],"onUpdate:modelValue":t[3]||(t[3]=u=>T("status",u)),placeholder:"Status",label:"Status"},null,8,["options","model-value"]),v(K,{options:F.value,"model-value":d.value.priority||[],"onUpdate:modelValue":t[4]||(t[4]=u=>T("priority",u)),placeholder:"Priority",label:"Priority"},null,8,["options","model-value"]),v(K,{options:D.value,"model-value":d.value.doctype||[],"onUpdate:modelValue":t[5]||(t[5]=u=>T("doctype",u)),placeholder:"Type",label:"Type"},null,8,["options","model-value"]),C()?(a(),_(ce,{key:0,size:"sm",class:"ml-auto text-ink-gray-5",variant:"gray-ghost",onClick:A,label:c(x)("Clear all filters")},null,8,["label"])):f("",!0)])]),n("div",ct,[n("div",null,[c(h).error?(a(),_(c(De),{key:0,message:c(h).error.type=="HelpdeskSearchIndexMissingError"?"Search index does not exist. Please build the index first.":c(h).error},null,8,["message"])):g.value&&i.value.length>2?(a(),o("p",dt,m(c(x)("Press enter to search")),1)):c(h).loading?(a(),o("p",mt,m(c(x)("Searching...")),1)):(X=r.value)!=null&&X.summary?(a(),o("div",ft,[n("p",pt,[Te(m(r.value.summary.filtered_matches)+" matches ("+m(r.value.summary.duration)+"s) ",1),C()?(a(),o("span",vt," • "+m(Object.keys(r.value.summary.applied_filters||{}).length)+" filter(s) applied ",1)):f("",!0)]),r.value.summary.corrected_query?(a(),o("p",ht,[n("span",gt,m(c(x)("Searched for:")),1),n("span",_t,m(r.value.summary.corrected_query),1)])):f("",!0)])):f("",!0)])]),n("div",yt,[(a(!0),o(w,null,R((Z=r.value)==null?void 0:Z.results,u=>(a(),o(w,{key:u.id},[v(pe,{to:E(u),class:"flex space-x-2 overflow-hidden rounded px-2.5 py-3 hover:bg-surface-gray-2"},{default:$(()=>[n("div",xt,[n("div",kt,[u.doctype==="HD Ticket"?(a(),_(de,{key:0,class:"h-4 w-4 text-ink-gray-6"})):u.doctype==="HD Ticket Comment"?(a(),_(me,{key:1,class:"h-4 w-4 text-ink-gray-6"})):u.doctype==="Communication"?(a(),_(fe,{key:2,class:"h-4 w-4 text-ink-gray-6"})):f("",!0)])]),n("div",bt,[n("div",wt,[u.title?(a(),o("div",{key:0,class:"text-base font-medium",innerHTML:u.title},null,8,St)):(a(),o("div",$t,m(u.name),1)),n("span",Ct," · "+m(u.doctype=="Communication"?"Email":u.doctype.replace("HD ","")),1),n("span",Tt," · #"+m(H(u)),1),n("div",Vt,m(G(u.modified)),1)]),u.content?(a(),o("div",{key:0,class:"mt-1 text-p-base text-ink-gray-6",innerHTML:u.content},null,8,Ot)):f("",!0)])]),_:2},1032,["to"]),t[6]||(t[6]=n("div",{class:"border-b mx-2"},null,-1))],64))),128))])])])])}}});export{Rt as default};
//# sourceMappingURL=SearchAgent-221df293.js.map
