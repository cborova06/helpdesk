import{d as O,A as S,K as P,aw as Mt,ax as rt,c as E,ay as ye,a8 as Ue,N as se,a4 as Y,aj as At,az as Z,aA as Ce,aB as Ft,F as H,aC as ut,a6 as He,a0 as J,aD as Dt,aE as tt,aF as Te,aG as te,aH as $e,aI as Pt,aJ as jt,aK as de,aL as le,aq as oe,e as r,f as V,w as C,k as _,G as X,h as e,C as be,ac as ke,l as a,a9 as K,x as Ve,y as j,t as Se,v as T,m as ae,n as ie,g,D as lt,E as at,Z as ct,r as U,q as L,a as Ee,U as Ze,W as ue,Q as fe,aM as pe,a3 as re,a7 as he,al as Rt,aN as Ke,aO as Ge,I as We,aP as _e,j as ne,aQ as Ut,aR as dt,av as Je,z as Q,aS as mt,aT as ft,b as pt,aU as Ot,aV as nt,ar as Oe,as as Ne,aW as me,$ as Ye,aX as Pe,O as Nt,aY as zt,H as qt,aZ as Ht,a_ as Zt,a$ as Kt,b0 as Gt,b1 as Wt,b2 as Jt,M as vt,L as Ie,s as gt,u as xt,R as Yt,b3 as Qt,aa as st,ag as ot,b4 as Xt}from"./index-0570e060.js";import{s as G,a as yt,h as Qe,P as bt,i as el,d as tl,f as W,b as it,T as ll,L as ht,t as ze,j as qe}from"./TypingIndicator.vue_vue_type_style_index_0_scoped_3f215bd3_lang-f290abcf.js";import"./dayjs-2cebe90e.js";import{u as al}from"./LayoutHeader-6b26ba5d.js";import{F as _t}from"./FileUploader-6d719bf4.js";import{_ as Me,T as Ct}from"./TextEditor.vue_vue_type_script_setup_true_lang-a6c50ac5.js";import{_ as Ae}from"./AttachmentItem.vue_vue_type_script_setup_true_lang-9fe00f85.js";import{_ as Fe}from"./EmailIcon-049172ef.js";import{_ as kt}from"./UserAvatar.vue_vue_type_script_setup_true_lang-dd648b68.js";import{_ as Xe}from"./Avatar.vue_vue_type_script_setup_true_lang-a0f98d49.js";import{_ as nl,a as sl}from"./MultipleAvatar.vue_vue_type_script_setup_true_lang-1c7f3694.js";import{C as ol,D as il,s as rl,a as ul,b as cl,_ as wt}from"./CallLogModal.vue_vue_type_script_setup_true_lang-9ca96f04.js";import{P as $t}from"./PhoneIcon-4fb53441.js";import{u as It}from"./telephony-684c26ee.js";import{D as Le}from"./Dropdown-1e1fbbdd.js";import{_ as dl}from"./EmailContent-0985017e.js";import{_ as ml}from"./StarRating.vue_vue_type_script_setup_true_lang-ecf3e22e.js";import{D as fl,_ as pl}from"./DateTimePicker-2f0425b4.js";import{_ as je}from"./Autocomplete-3ba2dc4c.js";import{a as vl}from"./Link-3bf01fe5.js";let gl=O({props:{onFocus:{type:Function,required:!0}},setup(t){let o=S(!0);return()=>o.value?P(rt,{as:"button",type:"button",features:Mt.Focusable,onFocus(d){d.preventDefault();let i,v=50;function m(){var n;if(v--<=0){i&&cancelAnimationFrame(i);return}if((n=t.onFocus)!=null&&n.call(t)){o.value=!1,cancelAnimationFrame(i);return}i=requestAnimationFrame(m)}i=requestAnimationFrame(m)}}):null}});var xl=(t=>(t[t.Forwards=0]="Forwards",t[t.Backwards=1]="Backwards",t))(xl||{}),yl=(t=>(t[t.Less=-1]="Less",t[t.Equal=0]="Equal",t[t.Greater=1]="Greater",t))(yl||{});let Tt=Symbol("TabsContext");function we(t){let o=J(Tt,null);if(o===null){let d=new Error(`<${t} /> is missing a parent <TabGroup /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(d,we),d}return o}let et=Symbol("TabsSSRContext"),bl=O({name:"TabGroup",emits:{change:t=>!0},props:{as:{type:[Object,String],default:"template"},selectedIndex:{type:[Number],default:null},defaultIndex:{type:[Number],default:0},vertical:{type:[Boolean],default:!1},manual:{type:[Boolean],default:!1}},inheritAttrs:!1,setup(t,{slots:o,attrs:d,emit:i}){var v;let m=S((v=t.selectedIndex)!=null?v:t.defaultIndex),n=S([]),u=S([]),f=E(()=>t.selectedIndex!==null),h=E(()=>f.value?t.selectedIndex:m.value);function l(x){var I;let B=ye(s.tabs.value,Z),p=ye(s.panels.value,Z),y=B.filter(c=>{var b;return!((b=Z(c))!=null&&b.hasAttribute("disabled"))});if(x<0||x>B.length-1){let c=Te(m.value===null?0:Math.sign(x-m.value),{[-1]:()=>1,0:()=>Te(Math.sign(x),{[-1]:()=>0,0:()=>0,1:()=>1}),1:()=>0}),b=Te(c,{0:()=>B.indexOf(y[0]),1:()=>B.indexOf(y[y.length-1])});b!==-1&&(m.value=b),s.tabs.value=B,s.panels.value=p}else{let c=B.slice(0,x),b=[...B.slice(x),...c].find(A=>y.includes(A));if(!b)return;let M=(I=B.indexOf(b))!=null?I:s.selectedIndex.value;M===-1&&(M=s.selectedIndex.value),m.value=M,s.tabs.value=B,s.panels.value=p}}let s={selectedIndex:E(()=>{var x,I;return(I=(x=m.value)!=null?x:t.defaultIndex)!=null?I:null}),orientation:E(()=>t.vertical?"vertical":"horizontal"),activation:E(()=>t.manual?"manual":"auto"),tabs:n,panels:u,setSelectedIndex(x){h.value!==x&&i("change",x),f.value||l(x)},registerTab(x){var I;if(n.value.includes(x))return;let B=n.value[m.value];if(n.value.push(x),n.value=ye(n.value,Z),!f.value){let p=(I=n.value.indexOf(B))!=null?I:m.value;p!==-1&&(m.value=p)}},unregisterTab(x){let I=n.value.indexOf(x);I!==-1&&n.value.splice(I,1)},registerPanel(x){u.value.includes(x)||(u.value.push(x),u.value=ye(u.value,Z))},unregisterPanel(x){let I=u.value.indexOf(x);I!==-1&&u.value.splice(I,1)}};Ue(Tt,s);let $=S({tabs:[],panels:[]}),k=S(!1);se(()=>{k.value=!0}),Ue(et,E(()=>k.value?null:$.value));let w=E(()=>t.selectedIndex);return se(()=>{Y([w],()=>{var x;return l((x=t.selectedIndex)!=null?x:t.defaultIndex)},{immediate:!0})}),At(()=>{if(!f.value||h.value==null||s.tabs.value.length<=0)return;let x=ye(s.tabs.value,Z);x.some((I,B)=>Z(s.tabs.value[B])!==Z(I))&&s.setSelectedIndex(x.findIndex(I=>Z(I)===Z(s.tabs.value[h.value])))}),()=>{let x={selectedIndex:m.value};return P(H,[n.value.length<=0&&P(gl,{onFocus:()=>{for(let I of n.value){let B=Z(I);if((B==null?void 0:B.tabIndex)===0)return B.focus(),!0}return!1}}),Ce({theirProps:{...d,...Ft(t,["selectedIndex","defaultIndex","manual","vertical","onChange"])},ourProps:{},slot:x,slots:o,attrs:d,name:"TabGroup"})])}}}),hl=O({name:"TabList",props:{as:{type:[Object,String],default:"div"}},setup(t,{attrs:o,slots:d}){let i=we("TabList");return()=>{let v={selectedIndex:i.selectedIndex.value},m={role:"tablist","aria-orientation":i.orientation.value};return Ce({ourProps:m,theirProps:t,slot:v,attrs:o,slots:d,name:"TabList"})}}}),_l=O({name:"Tab",props:{as:{type:[Object,String],default:"button"},disabled:{type:[Boolean],default:!1},id:{type:String,default:null}},setup(t,{attrs:o,slots:d,expose:i}){var v;let m=(v=t.id)!=null?v:`headlessui-tabs-tab-${ut()}`,n=we("Tab"),u=S(null);i({el:u,$el:u}),se(()=>n.registerTab(u)),He(()=>n.unregisterTab(u));let f=J(et),h=E(()=>{if(f.value){let p=f.value.tabs.indexOf(m);return p===-1?f.value.tabs.push(m)-1:p}return-1}),l=E(()=>{let p=n.tabs.value.indexOf(u);return p===-1?h.value:p}),s=E(()=>l.value===n.selectedIndex.value);function $(p){var y;let c=p();if(c===$e.Success&&n.activation.value==="auto"){let b=(y=jt(u))==null?void 0:y.activeElement,M=n.tabs.value.findIndex(A=>Z(A)===b);M!==-1&&n.setSelectedIndex(M)}return c}function k(p){let y=n.tabs.value.map(c=>Z(c)).filter(Boolean);if(p.key===te.Space||p.key===te.Enter){p.preventDefault(),p.stopPropagation(),n.setSelectedIndex(l.value);return}switch(p.key){case te.Home:case te.PageUp:return p.preventDefault(),p.stopPropagation(),$(()=>de(y,le.First));case te.End:case te.PageDown:return p.preventDefault(),p.stopPropagation(),$(()=>de(y,le.Last))}if($(()=>Te(n.orientation.value,{vertical(){return p.key===te.ArrowUp?de(y,le.Previous|le.WrapAround):p.key===te.ArrowDown?de(y,le.Next|le.WrapAround):$e.Error},horizontal(){return p.key===te.ArrowLeft?de(y,le.Previous|le.WrapAround):p.key===te.ArrowRight?de(y,le.Next|le.WrapAround):$e.Error}}))===$e.Success)return p.preventDefault()}let w=S(!1);function x(){var p;w.value||(w.value=!0,!t.disabled&&((p=Z(u))==null||p.focus({preventScroll:!0}),n.setSelectedIndex(l.value),Pt(()=>{w.value=!1})))}function I(p){p.preventDefault()}let B=Dt(E(()=>({as:t.as,type:o.type})),u);return()=>{var p,y;let c={selected:s.value,disabled:(p=t.disabled)!=null?p:!1},{...b}=t,M={ref:u,onKeydown:k,onMousedown:I,onClick:x,id:m,role:"tab",type:B.value,"aria-controls":(y=Z(n.panels.value[l.value]))==null?void 0:y.id,"aria-selected":s.value,tabIndex:s.value?0:-1,disabled:t.disabled?!0:void 0};return Ce({ourProps:M,theirProps:b,slot:c,attrs:o,slots:d,name:"Tab"})}}}),Cl=O({name:"TabPanels",props:{as:{type:[Object,String],default:"div"}},setup(t,{slots:o,attrs:d}){let i=we("TabPanels");return()=>{let v={selectedIndex:i.selectedIndex.value};return Ce({theirProps:t,ourProps:{},slot:v,attrs:d,slots:o,name:"TabPanels"})}}}),kl=O({name:"TabPanel",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},id:{type:String,default:null},tabIndex:{type:Number,default:0}},setup(t,{attrs:o,slots:d,expose:i}){var v;let m=(v=t.id)!=null?v:`headlessui-tabs-panel-${ut()}`,n=we("TabPanel"),u=S(null);i({el:u,$el:u}),se(()=>n.registerPanel(u)),He(()=>n.unregisterPanel(u));let f=J(et),h=E(()=>{if(f.value){let $=f.value.panels.indexOf(m);return $===-1?f.value.panels.push(m)-1:$}return-1}),l=E(()=>{let $=n.panels.value.indexOf(u);return $===-1?h.value:$}),s=E(()=>l.value===n.selectedIndex.value);return()=>{var $;let k={selected:s.value},{tabIndex:w,...x}=t,I={ref:u,id:m,role:"tabpanel","aria-labelledby":($=Z(n.tabs.value[l.value]))==null?void 0:$.id,tabIndex:s.value?w:-1};return!s.value&&t.unmount&&!t.static?P(rt,{as:"span","aria-hidden":!0,...I}):Ce({ourProps:I,theirProps:x,slot:k,attrs:o,slots:d,features:tt.Static|tt.RenderStrategy,visible:s.value,name:"TabPanel"})}}});const wl={__name:"TabList",setup(t){const o=J("tab"),d=S([]),i=S(null),v=E(()=>{var u;return(u=o.value.tabs.value)==null?void 0:u.length}),m=S("");function n(u){u>=v.value&&(u=v.value-1);const f=d.value[u].el;o.value.vertical.value?(i.value.style.height=`${f.offsetHeight}px`,i.value.style.top=`${f.offsetTop}px`):(i.value.style.width=`${f.offsetWidth}px`,i.value.style.left=`${f.offsetLeft}px`)}return Y(()=>o.value.tabIndex.value,u=>{u>=v.value&&(o.value.tabIndex.value=v.value-1),m.value="transition-all duration-300 ease-in-out",oe(()=>n(u))}),se(()=>{oe(()=>n(o.value.tabIndex.value)),setTimeout(()=>n(o.value.tabIndex.value),100)}),(u,f)=>(r(),V(e(hl),{class:K(["relative flex",e(o).vertical?"flex-col border-r overflow-y-auto":"gap-7.5 border-b overflow-x-auto items-center px-5"])},{default:C(()=>[(r(!0),_(H,null,X(e(o).tabs,(h,l)=>(r(),V(e(_l),{ref_for:!0,ref_key:"tabRef",ref:d,as:"template",key:l,class:"focus:outline-none focus:transition-none"},{default:C(({selected:s})=>[be(u.$slots,"default",ke({ref_for:!0},{tab:h,selected:s}),()=>[a("button",{class:K(["flex items-center gap-1.5 text-base text-ink-gray-5 duration-300 ease-in-out hover:text-ink-gray-9",[s?"text-ink-gray-9":"",e(o).vertical?"py-2.5 px-4 border-r border-transparent hover:border-outline-gray-3":"py-3 border-b border-transparent hover:border-outline-gray-3"]])},[h.icon?(r(),V(Ve(h.icon),{key:0,class:"size-4"})):j("",!0),Se(" "+T(h.label),1)],2)])]),_:2},1024))),128)),a("div",{ref_key:"indicator",ref:i,class:K(["tab-indicator absolute bg-surface-gray-7",[e(o).vertical?"right-0 w-px":"bottom-0 h-px",m.value]])},null,2)]),_:3},8,["class"]))}},$l={__name:"TabPanel",setup(t){const o=J("tab");return(d,i)=>(r(),V(e(Cl),{class:"flex flex-1 overflow-hidden"},{default:C(()=>[(r(!0),_(H,null,X(e(o).tabs,(v,m)=>(r(),V(e(kl),{class:"flex flex-1 flex-col overflow-y-auto focus:outline-none",key:m},{default:C(()=>[be(d.$slots,"default",ke({ref_for:!0},{tab:v}))]),_:2},1024))),128))]),_:3}))}},Ss={__name:"Tabs",props:ae({as:{type:String,default:"template"},tabs:{type:Array,required:!0},vertical:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const o=t,d=ie(t,"modelValue");return Ue("tab",E(()=>({tabIndex:d,tabs:o.tabs,vertical:o.vertical}))),(i,v)=>(r(),V(e(bl),ke(t.as!=="template"?{as:t.as,class:["flex flex-1 overflow-hidden",t.vertical?"":"flex-col "]}:{},{defaultIndex:d.value,selectedIndex:d.value,onChange:v[0]||(v[0]=m=>d.value=m)}),{default:C(()=>[be(i.$slots,"default",{},()=>[g(wl,null,{default:C(({tab:m,selected:n})=>[be(i.$slots,"tab-item",lt(at({tab:m,selected:n})))]),_:3}),g($l,null,{default:C(({tab:m})=>[be(i.$slots,"tab-panel",lt(at({tab:m})))]),_:3})])]),_:3},16,["defaultIndex","selectedIndex"]))}},Il={key:0,class:"mt-2 grid max-h-[560px] grid-cols-1 md:grid-cols-3 gap-2 overflow-y-auto"},Tl=["onClick"],Sl={class:"border-b pb-2 text-base font-semibold"},Ll={key:1,class:"mt-2"},Bl={class:"flex justify-end mt-4"},Vl={__name:"CannedResponseSelectorModal",props:ae({doctype:{type:String,default:""}},{modelValue:{},modelModifiers:{}}),emits:ae(["apply"],["update:modelValue"]),setup(t,{emit:o}){const d=t,i=ie(t,"modelValue"),v=S(""),m=o,n=S(""),u=ct({type:"list",doctype:"HD Canned Response",cache:["cannedResponses",d.doctype],fields:["title","message","modified"],orderBy:"modified desc",pageLength:99999});se(()=>{u.data==null&&u.fetch()}),He(()=>{G.value=!0});const f=E(()=>{var h;return((h=u.data)==null?void 0:h.filter(l=>l.title.toLowerCase().includes(n.value.toLowerCase())))??[]});return Y(i,h=>h&&oe(()=>{var l,s;return(s=(l=v.value)==null?void 0:l.el)==null?void 0:s.focus()})),(h,l)=>{const s=U("FeatherIcon"),$=U("TextInput"),k=U("Button"),w=U("Dialog");return r(),V(w,{modelValue:i.value,"onUpdate:modelValue":l[2]||(l[2]=x=>i.value=x),options:{title:"Canned Responses",size:"4xl"}},{"body-content":C(()=>[g($,{ref_key:"searchInput",ref:v,modelValue:n.value,"onUpdate:modelValue":l[0]||(l[0]=x=>n.value=x),type:"text",placeholder:e(L)("Site Down")},{prefix:C(()=>[g(s,{name:"search",class:"h-4 w-4 text-gray-500"})]),_:1},8,["modelValue","placeholder"]),f.value.length?(r(),_("div",Il,[(r(!0),_(H,null,X(f.value,x=>(r(),_("div",{key:x.name,class:"flex h-56 cursor-pointer flex-col gap-2 rounded-lg border p-3 hover:bg-gray-100",onClick:I=>m("apply",x)},[a("div",Sl,T(x.title),1),x.message?(r(),V(e(Me),{key:0,content:x.message,editable:!1,"editor-class":"!prose-sm max-w-none !text-sm text-gray-600 focus:outline-none",class:"flex-1 overflow-hidden"},null,8,["content"])):j("",!0)],8,Tl))),128))])):(r(),_("div",Ll,[...l[3]||(l[3]=[a("div",{class:"flex h-56 flex-col items-center justify-center"},[a("div",{class:"text-lg text-gray-500"},T("No templates found"))],-1)])])),a("div",Bl,[g(k,{label:e(L)("New Canned Response"),onClick:l[1]||(l[1]=()=>{h.$router.push("/canned-responses#new"),e(u).data=null})},null,8,["label"])])]),_:1},8,["modelValue"])}}},El={class:"mb-1 ml-0.5 flex items-center justify-between"},Ml={class:"text-gray-600 flex items-center gap-2"},Al={class:"font-medium text-gray-800"},Fl={class:"max-w-xs truncate font-medium text-gray-800"},Dl={class:"flex items-center gap-1"},Pl={class:"pl-0.5 text-sm text-gray-600"},jl={key:0},Rl=["id"],Ul={class:"flex flex-row-reverse gap-2"},Ol={key:0,class:"flex flex-wrap gap-2"},Nl=O({__name:"CommentBox",props:{activity:{type:Object,required:!0}},emits:["update"],setup(t,{emit:o}){const d=Ee(),i=t,{getUser:v}=Ze(),{name:m,creation:n,content:u,commenter:f,commentedBy:h,attachments:l}=i.activity,s=E(()=>/has been merged with ticket #\d+/.test(u)),$=o,k=S(!1),w=S(!1),x=S(u),I=S(null),B=S(null);function p(){w.value=!0,B.value.editor.chain().focus("start")}function y(){x.value=u,w.value=!1}const c=ue({url:"frappe.client.delete",makeParams:()=>({doctype:"HD Ticket Comment",name:m}),onSuccess(){$("update"),k.value=!1,fe.success(L("Comment deleted"))}});function b(){if(u===x.value){w.value=!1;return}if(_e(x.value)){fe.error(L("Comment cannot be empty"));return}al.submit({doctype:"HD Ticket Comment",name:m,fieldname:"content",value:x.value},{onSuccess:()=>{w.value=!1,$("update"),fe.success(L("Comment updated"))}})}return se(()=>{I.value.style.width="0px"}),(M,A)=>{const F=U("Tooltip"),q=U("Button");return r(),_(H,null,[a("div",{class:"flex-col text-base flex-1",ref_key:"commentBoxRef",ref:I},[a("div",El,[a("div",Ml,[g(e(Xe),{size:"md",label:e(f),image:e(v)(e(h)).user_image},null,8,["label","image"]),a("p",null,[a("span",Al,T(e(f)),1),a("span",null,T(e(L)("added a")),1),a("span",Fl,T(e(L)("comment")),1)])]),a("div",Dl,[g(F,{text:e(re)(e(n),e(he))},{default:C(()=>[a("span",Pl,T(e(pe)(e(n))),1)]),_:1},8,["text"]),e(d).userId===e(h)&&!w.value?(r(),_("div",jl,[g(e(Le),{placement:"right",options:[{label:"Edit",onClick:()=>p(),icon:"edit-2",condition:()=>!s.value},{label:"Delete",onClick:()=>k.value=!0,icon:"trash-2"}]},{default:C(()=>[g(q,{icon:"more-horizontal",class:"text-gray-600",variant:"ghost"})]),_:1},8,["options"])])):j("",!0)])]),a("div",{id:`comment-${e(m)}`,class:"rounded bg-gray-50 transition-colors px-4 py-3"},[g(e(Me),{ref_key:"editorRef",ref:B,"editor-class":["prose-f shrink text-p-sm transition-all duration-300 ease-in-out block w-full content",e(Ke)(x.value)],content:x.value,editable:w.value,"bubble-menu":e(Ge),onChange:A[0]||(A[0]=N=>{x.value=N})},Rt({_:2},[w.value?{name:"bottom",fn:C(()=>[a("div",Ul,[g(q,{label:e(L)("Save"),onClick:b,variant:"solid"},null,8,["label"]),g(q,{label:e(L)("Discard"),onClick:y},null,8,["label"])])]),key:"0"}:void 0]),1032,["editor-class","content","editable","bubble-menu"]),w.value?j("",!0):(r(),_("div",Ol,[(r(!0),_(H,null,X(e(l),N=>(r(),V(e(Ae),{key:N.file_url,label:N.file_name,url:N.file_url},null,8,["label","url"]))),128))]))],8,Rl)],512),g(e(We),{modelValue:k.value,"onUpdate:modelValue":A[1]||(A[1]=N=>k.value=N),options:{title:"Delete Comment",message:"Are you sure you want to confirm this action?",actions:[{label:"Cancel",onClick:()=>k.value=!1},{label:"Delete",onClick:()=>e(c).submit(),variant:"solid"}]}},null,8,["modelValue","options"])],64)}}}),zl={},ql={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Hl(t,o){return r(),_("svg",ql,[...o[0]||(o[0]=[a("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M6.29021 2.64272C6.68375 0.785763 9.33429 0.785757 9.72783 2.64272L10.3657 5.65238L13.3753 6.29021C15.2323 6.68375 15.2323 9.33429 13.3753 9.72783L10.3657 10.3657L9.72783 13.3753C9.33429 15.2323 6.68375 15.2323 6.29021 13.3753L5.65238 10.3657L2.64272 9.72783C0.785763 9.33429 0.785757 6.68375 2.64272 6.29021L5.65238 5.65238L6.29021 2.64272ZM8.74956 2.85004C8.58 2.04999 7.43804 2.04998 7.26848 2.85004L6.56324 6.17777L6.49584 6.49583L6.17777 6.56324L2.85004 7.26848C2.04999 7.43804 2.04998 8.58 2.85004 8.74956L6.17777 9.4548L6.49584 9.5222L6.56324 9.84027L7.26848 13.168C7.43804 13.9681 8.58 13.9681 8.74956 13.168L9.4548 9.84027L9.5222 9.5222L9.84027 9.4548L13.168 8.74956C13.9681 8.58 13.9681 7.43804 13.168 7.26848L9.84027 6.56324L9.5222 6.49583L9.4548 6.17777L8.74956 2.85004Z",fill:"currentColor"},null,-1)])])}const Zl=ne(zl,[["render",Hl]]),Kl={},Gl={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Wl(t,o){return r(),_("svg",Gl,[...o[0]||(o[0]=[a("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M12.5684 2.50774C11.5403 1.49742 9.95026 1.49742 8.92215 2.50774L3.62404 7.71417C2.12532 9.18695 2.12532 11.669 3.62404 13.1418C5.12762 14.6194 7.66861 14.6194 9.17219 13.1418L12.1609 10.2049C12.3578 10.0113 12.6744 10.0141 12.8679 10.211C13.0615 10.408 13.0587 10.7246 12.8618 10.9181L9.8731 13.8551C7.98045 15.715 4.81578 15.715 2.92313 13.8551C1.02562 11.9904 1.02562 8.86558 2.92313 7.00091L8.22124 1.79449C9.63842 0.401838 11.8521 0.401838 13.2693 1.79449C14.6914 3.19191 14.6914 5.38225 13.2693 6.77968L13.2668 6.78213L13.2668 6.78212L8.37876 11.5189C8.37834 11.5193 8.37793 11.5197 8.37752 11.5201C7.51767 12.3638 6.11144 12.3939 5.29119 11.5097C4.43611 10.6596 4.40778 9.26893 5.30922 8.46081L7.33823 6.46692C7.53518 6.27337 7.85175 6.27613 8.04531 6.47309C8.23886 6.67005 8.23609 6.98662 8.03913 7.18017L6.0014 9.18264L5.99203 9.19185L5.98219 9.20055C5.5391 9.59243 5.5104 10.3231 6.0014 10.8056L6.01078 10.8148L6.01967 10.8245C6.42299 11.2649 7.18224 11.2926 7.67785 10.8056L7.68034 10.8032L7.68035 10.8032L12.5684 6.06643C12.5688 6.06604 12.5692 6.06565 12.5696 6.06526C13.5917 5.05969 13.5913 3.51289 12.5684 2.50774Z",fill:"currentColor"},null,-1)])])}const St=ne(Kl,[["render",Wl]]),Jl={},Yl={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Ql(t,o){return r(),_("svg",Yl,[...o[0]||(o[0]=[a("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M8 2.5C4.2911 2.5 1.5 4.84419 1.5 7.5C1.5 9.14452 2.54729 10.6518 4.25112 11.5816C4.50048 11.7177 4.758 12.0041 4.7326 12.4082C4.71107 12.7508 4.61659 13.2533 4.47175 13.6657C4.44071 13.7541 4.40789 13.8389 4.37434 13.9195C4.62005 13.8524 4.91964 13.7411 5.26646 13.5579C5.48882 13.4404 5.69385 13.2901 5.9102 13.1207C5.95058 13.089 5.9922 13.056 6.03481 13.0222C6.20816 12.8848 6.39803 12.7342 6.58835 12.6102C6.7875 12.4803 7.01146 12.4447 7.20831 12.4631C7.46767 12.4875 7.73186 12.5 8 12.5C11.7089 12.5 14.5 10.1558 14.5 7.5C14.5 4.84419 11.7089 2.5 8 2.5ZM0.5 7.5C0.5 4.08068 3.97691 1.5 8 1.5C12.0231 1.5 15.5 4.08068 15.5 7.5C15.5 10.9193 12.0231 13.5 8 13.5C7.70158 13.5 7.40709 13.4861 7.11751 13.459C6.97583 13.5528 6.83777 13.6621 6.67569 13.7905C6.62832 13.828 6.5789 13.8671 6.52674 13.908C6.30071 14.085 6.03818 14.2812 5.73354 14.4421C4.73389 14.9702 3.9948 15.0302 3.62977 15.0147C3.39759 15.0048 3.20936 14.8646 3.12194 14.6754C3.03801 14.4938 3.05143 14.2816 3.15736 14.1099C3.24804 13.963 3.40655 13.6808 3.52825 13.3343C3.62961 13.0457 3.70134 12.6878 3.72712 12.4347C1.81521 11.3748 0.5 9.58517 0.5 7.5Z",fill:"currentColor"},null,-1)])])}const Be=ne(Jl,[["render",Ql]]),Xl={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},ea=["r"],ta={__name:"DotIcon",props:{radius:{type:Number,default:3.5}},setup(t){return(o,d)=>(r(),_("svg",Xl,[a("circle",{cx:"8",cy:"8",r:t.radius,fill:"currentColor"},null,8,ea)]))}},la={},aa={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function na(t,o){return r(),_("svg",aa,[...o[0]||(o[0]=[a("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M5.85355 3.14645C5.65829 2.95118 5.34171 2.95118 5.14645 3.14645L1.14645 7.14645C0.951184 7.34171 0.951184 7.65829 1.14645 7.85355L5.14645 11.8536C5.34171 12.0488 5.65829 12.0488 5.85355 11.8536C6.04882 11.6583 6.04882 11.3417 5.85355 11.1464L2.20711 7.5L5.85355 3.85355C6.04882 3.65829 6.04882 3.34171 5.85355 3.14645ZM10 8C11.933 8 13.5 9.567 13.5 11.5V12C13.5 12.2761 13.7239 12.5 14 12.5C14.2761 12.5 14.5 12.2761 14.5 12V11.5C14.5 9.01472 12.4853 7 10 7H6.6728L9.81924 3.85355C10.0145 3.65829 10.0145 3.34171 9.81924 3.14645C9.62398 2.95118 9.3074 2.95118 9.11214 3.14645L5.11214 7.14645C4.91688 7.34171 4.91688 7.65829 5.11214 7.85355L9.11214 11.8536C9.3074 12.0488 9.62398 12.0488 9.81924 11.8536C10.0145 11.6583 10.0145 11.3417 9.81924 11.1464L6.6728 8H10Z",fill:"currentColor"},null,-1)])])}const sa=ne(la,[["render",na]]),oa={},ia={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function ra(t,o){return r(),_("svg",ia,[...o[0]||(o[0]=[a("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M5.64645 3.14645C5.84171 2.95118 6.15829 2.95118 6.35355 3.14645C6.54882 3.34171 6.54882 3.65829 6.35355 3.85355L3.20711 7H10C12.4853 7 14.5 9.01472 14.5 11.5V12C14.5 12.2761 14.2761 12.5 14 12.5C13.7239 12.5 13.5 12.2761 13.5 12V11.5C13.5 9.567 11.933 8 10 8H3.20711L6.35355 11.1464C6.54882 11.3417 6.54882 11.6583 6.35355 11.8536C6.15829 12.0488 5.84171 12.0488 5.64645 11.8536L1.64645 7.85355C1.45118 7.65829 1.45118 7.34171 1.64645 7.14645L5.64645 3.14645Z",fill:"currentColor"},null,-1)])])}const ua=ne(oa,[["render",ra]]),ca={},da={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function ma(t,o){return r(),_("svg",da,[...o[0]||(o[0]=[a("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M5.85355 9.64645C5.65829 9.45118 5.34171 9.45118 5.14645 9.64645C4.95118 9.84171 4.95118 10.1583 5.14645 10.3536L7.64645 12.8536C7.84171 13.0488 8.15829 13.0488 8.35355 12.8536L10.8536 10.3536C11.0488 10.1583 11.0488 9.84171 10.8536 9.64645C10.6583 9.45118 10.3417 9.45118 10.1464 9.64645L8 11.7929L5.85355 9.64645ZM5.85355 6.35355C5.65829 6.54882 5.34171 6.54882 5.14645 6.35355C4.95118 6.15829 4.95118 5.84171 5.14645 5.64645L7.64645 3.14645C7.84171 2.95118 8.15829 2.95118 8.35355 3.14645L10.8536 5.64645C11.0488 5.84171 11.0488 6.15829 10.8536 6.35355C10.6583 6.54882 10.3417 6.54882 10.1464 6.35355L8 4.20711L5.85355 6.35355Z",fill:"currentColor"},null,-1)])])}const fa=ne(ca,[["render",ma]]),pa=Ut("agent",()=>{const t=ct({doctype:"HD Agent",fields:["name","agent_name","user","user.user_image"],filters:{is_active:1},pageLength:99999}),o=E(()=>{var i;return(i=t.data)==null?void 0:i.map(v=>({label:v.agent_name,value:v.name}))});function d(i){return t.data.filter(v=>{var m;return(m=v.user)==null?void 0:m.toLowerCase().includes(i.toLowerCase())})}return{dropdown:o,agents:t,searchAgents:d}}),va={key:0,class:"flex flex-col gap-2 px-6 md:pl-10 md:pr-9"},ga={class:"flex flex-wrap gap-2"},xa={class:"flex justify-between overflow-hidden border-t py-2.5"},ya={class:"flex items-center overflow-x-auto w-[60%]"},ba={class:"flex items-center justify-end space-x-2 w-[40%]"},ha=O({__name:"CommentTextEditor",props:{ticketId:{type:String,default:null},placeholder:{type:String,default:null},label:{type:String,default:"Comment"},editable:{type:Boolean,default:!0},doctype:{type:String,default:"HD Ticket"}},emits:["submit","discard"],setup(t,{expose:o,emit:d}){const{updateOnboardingStep:i}=yt("helpdesk"),{agents:v}=pa(),{isManager:m}=Ee();se(()=>{var c;v.loading||(c=v.data)!=null&&c.length||v.list.promise||v.fetch()});const n=t,u=d,f=dt("commentBoxContent"+n.ticketId,null),{onUserType:h,cleanup:l}=Qe(n.ticketId),s=S([]),$=E(()=>_e(f.value)),k=S(!1);Y(f,(c,b)=>{c!==b&&c&&h()}),Je(()=>{l()});const w=E(()=>k.value?"Sending...":n.label),x=E(()=>{var c;return((c=v.data)==null?void 0:c.map(b=>({label:b.agent_name.trimEnd(),value:b.name})))||[]});function I(c){s.value=s.value.filter(b=>b!==c),ft(c.name)}async function B(){if(_e(f.value))return!1;ue({url:"run_doc_method",makeParams:()=>({dt:n.doctype,dn:n.ticketId,method:"new_comment",args:{content:f.value,attachments:s.value}}),onSuccess:()=>{m&&i("comment_on_ticket"),u("submit"),k.value=!1,s.value=[],f.value=null},onError:()=>{k.value=!1}}).submit()}const p=S(null),y=E(()=>{var c;return(c=p.value)==null?void 0:c.editor});return o({submitComment:B,editor:y}),(c,b)=>{const M=U("FeatherIcon"),A=U("Button");return e(v).data?(r(),V(e(Me),{key:0,ref_key:"editorRef",ref:p,"editor-class":["prose-sm max-w-none",t.editable&&"min-h-[7rem] mx-6 md:ml-10 md:mr-9 max-h-[50vh] overflow-y-auto border-t py-3",e(Ke)(e(f))],content:e(f),"starterkit-options":{heading:{levels:[2,3,4,5,6]}},placeholder:t.placeholder,editable:t.editable,mentions:x.value,onChange:b[3]||(b[3]=F=>t.editable?f.value=F:null),extensions:[e(bt)],uploadFunction:F=>e(mt)(F,t.doctype,t.ticketId)},{bottom:C(()=>[t.editable?(r(),_("div",va,[a("div",ga,[(r(!0),_(H,null,X(s.value,F=>(r(),V(e(Ae),{key:F.file_url,label:F.file_name,url:["MOV","MP4"].includes(F.file_type)?null:F.file_url},{suffix:C(()=>[g(M,{class:"h-3.5",name:"x",onClick:Q(q=>I(F),["stop"])},null,8,["onClick"])]),_:2},1032,["label","url"]))),128))]),a("div",xa,[a("div",ya,[g(e(Ct),{class:"-ml-1",buttons:e(Ge)},null,8,["buttons"]),g(e(_t),{"upload-args":{doctype:t.doctype,docname:t.ticketId,private:!0},onSuccess:b[0]||(b[0]=F=>s.value.push(F))},{default:C(({openFileSelector:F})=>[g(A,{theme:"gray",variant:"ghost",onClick:q=>F()},{icon:C(()=>[g(e(St),{class:"h-4",style:{color:"#000000","stroke-width":"1.5 !important"}})]),_:1},8,["onClick"])]),_:1},8,["upload-args"])]),a("div",ba,[g(A,{label:e(L)("Discard"),onClick:b[1]||(b[1]=()=>{f.value="",s.value=[],u("discard")})},null,8,["label"]),g(A,{variant:"solid",label:w.value,disabled:$.value,loading:k.value,onClick:b[2]||(b[2]=()=>{k.value=!0,B(),f.value=""})},null,8,["label","disabled","loading"])])])])):j("",!0)]),_:1},8,["editor-class","content","placeholder","editable","mentions","extensions","uploadFunction"])):j("",!0)}}}),_a={class:"comm-area"},Ca={class:"flex justify-between gap-3 border-t px-6 md:px-10 py-4 md:py-2.5"},ka={class:"flex gap-1.5 items-center"},wa=["onKeydownCapture"],$a=["onKeydownCapture"],Ls=O({__name:"CommunicationArea",props:ae({doctype:{type:String,default:"HD Ticket"},ticketId:{type:String,default:null},toEmails:{type:Array,default:()=>[]},ccEmails:{type:Array,default:()=>[]},bccEmails:{type:Array,default:()=>[]}},{content:{},contentModifiers:{},modelValue:{},modelModifiers:{}}),emits:ae(["update"],["update:content","update:modelValue"]),setup(t,{expose:o,emit:d}){const i=d,v=ie(t,"content"),{isMac:m}=el(),{isMobileView:n}=pt();ie(t,"modelValue");const u=S(null),f=S(null),h=S(null),l=S(null),s=t,{notifyTicketUpdate:$}=tl(Ot(s,"ticketId"));function k(){W.value&&(W.value=!1),G.value=!G.value}function w(){G.value&&(G.value=!1),W.value=!W.value}function x(){u.value.submitMail()&&(i("update"),$("communication",new Date().toISOString()))}function I(){f.value.submitComment()&&(i("update"),$("comment",new Date().toISOString()))}function B(y){return typeof y=="string"?y.split(","):y}function p(y){G.value=!0,u.value.addToReply(y.content,B(y.to),B(y.cc),B(y.bcc))}return Y(()=>G.value,y=>{var c,b,M;y&&((M=(b=(c=u.value)==null?void 0:c.editor)==null?void 0:b.commands)==null||M.focus())}),Y(()=>W.value,y=>{var c,b,M;y&&((M=(b=(c=f.value)==null?void 0:c.editor)==null?void 0:b.commands)==null||M.focus())}),it("r",()=>{k()}),it("c",()=>{w()}),o({replyToEmail:p,toggleEmailBox:k,toggleCommentBox:w,editor:u}),nt(h,()=>{G.value&&(G.value=!1)}),nt(l,()=>{W.value&&(W.value=!1)}),(y,c)=>{const b=U("Button");return r(),_("div",_a,[a("div",Ca,[a("div",ka,[g(b,{ref:"sendEmailRef",variant:"ghost",label:e(L)("Reply"),class:K([e(G)?"!bg-gray-300 hover:!bg-gray-200":""]),onClick:c[0]||(c[0]=M=>k())},{prefix:C(()=>[g(e(Fe),{class:"h-4"})]),_:1},8,["label","class"]),g(b,{variant:"ghost",label:e(L)("Comment"),class:K([e(W)?"!bg-gray-300 hover:!bg-gray-200":""]),onClick:c[1]||(c[1]=M=>w())},{prefix:C(()=>[g(e(Be),{class:"h-4"})]),_:1},8,["label","class"]),g(e(Ln),{ticketId:t.ticketId},null,8,["ticketId"])])]),Oe(a("div",{ref_key:"emailBoxRef",ref:h,class:"flex gap-1.5 flex-1",onKeydownCapture:[me(Q(x,["ctrl","stop"]),["enter"]),me(Q(x,["meta","stop"]),["enter"])]},[g(e(on),{ref_key:"emailEditorRef",ref:u,label:e(n)?"Send":e(m)?"Send (⌘ + ⏎)":"Send (Ctrl + ⏎)",content:v.value,"onUpdate:content":c[2]||(c[2]=M=>v.value=M),placeholder:e(L)("Hi John, we are looking into this issue."),ticketId:t.ticketId,"to-emails":t.toEmails,"cc-emails":t.ccEmails,"bcc-emails":t.bccEmails,onSubmit:c[3]||(c[3]=()=>{G.value=!1,i("update")}),onDiscard:c[4]||(c[4]=()=>{G.value=!1})},null,8,["label","content","placeholder","ticketId","to-emails","cc-emails","bcc-emails"])],40,wa),[[Ne,e(G)]]),Oe(a("div",{ref_key:"commentBoxRef",ref:l,onKeydownCapture:[me(Q(I,["ctrl","stop"]),["enter"]),me(Q(I,["meta","stop"]),["enter"])]},[g(e(ha),{ref_key:"commentTextEditorRef",ref:f,label:e(n)?"Comment":e(m)?"Comment (⌘ + ⏎)":"Comment (Ctrl + ⏎)",ticketId:t.ticketId,editable:e(W),doctype:t.doctype,placeholder:e(L)("@John could you please look into this?"),onSubmit:c[5]||(c[5]=()=>{W.value=!1,i("update")}),onDiscard:c[6]||(c[6]=()=>{W.value=!1})},null,8,["label","ticketId","editable","doctype","placeholder"])],40,$a),[[Ne,e(W)]])])}}}),Ia={class:"flex flex-col gap-4"},Ta={class:"text-p-base text-ink-gray-8"},Sa={class:"underline"},La={class:"flex items-center gap-2 rounded-md p-2 ring-1 ring-gray-200"},Ba=O({__name:"TicketSplitModal",props:ae({ticket_id:{},communication_id:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:ae(["update"],["update:modelValue"]),setup(t,{emit:o}){const d=t,i=ie(t,"modelValue"),v=S(null),m=ue({url:"helpdesk.helpdesk.doctype.hd_ticket.api.split_ticket",makeParams({subject:u,communication_id:f}){return{subject:u,communication_id:f}},validate({subject:u,communication_id:f}){if(!u)throw{message:"Subject is required"};if(!f)throw{message:"Communication ID is required"}},onSuccess:u=>{fe.success(L("Ticket split successfully")),i.value=!1,window.open(window.location.origin+"/helpdesk/tickets/"+u,"_blank"),window.location.reload()}});function n(){m.submit({subject:v.value,communication_id:d.communication_id})}return(u,f)=>{const h=U("FormControl"),l=U("Button");return r(),V(e(We),{options:{title:"Split ticket"},modelValue:i.value,"onUpdate:modelValue":f[1]||(f[1]=s=>i.value=s)},{"body-content":C(()=>[a("div",Ia,[a("p",Ta,[Se(T(e(L)("All"))+" ",1),a("span",Sa,T(e(L)("emails/ comments")),1),Se(" "+T(e(L)("from this email onwards will be moved to new ticket.")),1)]),g(h,{label:e(L)("New Ticket Subject"),type:"text",modelValue:v.value,"onUpdate:modelValue":f[0]||(f[0]=s=>v.value=s),placeholder:e(L)("Add a subject for the new ticket")},null,8,["label","modelValue","placeholder"]),a("div",La,[g(e(ll),{class:"h-6 w-5 w-min-5 w-max-5 min-h-5 max-w-5 text-yellow-500"}),f[2]||(f[2]=a("div",{class:"text-wrap text-sm text-gray-700"}," This action is irreversible. ",-1))])])]),actions:C(()=>[g(l,{class:"w-full",variant:"solid",label:e(L)("Split into new ticket"),loading:e(m).loading,"icon-left":e(ht),onClick:n},null,8,["label","loading","icon-left"])]),_:1},8,["modelValue"])}}}),Va=["id"],Ea={key:0,class:"flex items-center gap-2 text-sm"},Ma={class:"leading-tight"},Aa={class:"text-xs md:text-sm text-gray-600"},Fa={key:0,class:"sm:flex hidden text-sm text-gray-600"},Da={key:1,class:"flex items-center gap-1"},Pa={key:0,class:"sm:flex hidden text-sm text-gray-600"},ja={class:"flex gap-0.5 items-center"},Ra={class:"text-xs md:text-sm text-gray-600"},Ua={class:"text-sm leading-5 text-gray-600"},Oa={key:0,class:"text-2xs mr-1 font-bold text-gray-500"},Na={key:1},za={key:2},qa={key:3,class:"text-2xs mr-1 font-bold text-gray-500"},Ha={key:4},Za={key:5},Ka={key:6,class:"text-2xs mr-1 font-bold text-gray-500"},Ga={key:7},Wa={class:"flex flex-wrap gap-2"},Ja=O({__name:"EmailArea",props:{activity:{type:Object,required:!0},showSplitOption:{type:Boolean,default:!1}},emits:["reply"],setup(t,{emit:o}){const d=t,{sender:i,to:v,cc:m,bcc:n,creation:u,subject:f,attachments:h,content:l,name:s,deliveryStatus:$}=d.activity,k=o,w=Ye(Ee()),{isMobileView:x}=pt(),I=S(!1),B=E(()=>{let c=$,b="red";return["Sent","Clicked"].includes(c)?b="green":["Sending","Scheduled"].includes(c)?b="orange":["Opened","Read"].includes(c)?b="blue":c=="Error"&&(b="red"),{label:c,color:b}}),p=()=>{const c=w.user.value;k("reply",{content:l,to:c===i.name?v:i.name})},y=()=>{const c=w.user.value,b=ge=>{let xe;return typeof ge=="string"?xe=ge.split(",").map(ce=>ce.trim()):xe=ge||[],xe.filter(ce=>ce!==c&&ce!==i.name)},M=b(v),A=b(m),F=b(n);let q,N,ve;c===i.name?(q=M.join(", "),N=A,ve=F):(q=i.name,N=[...M,...A],ve=F),k("reply",{content:l,to:q,cc:N.filter(Boolean),bcc:ve.filter(Boolean)})};return(c,b)=>{const M=U("Tooltip"),A=U("Badge"),F=U("Button"),q=dl;return r(),_(H,null,[a("div",ke({id:`communication-${e(s)}`},c.$attrs,{class:"grow cursor-pointer border-transparent bg-white rounded-md shadow text-base leading-6 transition-all duration-300 ease-in-out"}),[a("div",{class:K(["flex items-center justify-between gap-2",e(x)&&"items-start"])},[e(x)?(r(),_("div",Ea,[a("div",Ma,[a("p",null,T(e(i).full_name||"No name found"),1),g(M,{text:e(re)(e(u),e(he))},{default:C(()=>[a("p",Aa,T(e(pe)(e(u))),1)]),_:1},8,["text"]),e(i).name?(r(),_("p",Fa,T("<"+e(i).name+">"),1)):j("",!0)])])):(r(),_("div",Da,[a("span",null,T(e(i).full_name||"No name found"),1),e(i).name?(r(),_("span",Pa,T("<"+e(i).name+">"),1)):j("",!0)])),a("div",ja,[B.value.label?(r(),V(A,{key:0,label:e(L)(B.value.label),variant:"subtle",theme:B.value.color,class:"mr-1.5"},null,8,["label","theme"])):j("",!0),e(x)?j("",!0):(r(),V(M,{key:1,text:e(re)(e(u),e(he))},{default:C(()=>[a("p",Ra,T(e(pe)(e(u))),1)]),_:1},8,["text"])),g(F,{variant:"ghost",class:"text-gray-700",onClick:p},{default:C(()=>[g(e(ua),{class:"h-4 w-4"})]),_:1}),g(F,{variant:"ghost",class:"text-gray-700",onClick:y},{default:C(()=>[g(e(sa),{class:"h-4 w-4"})]),_:1}),t.showSplitOption?(r(),V(e(Le),{key:2,placement:"right",options:[{label:"Split Ticket",icon:e(ht),onClick:()=>I.value=!0}]},{default:C(()=>[g(F,{icon:"more-horizontal",class:"text-gray-600",variant:"ghost"})]),_:1},8,["options"])):j("",!0)])],2),a("div",Ua,[e(v)?(r(),_("span",Oa,T(e(L)("TO:")),1)):j("",!0),e(v)?(r(),_("span",Na,T(e(v)),1)):j("",!0),e(m)?(r(),_("span",za,T(e(L)(",")),1)):j("",!0),e(m)?(r(),_("span",qa,T(e(L)("CC:")),1)):j("",!0),e(m)?(r(),_("span",Ha,T(e(m)),1)):j("",!0),e(n)?(r(),_("span",Za,T(e(L)(",")),1)):j("",!0),e(n)?(r(),_("span",Ka,T(e(L)("BCC:")),1)):j("",!0),e(n)?(r(),_("span",Ga,T(e(n)),1)):j("",!0)]),b[1]||(b[1]=a("div",{class:"border-0 border-t my-3 border-outline-gray-modals"},null,-1)),g(q,{content:e(l)},null,8,["content"]),a("div",Wa,[(r(!0),_(H,null,X(e(h),N=>(r(),V(e(Ae),{key:N.file_url,label:N.file_name,url:N.file_url},null,8,["label","url"]))),128))])],16,Va),g(Ba,{modelValue:I.value,"onUpdate:modelValue":b[0]||(b[0]=N=>I.value=N),ticket_id:e(s),communication_id:e(s)},null,8,["modelValue","ticket_id","communication_id"])],64)}}}),Ya={class:"mx-6 md:mx-10 flex items-center gap-2 border-y py-2.5"},Qa={class:"text-xs text-gray-500"},Xa={class:"text-xs text-gray-500"},en={class:"text-xs text-gray-500"},tn={class:"flex flex-wrap gap-2 px-10"},ln={class:"flex justify-between overflow-scroll pl-10 py-2.5 items-center"},an={class:"flex items-center overflow-x-auto w-[60%]"},nn={class:"flex gap-1"},sn={class:"flex items-center justify-end space-x-2 sm:mt-0 w-[40%] mr-9"},on=O({__name:"EmailEditor",props:{ticketId:{type:String,default:null},placeholder:{type:String,default:null},label:{type:String,default:"Send"},editable:{type:Boolean,default:!0},doctype:{type:String,default:"HD Ticket"},toEmails:{type:Array,default:()=>[]},ccEmails:{type:Array,default:()=>[]},bccEmails:{type:Array,default:()=>[]}},emits:["submit","discard"],setup(t,{expose:o,emit:d}){const i=S(null),v=S(!1),m=t,n=E(()=>q.loading?"Sending...":m.label),u=d,f=dt("emailBoxContent"+m.ticketId,null),{updateOnboardingStep:h}=yt("helpdesk"),{isManager:l}=Ee(),{onUserType:s,cleanup:$}=Qe(m.ticketId),k=S([]),w=E(()=>_e(f.value));Y(f,(z,R)=>{z!==R&&z&&s()}),Je(()=>{$()});const x=S([...m.toEmails]),I=S([...m.ccEmails]),B=S([...m.bccEmails]),p=S(!1),y=S(!1),c=E(()=>{var z;return!!((z=I.value)!=null&&z.length)}),b=E(()=>{var z;return!!((z=B.value)!=null&&z.length)}),M=S(null),A=S(null);function F(z){f.value=z.message,v.value=!1}const q=ue({url:"run_doc_method",makeParams:()=>{var z,R;return{dt:m.doctype,dn:m.ticketId,method:"reply_via_agent",args:{attachments:k.value.map(ee=>ee.name),to:x.value.join(","),cc:(z=I.value)==null?void 0:z.join(","),bcc:(R=B.value)==null?void 0:R.join(","),message:f.value}}},onSuccess:()=>{Lt(),u("submit"),l&&h("reply_on_ticket")},debounce:300});function N(){if(_e(f.value))return!1;if(!x.value.length)return fe.warning("Email has no recipients. Please add at least one email address in the 'TO' field."),!1;q.submit()}function ve(){p.value=!p.value,p.value&&oe(()=>{M.value.setFocus()})}function ge(){y.value=!y.value,y.value&&oe(()=>{A.value.setFocus()})}async function xe(z){k.value=k.value.filter(R=>R!==z),await ft(z.name)}function ce(z,R,ee,De){x.value=R,I.value=ee,B.value=De,i.value.editor.chain().clearContent().insertContent(z).focus("all").setBlockquote().insertContentAt(0,{type:"paragraph"}).focus("start").run()}function Lt(){f.value=null,k.value=[]}function Bt(){k.value=[],f.value=null,I.value=[],B.value=[],I.value=[],p.value=!1,y.value=!1,u("discard")}const Vt=E(()=>i.value.editor);return o({addToReply:ce,editor:Vt,submitMail:N}),(z,R)=>{const ee=U("Button"),De=U("FeatherIcon");return r(),_(H,null,[g(e(Me),{ref_key:"editorRef",ref:i,"editor-class":["prose-sm max-w-full mx-6 md:mx-10 max-h-[50vh] py-3","min-h-[7rem]",e(Ke)(e(f)),t.editable&&"!max-h-[35vh] overflow-y-auto"],content:e(f),"starterkit-options":{heading:{levels:[2,3,4,5,6]}},placeholder:t.placeholder,editable:t.editable,onChange:R[8]||(R[8]=D=>t.editable?f.value=D:null),extensions:[e(bt)],uploadFunction:D=>e(mt)(D,t.doctype,t.ticketId)},{top:C(()=>[a("div",Ya,[a("span",Qa,T(e(L)("TO:")),1),g(e(Re),{modelValue:x.value,"onUpdate:modelValue":R[0]||(R[0]=D=>x.value=D),class:"flex-1",validate:e(Pe),"error-message":D=>`${D} is an invalid email address`},null,8,["modelValue","validate","error-message"]),g(ee,{label:e(L)("CC"),class:K([c.value?"bg-gray-300 hover:bg-gray-200":""]),onClick:R[1]||(R[1]=D=>ve())},null,8,["label","class"]),g(ee,{label:e(L)("BCC"),class:K([b.value?"bg-gray-300 hover:bg-gray-200":""]),onClick:R[2]||(R[2]=D=>ge())},null,8,["label","class"])]),p.value||c.value?(r(),_("div",{key:0,class:K(["mx-10 flex items-center gap-2 py-2.5",c.value||p.value?"border-b":""])},[a("span",Xa,T(e(L)("CC:")),1),g(e(Re),{ref_key:"ccInput",ref:M,modelValue:I.value,"onUpdate:modelValue":R[3]||(R[3]=D=>I.value=D),class:"flex-1",validate:e(Pe),"error-message":D=>`${D} is an invalid email address`},null,8,["modelValue","validate","error-message"])],2)):j("",!0),y.value||b.value?(r(),_("div",{key:1,class:K(["mx-10 flex items-center gap-2 py-2.5",b.value||y.value?"border-b":""])},[a("span",en,T(e(L)("BCC:")),1),g(e(Re),{ref_key:"bccInput",ref:A,modelValue:B.value,"onUpdate:modelValue":R[4]||(R[4]=D=>B.value=D),class:"flex-1",validate:e(Pe),"error-message":D=>`${D} is an invalid email address`},null,8,["modelValue","validate","error-message"])],2)):j("",!0)]),bottom:C(()=>[a("div",tn,[(r(!0),_(H,null,X(k.value,D=>(r(),V(e(Ae),{key:D.file_url,label:D.file_name,url:["MOV","MP4"].includes(D.file_type)?null:D.file_url},{suffix:C(()=>[g(De,{class:"h-3.5",name:"x",onClick:Q(Et=>xe(D),["self","stop"])},null,8,["onClick"])]),_:2},1032,["label","url"]))),128))]),a("div",ln,[a("div",an,[a("div",nn,[g(e(_t),{"upload-args":{doctype:t.doctype,docname:t.ticketId,private:!0},onSuccess:R[5]||(R[5]=D=>{k.value.push(D)})},{default:C(({openFileSelector:D})=>[g(ee,{variant:"ghost",onClick:Et=>D()},{icon:C(()=>[g(e(St),{class:"h-4",style:{color:"#000000","stroke-width":"1.5 !important"}})]),_:1},8,["onClick"])]),_:1},8,["upload-args"]),g(ee,{variant:"ghost",onClick:R[6]||(R[6]=D=>v.value=!0)},{icon:C(()=>[g(e(Fe),{class:"h-4",style:{color:"#000000","stroke-width":"1.2"}})]),_:1})]),g(e(Ct),{class:"ml-1",buttons:e(Ge)},null,8,["buttons"])]),a("div",sn,[g(ee,{label:e(L)("Discard"),onClick:Bt},null,8,["label"]),g(ee,{variant:"solid",disabled:w.value,loading:e(q).loading,label:n.value,onClick:R[7]||(R[7]=()=>{N()})},null,8,["disabled","loading","label"])])])]),_:1},8,["editor-class","content","placeholder","editable","extensions","uploadFunction"]),v.value?(r(),V(e(Vl),{key:0,modelValue:v.value,"onUpdate:modelValue":R[9]||(R[9]=D=>v.value=D),doctype:t.doctype,onApply:F},null,8,["modelValue","doctype"])):j("",!0)],64)}}}),rn={class:"flex-1"},un={class:"mt-1.5 flex justify-between text-base items-start md:items-center"},cn={key:0,class:"inline-flex flex-wrap gap-1.5 text-ink-gray-8 font-medium w-4/5"},dn={key:1,class:"text-gray-600 w-4/6"},mn={class:"font-medium text-gray-800"},fn={class:"text-gray-600 text-sm w-2/6 flex justify-end"},pn={key:0},vn={class:"text-gray-600 w-4/6"},gn={class:"font-medium text-gray-800"},xn={class:"text-gray-600 text-sm w-2/6 flex justify-end"},yn=O({__name:"HistoryBox",props:{activity:{type:Object,required:!0}},setup(t){const o=t,{user:d,content:i,creation:v,relatedActivities:m}=o.activity;let n=S(!1);return(u,f)=>{const h=U("Button"),l=U("Tooltip");return r(),_("div",rn,[a("div",un,[e(m).length>1?(r(),_("div",cn,[a("span",null,T(`${e(n)?"Hide ":"Show "}`),1),a("span",null,"+"+T(e(m).length),1),a("span",null,T(e(L)("changes from")),1),a("span",null,T(e(d)),1),g(h,{class:"!size-4",variant:"ghost",onClick:f[0]||(f[0]=s=>Nt(n)?n.value=!e(n):n=!e(n))},{icon:C(()=>[g(e(fa))]),_:1})])):(r(),_("div",dn,[a("span",mn,T(e(d)),1),a("span",null,T(e(i)),1)])),g(l,{text:e(re)(e(v),e(he))},{default:C(()=>[a("div",fn,T(e(pe)(e(v))),1)]),_:1},8,["text"])]),e(n)?(r(),_("div",pn,[(r(!0),_(H,null,X(e(m),s=>(r(),_("div",{key:s.creation,class:"mt-2 flex justify-between text-base"},[a("div",vn,[a("span",gn,T(s.user),1),a("span",null,T(s.content),1)]),g(l,{text:e(re)(s.creation,e(he))},{default:C(()=>[a("div",xn,T(e(pe)(s.creation)),1)]),_:2},1032,["text"])]))),128))])):j("",!0)])}}}),bn={class:"flex flex-wrap gap-1"},hn={class:"flex-1"},_n={class:"mt-1 rounded-lg bg-white py-1 text-base shadow-2xl"},Cn={class:"flex flex-col gap-1 p-1 text-gray-800"},kn={class:"text-base font-medium"},wn={class:"text-sm text-gray-600"},Re=O({__name:"MultiSelectInput",props:ae({validate:{type:Function,default:null},errorMessage:{type:Function,default:t=>`${t} is an Invalid value`}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(t,{expose:o}){const d=t,i=ie(t,"modelValue"),v=S([]),m=S(null),n=S(null),u=S(""),f=S(""),h=S(!1),l=E({get:()=>u.value||"",set:p=>{u.value="",p&&(h.value=!1),p!=null&&p.value&&w(p.value)}});zt(u,p=>{p=p||"",f.value!==p&&(f.value=p,k(p))},{debounce:300,immediate:!0});const s=ue({url:"helpdesk.api.contact.search_contacts",method:"GET",cache:["Contact",f.value],params:{txt:f.value},transform:p=>p.map(({full_name:y,email_id:c,name:b})=>({label:y||b||c,value:c}))}),$=E(()=>{let p=s.data||[];return!p.length&&u.value&&p.push({label:u.value,value:u.value}),p});function k(p){s.update({params:{txt:p}}),s.reload()}const w=p=>{n.value=null,p&&(p.split(",").forEach(c=>{var b;if(c=c.trim(),c&&!((b=i.value)!=null&&b.includes(c))){if(c&&d.validate&&!d.validate(c)){n.value=d.errorMessage(c);return}i.value?i.value.push(c):i.value=[c],c=c.replace(c,"")}}),!n.value&&(p=""))},x=p=>{i.value=i.value.filter(y=>y!==p)},I=()=>{var y;if(u.value)return;let p=(y=v.value[v.value.length-1])==null?void 0:y.$el;document.activeElement===p?(i.value.pop(),oe(()=>{i.value.length?(p=v.value[v.value.length-1].$el,p==null||p.focus()):B()})):p==null||p.focus()};function B(){m.value.$el.focus()}return o({setFocus:B}),(p,y)=>{const c=U("FeatherIcon"),b=U("Button"),M=U("ErrorMessage");return r(),_("div",null,[a("div",bn,[(r(!0),_(H,null,X(i.value,A=>(r(),V(b,{ref_for:!0,ref_key:"emails",ref:v,key:A,label:A,theme:"gray",variant:"subtle",class:"rounded-full",onKeydownCapture:me(Q(I,["stop"]),["delete"])},{suffix:C(()=>[g(c,{class:"h-3.5",name:"x",onClick:Q(F=>x(A),["stop"])},null,8,["onClick"])]),_:2},1032,["label","onKeydownCapture"]))),128)),a("div",hn,[g(e(Gt),{modelValue:l.value,"onUpdate:modelValue":y[2]||(y[2]=A=>l.value=A),nullable:""},{default:C(()=>[g(e(qt),{show:h.value,"onUpdate:show":y[1]||(y[1]=A=>h.value=A),class:"w-full"},{target:C(({togglePopover:A})=>[g(e(Ht),{ref_key:"search",ref:m,class:"search-input form-input w-full border-none bg-white hover:bg-white focus:border-none focus:!shadow-none focus-visible:!ring-0",type:"text",value:u.value,autocomplete:"off",onChange:y[0]||(y[0]=F=>{u.value=F.target.value,h.value=!0}),onFocus:()=>A(),onKeydownCapture:me(Q(I,["stop"]),["delete"])},null,8,["value","onFocus","onKeydownCapture"])]),body:C(({isOpen:A})=>[Oe(a("div",null,[a("div",_n,[g(e(Zt),{class:"my-1 max-h-[12rem] overflow-y-auto px-1.5",static:""},{default:C(()=>[(r(!0),_(H,null,X($.value,F=>(r(),V(e(Kt),{key:F.value,value:F},{default:C(({active:q})=>[a("li",{class:K(["flex cursor-pointer items-center rounded px-2 py-1 text-base",{"bg-gray-100":q}])},[g(e(kt),{class:"mr-2",name:F.value,size:"lg"},null,8,["name"]),a("div",Cn,[a("div",kn,T(F.label),1),a("div",wn,T(F.value),1)])],2)]),_:2},1032,["value"]))),128))]),_:1})])],512),[[Ne,A]])]),_:1},8,["show"])]),_:1},8,["modelValue"])])]),n.value?(r(),V(M,{key:0,class:"mt-2 pl-2",message:n.value},null,8,["message"])):j("",!0)])}}}),$n={key:0,class:"pl-2"},In={class:"flex items-center gap-2 text-sm text-gray-600"},Tn={class:"flex items-center gap-1.5"},Sn=O({__name:"TypingIndicator",props:{ticketId:{type:String,required:!0}},setup(t){const o=t,{typingUsers:d,cleanup:i}=Qe(o.ticketId),v=E(()=>{var f,h;const m=d.length;if(m===0)return null;const{getUser:n}=Ze();let u=((f=n(d[0]))==null?void 0:f.full_name)||d[0];return console.log(u),console.log(d),m===1?P("div",{class:"flex items-center gap-1"},[P(kt,{name:d[0],size:"sm"}),P("span",{class:"text-ink-gray-6 font-medium"},u),P("span",{class:"text-ink-gray-5"}," is typing")]):m===2?P("div",{class:"flex items-center gap-1"},[P("span",{class:"text-ink-gray-6 font-medium"},u),P("span",{class:"text-ink-gray-5"}," and "),P("span",{class:"text-ink-gray-6 font-medium"},(h=n(d[1]))==null?void 0:h.full_name),P("span",{class:"text-ink-gray-5"}," are typing")]):P("div",{class:"flex items-center gap-1"},[P("span",{class:"text-ink-gray-6 font-medium"},u),P("span",{class:"text-ink-gray-5"}," and "),P("span",{class:"text-ink-gray-6 font-medium"},`${m-1} others`),P("span",{class:"text-ink-gray-5"}," are typing")])});return Je(()=>{i()}),(m,n)=>e(d).length>0?(r(),_("div",$n,[a("div",In,[a("div",Tn,[(r(),V(Ve(v.value))),n[0]||(n[0]=a("div",{class:"typing-dots"},[a("span"),a("span"),a("span")],-1))])])])):j("",!0)}}),Ln=ne(Sn,[["__scopeId","data-v-3f215bd3"]]),Bn={class:"text-base text-ink-gray-6"},Vn={class:"flex flex-col gap-2 mt-6"},Bs=O({__name:"SetContactPhoneModal",props:ae({name:{type:String,required:!0}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:ae(["onUpdate"],["update:modelValue"]),setup(t,{emit:o}){const d=o,i=ie(t,"modelValue"),v=S(""),m=t,n=S({name:"",phone:""}),u=()=>{if(Wt().regex(/^\+(?:[0-9]){6,14}[0-9]$/).safeParse(n.value.phone).success)v.value="";else{v.value="Invalid phone number";return}ue({url:"frappe.client.set_value",params:{doctype:"Contact",name:m.name,fieldname:"phone_nos",value:[{phone:n.value.phone,is_primary_phone:!0}]},auto:!0,onSuccess:()=>{d("onUpdate"),fe.success(L("Contact updated")),i.value=!1}})};return Y(i,f=>{f&&(n.value={name:m.name,phone:""})}),(f,h)=>{const l=U("FormControl");return r(),V(e(We),{modelValue:i.value,"onUpdate:modelValue":h[1]||(h[1]=s=>i.value=s),options:{title:"Set Phone Number",actions:[{label:"Set Phone Number",variant:"solid",onClick:u}]}},{"body-content":C(()=>[a("div",null,[a("div",Bn,[a("b",null,T(n.value.name),1),h[2]||(h[2]=Se(" does not have a phone number, set one to call them. ",-1))]),a("div",Vn,[g(l,{modelValue:n.value.phone,"onUpdate:modelValue":h[0]||(h[0]=s=>n.value.phone=s),label:e(L)("Phone"),type:"text",size:"sm",variant:"subtle",placeholder:e(L)("+918956895623"),disabled:!1},null,8,["modelValue","label","placeholder"]),g(e(Jt),{message:v.value},null,8,["message"])])])]),_:1},8,["modelValue","options"])}}}),En={},Mn={width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function An(t,o){return r(),_("svg",Mn,[...o[0]||(o[0]=[a("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M3.76527 2.76476L3.76515 2.76469C3.76518 2.76471 3.76516 2.7647 3.76508 2.76466C3.76417 2.76417 3.75528 2.75942 3.73828 2.7571V9.24215C3.75528 9.23982 3.76418 9.23508 3.76508 9.23459C3.76516 9.23455 3.76518 9.23454 3.76515 9.23456L3.76527 9.23448L8.75611 5.99962L3.76527 2.76476ZM9.5471 6.67863L4.30917 10.0736C4.01166 10.2665 3.61363 10.2975 3.28101 10.1538C2.94839 10.01 2.73828 9.71611 2.73828 9.39463V2.60462C2.73828 2.28313 2.94839 1.98924 3.28101 1.84547C3.61363 1.7017 4.01166 1.73272 4.30917 1.92561L9.5471 5.32062C9.79432 5.48091 9.93982 5.73247 9.93982 5.99962C9.93982 6.26677 9.79432 6.51833 9.5471 6.67863Z",fill:"currentColor"},null,-1)])])}const Fn=ne(En,[["render",An]]),Dn={class:"w-full"},Pn={class:"mb-1 flex items-center justify-stretch gap-2 py-1 text-base"},jn={class:"inline-flex items-center flex-wrap gap-1 text-ink-gray-5"},Rn={class:"font-medium text-ink-gray-8 ml-1"},Un={class:"ml-auto whitespace-nowrap"},On={class:"text-sm text-ink-gray-5"},Nn={class:"flex items-center justify-between"},zn={class:"inline-flex gap-2 items-center text-base font-medium"},qn={class:"flex items-center flex-wrap gap-2"},Hn=O({__name:"CallArea",props:{activity:Object},setup(t){const o=t,d=S(!1),i=S(!1),v=J("refreshTicket");return(m,n)=>{var u,f,h,l,s,$;return r(),_("div",Dn,[a("div",Pn,[a("div",jn,[g(e(Xe),{image:(f=(u=t.activity)==null?void 0:u._caller)==null?void 0:f.image,label:(l=(h=t.activity)==null?void 0:h._caller)==null?void 0:l.label,size:"md"},null,8,["image","label"]),a("span",Rn,T(($=(s=t.activity)==null?void 0:s._caller)==null?void 0:$.label),1),a("span",null,T(t.activity.call_type=="Incoming"?e(L)("has reached out"):e(L)("has made a call")),1)]),a("div",Un,[g(e(vt),{text:e(re)(t.activity.creation,"MMM D, dddd")},{default:C(()=>[a("div",On,T(e(L)(e(pe)(t.activity.creation))),1)]),_:1},8,["text"])])]),a("div",{onClick:n[0]||(n[0]=k=>d.value=!0),class:"flex flex-col gap-2 cursor-pointer border-transparent shadow rounded-md bg-surface-cards px-3 py-2.5 text-ink-gray-9"},[a("div",Nn,[a("div",zn,[a("div",null,T(t.activity.call_type=="Incoming"?e(L)("Inbound Call"):e(L)("Outbound Call")),1)]),a("div",null,[g(nl,{avatars:[{name:t.activity._caller.label,label:t.activity._caller.label,image:t.activity._caller.image},{name:t.activity._receiver.label,label:t.activity._receiver.label,image:t.activity._receiver.image}],size:"sm"},null,8,["avatars"])])]),a("div",qn,[g(e(Ie),{label:e(re)(t.activity.creation,"MMM D, dddd")},{prefix:C(()=>[g(ol,{class:"size-3"})]),_:1},8,["label"]),t.activity.status=="Completed"?(r(),V(e(Ie),{key:0,label:t.activity.duration},{prefix:C(()=>[g(il,{class:"size-3"})]),_:1},8,["label"])):j("",!0),t.activity.recording_url?(r(),V(e(Ie),{key:1,label:e(L)("Listen"),class:"cursor-pointer"},{prefix:C(()=>[g(Fn,{class:"size-3"})]),_:1},8,["label"])):j("",!0),g(e(Ie),{label:e(rl)[t.activity.status],theme:e(ul)[t.activity.status]},null,8,["label","theme"])])]),g(cl,{modelValue:d.value,"onUpdate:modelValue":n[1]||(n[1]=k=>d.value=k),callLogModal:i.value,"onUpdate:callLogModal":n[2]||(n[2]=k=>i.value=k),callLogId:o.activity.name,hideTicket:!0},null,8,["modelValue","callLogModal","callLogId"]),g(wt,{modelValue:i.value,"onUpdate:modelValue":n[3]||(n[3]=k=>i.value=k),callLogId:o.activity.name,onAfterInsert:n[4]||(n[4]=k=>e(v)())},null,8,["modelValue","callLogId"])])}}}),Zn={class:"md:mx-10 md:my-4 flex items-center justify-between text-lg font-medium mx-6 mb-4 !mt-8"},Kn={class:"flex h-8 items-center text-xl font-semibold text-gray-800"},Gn=O({__name:"ActivityHeader",props:{title:{type:String,required:!0}},setup(t){const o=J("communicationArea"),d=J("makeCall"),i=J("refreshTicket"),v=S(!1),{isCallingEnabled:m}=Ye(It()),n=J("ticketId"),u=E(()=>{let h=[{icon:P(Fe,{class:"h-4 w-4"}),label:L("Email"),onClick:()=>{var l;return((l=o==null?void 0:o.value)==null?void 0:l.toggleEmailBox())??ze()}},{icon:P(Be,{class:"h-4 w-4"}),label:L("Comment"),onClick:()=>{var l;return((l=o==null?void 0:o.value)==null?void 0:l.toggleCommentBox())??qe()}}];return m.value&&h.push(...f.value),h}),f=E(()=>[{icon:P($t,{class:"h-4 w-4"}),label:L("Make a Call"),onClick:()=>d()},{icon:"edit-3",label:L("Log a Call"),onClick:()=>{v.value=!0}}]);return(h,l)=>{const s=U("FeatherIcon"),$=U("Button");return r(),_(H,null,[a("div",Zn,[a("div",Kn,T(t.title),1),t.title=="Emails"?(r(),V($,{key:0,variant:"solid",onClick:l[0]||(l[0]=k=>{var w;return((w=e(o))==null?void 0:w.toggleEmailBox())??e(ze)()})},{prefix:C(()=>[g(s,{name:"plus",class:"h-4 w-4"})]),default:C(()=>[l[5]||(l[5]=a("span",null,T("New Email"),-1))]),_:1})):t.title=="Comments"?(r(),V($,{key:1,variant:"solid",onClick:l[1]||(l[1]=k=>{var w;return((w=e(o))==null?void 0:w.toggleCommentBox())??e(qe)()})},{prefix:C(()=>[g(s,{name:"plus",class:"h-4 w-4"})]),default:C(()=>[l[6]||(l[6]=a("span",null,T("New Comment"),-1))]),_:1})):t.title=="Calls"?(r(),V(e(Le),{key:2,options:f.value,onClick:l[2]||(l[2]=Q(()=>{},["stop"]))},{default:C(({open:k})=>[g($,{variant:"solid",class:"flex items-center gap-1"},{prefix:C(()=>[g(s,{name:"plus",class:"h-4 w-4"})]),suffix:C(()=>[g(s,{name:k?"chevron-up":"chevron-down",class:"h-4 w-4"},null,8,["name"])]),default:C(()=>[l[7]||(l[7]=a("span",null,T("New"),-1))]),_:2},1024)]),_:1},8,["options"])):(r(),V(e(Le),{key:3,options:u.value,onClick:l[3]||(l[3]=Q(()=>{},["stop"]))},{default:C(({open:k})=>[g($,{variant:"solid",class:"flex items-center gap-1"},{prefix:C(()=>[g(s,{name:"plus",class:"h-4 w-4"})]),suffix:C(()=>[g(s,{name:k?"chevron-up":"chevron-down",class:"h-4 w-4"},null,8,["name"])]),default:C(()=>[l[8]||(l[8]=a("span",null,T("New"),-1))]),_:2},1024)]),_:1},8,["options"]))]),g(wt,{modelValue:v.value,"onUpdate:modelValue":l[4]||(l[4]=k=>v.value=k),ticketId:e(n),onAfterInsert:e(i)},null,8,["modelValue","ticketId","onAfterInsert"])],64)}}}),Wn={class:"flex gap-[9px] mb-1.5 items-center"},Jn={class:"text-base text-ink-gray-8 font-medium"},Yn={key:0},Qn={class:"mt-2 text-sm text-gray-700"},Xn=O({__name:"FeedbackBox",props:{activity:{type:Object,required:!0}},setup(t){const o=t,d=E(()=>o.activity.feedback_rating<=.4?["bg-surface-red-1","red"]:o.activity.feedback_rating<=.6?["bg-surface-amber-1","yellow"]:["bg-surface-green-1","yellow"]);return(i,v)=>(r(),_("div",{class:K(["w-full p-4 rounded",d.value[0]])},[a("div",Wn,[a("p",Jn,T(t.activity.feedback),1),g(ml,{rating:t.activity.feedback_rating},null,8,["rating"])]),t.activity.feedback_extra?(r(),_("div",Yn,[a("p",Qn,T(t.activity.feedback_extra),1)])):j("",!0)],2))}}),es={key:0,class:"activities flex-1 h-full mt-1"},ts={class:"w-full px-6 md:px-10 grid grid-cols-[30px_minmax(auto,_1fr)] gap-2 sm:gap-4"},ls={key:1,class:"h-full flex flex-col items-center justify-center gap-3 text-xl font-medium text-gray-500"},Vs=O({__name:"TicketAgentActivities",props:{activities:{type:Array,required:!0},title:{type:String,required:!0},ticketStatus:{type:String,default:""}},emits:["email:reply","update"],setup(t,{expose:o,emit:d}){const i=t,v=d,m=gt(),n=xt(),{getUser:u}=Ze(),f=J("communicationArea"),h=J("makeCall"),l=E(()=>{let w="No Activities";if(i.title=="Emails")w="No Email Communications";else{if(i.title=="Comments")return w="No Comments",w;if(i.title=="Calls")return w="No Calls",w}}),s=E(()=>{let w=Zl;return i.title=="Emails"?w=Fe:i.title=="Comments"?w=Be:i.title=="Calls"&&(w=$t),P(w,{class:"text-gray-500"})});function $(){if(m.hash){k();return}setTimeout(()=>{let w,x=document.getElementsByClassName("activity");w=x[x.length-1],w&&!Qt(w)&&(w.scrollIntoViewIfNeeded(),w.focus())},500)}function k(){const w=m.hash;if(w){const x=w.substring(1);oe(()=>{setTimeout(()=>{const I=document.getElementById(x);I&&(I.scrollIntoViewIfNeeded(),I.classList.add("bg-yellow-100"),setTimeout(()=>{I.classList.remove("bg-yellow-100"),n.replace({hash:""})},2e3))},1e3)})}}return Y(()=>m.hash,()=>{$()}),Y(()=>i.title,()=>{$()},{immediate:!0}),o({scrollToLatestActivity:$}),(w,x)=>{const I=Gn,B=Hn,p=U("Button");return r(),_(H,null,[g(I,{title:t.title},null,8,["title"]),g(e(sl),{class:"flex flex-col flex-1 overflow-y-scroll","mask-length":20},{default:C(()=>[t.activities.length?(r(),_("div",es,[(r(!0),_(H,null,X(t.activities,(y,c)=>{var b,M;return r(),_("div",{key:y.key,class:"activity"},[a("div",ts,[a("div",{class:K(["relative flex justify-center after:absolute after:left-[50%] after:top-2 after:-z-10 after:border-l after:border-gray-200",[c!=t.activities.length-1?"after:h-full":"after:h-4"]])},[a("div",{class:K(["z-1 flex h-7 w-7 items-center justify-center rounded-full bg-white",[["email","feedback"].includes(y.type)&&"mt-2"]])},[y.type==="email"||y.type==="feedback"?(r(),V(e(Xe),{key:0,size:"lg",label:(b=y.sender)==null?void 0:b.full_name,image:e(u)((M=y.sender)==null?void 0:M.name).user_image,class:"bg-white absolute left-[1px]"},null,8,["label","image"])):y.type==="comment"?(r(),V(e(Be),{key:1,class:"text-gray-600 absolute left-[7.5px]"})):y.type==="call"?(r(),V(e(Yt),{key:2,name:y.call_type==="Incoming"?"phone-incoming":"phone-outgoing",class:"text-gray-600 absolute left-[7.5px] size-4"},null,8,["name"])):(r(),V(e(ta),{key:3,class:"text-gray-600 absolute left-[7.5px]"}))],2)],2),a("div",{class:K(["mb-4 flex flex-1",[c==t.activities.length-1&&"mb-5"]])},[y.type==="email"?(r(),V(e(Ja),{key:0,activity:y,"show-split-option":!y.isFirstEmail&&t.ticketStatus!=="Closed",class:"py-2 px-3",onReply:x[0]||(x[0]=A=>v("email:reply",A))},null,8,["activity","show-split-option"])):y.type==="comment"?(r(),V(e(Nl),{key:1,activity:y,onUpdate:x[1]||(x[1]=()=>v("update"))},null,8,["activity"])):y.type==="call"?(r(),V(B,{key:2,activity:y},null,8,["activity"])):y.type==="feedback"?(r(),V(Xn,{key:3,activity:y},null,8,["activity"])):(r(),V(e(yn),{key:4,activity:y},null,8,["activity"]))],2)])])}),128))])):(r(),_("div",ls,[(r(),V(Ve(s.value),{class:"h-10 w-10"})),a("span",null,T(l.value),1),t.title=="Emails"?(r(),V(p,{key:0,label:e(L)("New Email"),onClick:x[2]||(x[2]=y=>{var c;return((c=e(f))==null?void 0:c.toggleEmailBox())??e(ze)()})},null,8,["label"])):t.title=="Comments"?(r(),V(p,{key:1,label:e(L)("New Comment"),onClick:x[3]||(x[3]=y=>{var c;return((c=e(f))==null?void 0:c.toggleCommentBox())??e(qe)()})},null,8,["label"])):t.title=="Calls"?(r(),V(p,{key:2,label:e(L)("Make a Call"),onClick:x[4]||(x[4]=y=>e(h)())},null,8,["label"])):j("",!0)]))]),_:1})],64)}}}),as={class:"flex gap-2 px-5 pb-1 leading-5 first:mt-3 items-center"},ns={class:"w-[106px] shrink-0 truncate text-sm text-gray-600"},ss={key:0,class:"text-red-500"},os={class:"-m-0.5 min-h-[28px] flex-1 items-center overflow-hidden p-0.5 text-base"},is=O({__name:"TicketField",props:{field:{},value:{type:[String,Number,Boolean,null]}},emits:["change"],setup(t,{emit:o}){const d=t,i=o,v=ue({url:d.field.url_method,auto:!!d.field.url_method,transform:l=>l!=null&&l.length?(l==null?void 0:l.map(s=>({label:s,value:s})))||[]:[]}),m=["Long Text","Small Text","Text","Text Editor","Data"],n=["Int","Float","Currency","Percent"],u=E(()=>d.field.url_method?P(je,{options:v.data}):d.field.fieldtype==="Link"&&d.field.options?P(vl,{doctype:d.field.options,hideMe:!0}):d.field.fieldtype==="Select"?P(je,{options:d.field.options.split(`
`).map(l=>({label:l,value:l}))}):d.field.fieldtype==="Check"?P(je,{options:[{label:"Yes",value:1},{label:"No",value:0}]}):m.includes(d.field.fieldtype)?P(st,{type:"textarea",rows:d.field.fieldtype==="Data"?1:2}):d.field.fieldtype==="Datetime"?P(fl,{formatter:l=>l&&ot(l).format(`${window.date_format.toUpperCase()} ${window.time_format}`)}):d.field.fieldtype==="Date"?P(pl,{id:d.field.fieldname}):P(st)),f=E(()=>{const l=d.field.fieldtype;return l==="Check"?d.value?"Yes":"No":l==="Date"&&d.value?ot(d.value).format(window.date_format.toUpperCase()):d.value});function h(l,s){i("change",{fieldname:l,value:s})}return(l,s)=>(r(),_("div",as,[a("div",ns,[g(e(vt),{text:l.field.label},{default:C(()=>[a("span",null,T(l.field.label),1)]),_:1},8,["text"]),l.field.required?(r(),_("span",ss,T(e(L)("*")),1)):j("",!0)]),a("div",os,[(r(),V(Ve(u.value),ke({key:l.field.fieldname,readonly:l.field.readonly,disabled:l.field.disabled,class:"form-control",placeholder:l.field.placeholder||`Add ${l.field.label}`,"model-value":f.value,autocomplete:"off"},Xt([...m,...n].includes(l.field.fieldtype)?{blur:$=>{h(l.field.fieldname,$.target.value)}}:{"update:model-value":$=>{var k;h(l.field.fieldname,($==null?void 0:$.value)||((k=$==null?void 0:$.target)==null?void 0:k.value)||$)}})),null,16,["readonly","disabled","placeholder","model-value"]))])]))}});const Es=ne(is,[["__scopeId","data-v-e2d93b44"]]);function Ms(t){const o=gt(),d=xt(),i=It(),{isLoading:v}=Ye(i),m=l=>{var s,$;f.value=l,l==0?d.replace({path:o.path}):n((($=(s=t.value)==null?void 0:s[l])==null?void 0:$.name)||t.value[0].name)};function n(l){let s="#"+(l==null?void 0:l.toLowerCase());o.hash!==s&&d.push({hash:s,query:o.query})}function u(l){var s;return(s=t.value)==null?void 0:s.findIndex($=>$.name.toLowerCase()===l)}const f=S(0),h=()=>{let l=o.hash.replace("#","");if(l){let s=u(l);if(s!==-1||s===0){f.value=s,n(t.value[s].name);return}}f.value=0,d.replace({path:o.path})};return Y(()=>o.hash,l=>{let s=u(l.replace("#",""));s===-1&&(s=0),s==0&&d.replace({path:o.path}),f.value=s}),Y([t,v],([l,s])=>{l!=null&&l.length&&(s||h())},{deep:!0,flush:"post"}),{tabIndex:f,changeTabTo:m}}export{Zl as A,Be as C,Es as T,Bs as _,wl as a,$l as b,Vs as c,Ss as d,Ls as e,Ms as u};
//# sourceMappingURL=useActiveTabManager-cf23e65d.js.map
