import{_ as Q}from"./CustomActions-c518c4ca.js";import{d as H,c as b,K as x,aa as R,W as B,e as m,k as v,l as f,t as Y,v as F,y as h,f as $,x as Z,s as ee,u as te,a as ae,A as L,p as le,J as _,ap as E,q as p,N as se,g,w as T,h as l,F as oe,G as ie,a9 as ne,ar as j,as as q,X as re,a1 as O,aS as de}from"./index-0570e060.js";import{_ as ue}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-71e83eb3.js";import{u as ce}from"./pageMeta-7d9b9003.js";import{g as me,a as pe}from"./TypingIndicator.vue_vue_type_style_index_0_scoped_3f215bd3_lang-f290abcf.js";import"./dayjs-2cebe90e.js";import{L as fe}from"./LayoutHeader-6b26ba5d.js";import{_ as z}from"./Autocomplete-3ba2dc4c.js";import{a as ve}from"./Link-3bf01fe5.js";import{s as he,p as _e,h as ge,a as ke}from"./formCustomisation-8a41b461.js";import{l as be}from"./lodash-76397d9a.js";import{s as M}from"./index-4b511554.js";import{_ as ye}from"./SearchArticles.vue_vue_type_script_setup_true_lang-a0faca83.js";import{_ as P}from"./TicketTextEditor.vue_vue_type_script_setup_true_lang-f5d09dbd.js";import"./Dropdown-1e1fbbdd.js";import"./FileUploader-6d719bf4.js";import"./AttachmentItem.vue_vue_type_script_setup_true_lang-9fe00f85.js";import"./TextEditor.vue_vue_type_script_setup_true_lang-a6c50ac5.js";import"./UserAvatar.vue_vue_type_script_setup_true_lang-dd648b68.js";import"./Avatar.vue_vue_type_script_setup_true_lang-a0f98d49.js";const xe={key:0,class:"space-y-1.5"},Ce={class:"block text-sm text-gray-700"},we={key:0,class:"place-self-center text-red-500"},Se=H({__name:"UniInput",props:{field:{},value:{type:[String,Number,Boolean]}},emits:["change"],setup(N,{emit:C}){const o=N,D=C,U=b(()=>o.field.url_method?x(z,{options:V.data,size:"sm"}):o.field.fieldtype==="Link"&&o.field.options?x(ve,{doctype:o.field.options,filters:o.field.filters}):o.field.fieldtype==="Select"?x(z,{options:o.field.options.split(`
`).map(s=>({label:s,value:s})),size:"sm"}):o.field.fieldtype==="Check"?x(z,{options:[{label:"Yes",value:1},{label:"No",value:0}],size:"sm"}):x(R,{debounce:500})),V=B({url:o.field.url_method,auto:!!o.field.url_method,transform:s=>(s==null?void 0:s.map(i=>({label:i,value:i})))||[]}),y=b(()=>o.field.fieldtype==="Check"?o.value?"Yes":"No":o.value),c=b(()=>o.field.placeholder?o.field.placeholder:o.field.fieldtype==="Data"&&!o.field.url_method?"Type something":"Select an option");function u(s,i){D("change",{fieldname:s,value:i})}return(s,i)=>s.field.display_via_depends_on?(m(),v("div",xe,[f("span",Ce,[Y(F(s.field.label)+" ",1),s.field.required?(m(),v("span",we," * ")):h("",!0)]),(m(),$(Z(U.value),{placeholder:c.value,value:y.value,disabled:s.field.disabled,"model-value":y.value,"onUpdate:modelValue":i[0]||(i[0]=n=>u(s.field.fieldname,n)),onChange:i[1]||(i[1]=n=>{var w;return u(s.field.fieldname,((w=n.target)==null?void 0:w.value)||n.value||n)})},null,40,["placeholder","value","disabled","model-value"]))])):h("",!0)}}),Te={class:"flex flex-col overflow-y-auto"},Fe={class:"flex flex-col gap-5 py-6 h-full flex-1 self-center overflow-auto mx-auto w-full max-w-4xl px-5"},$e={key:0,class:""},Ne=["innerHTML"],De={key:1,class:"grid grid-cols-1 gap-4 sm:grid-cols-3"},Ue={class:"flex flex-col gap-2"},Ve={class:"block text-sm text-gray-700"},Ie={class:"place-self-center text-red-500"},Ae={key:1},Le={key:2},at=H({__name:"TicketNew",props:{templateId:{default:""}},setup(N){const C=N;ee();const o=te(),{$dialog:D}=me(),{updateOnboardingStep:U}=pe("helpdesk"),{isManager:V,userId:y}=ae(),c=L(""),u=L(""),s=L([]),i=le({}),n=B({url:"helpdesk.helpdesk.doctype.hd_ticket_template.api.get_one",makeParams:()=>({name:C.templateId||"Default"}),auto:!0,onSuccess:e=>{u.value=e.description_template||"",I=window.structuredClone(e.fields||[]),he(n,{doc:i,call:re,router:o,$dialog:D,applyFilters:G}),w(e.fields)}});function w(e){e.forEach(a=>{i[a.fieldname]=""})}let I=[];function G(e,a=null){const r=n.data.fields.find(d=>d.fieldname===e);r&&(r.fieldtype==="Select"?ge(r,e,a,i,I):r.fieldtype==="Link"&&ke(r,e,a,i,I))}const J=b(()=>{var e;return(e=n.data)==null?void 0:e._customOnChange}),A=b(()=>{var a,r;let e=(r=(a=n.data)==null?void 0:a.fields)==null?void 0:r.filter(d=>!_.value||!d.hide_from_customer);return e?e.map(d=>_e(d,i)):[]});function K(e,a,r){var t;i[a]=e.value;const d=(t=J.value)==null?void 0:t[a];d&&d.forEach(k=>{k(e.value,r)})}const S=B({url:"helpdesk.helpdesk.doctype.hd_ticket.api.new",debounce:300,makeParams:()=>({doc:{description:u.value,subject:c.value,template:C.templateId,...i},attachments:s.value}),validate:e=>{var d;const r=[...((d=A.value)==null?void 0:d.filter(t=>t.required))||[],"subject","description"];for(const t of r)if(be.isEmpty(e.doc[t.fieldname||t]))return`${t.label||t} is required`},onSuccess:e=>{o.push({name:_.value?"TicketCustomer":"TicketAgent",params:{ticketId:e.name}}),V&&U("create_first_ticket",!0,!1,()=>localStorage.setItem("firstTicket",e.name)),_.value&&E("new_ticket_submitted",{data:{user:y,ticketID:e.name,subject:c.value,description:u.value,customFields:i}})}});function W(e){return M(e,{allowedTags:M.defaults.allowedTags.concat(["img"])})}const X=b(()=>[{label:p("Tickets"),route:{name:_.value?"TicketsCustomer":"TicketsAgent"}},{label:p("New Ticket"),route:{name:"TicketNew"}}]);return ce(()=>({title:p("New Ticket")})),se(()=>{E("new_ticket_page",{data:{user:y}})}),(e,a)=>{var d;const r=Q;return m(),v("div",Te,[g(l(fe),null,{"left-header":T(()=>[g(l(ue),{items:X.value},null,8,["items"])]),"right-header":T(()=>{var t,k;return[(t=l(n).data)!=null&&t._customActions?(m(),$(r,{key:0,actions:(k=l(n).data)==null?void 0:k._customActions},null,8,["actions"])):h("",!0)]}),_:1}),f("div",Fe,[(d=l(n).data)!=null&&d.about?(m(),v("div",$e,[f("div",{class:"prose-f",innerHTML:W(l(n).data.about)},null,8,Ne)])):h("",!0),A.value?(m(),v("div",De,[(m(!0),v(oe,null,ie(A.value,t=>(m(),$(l(Se),{key:t.fieldname,field:t,value:i[t.fieldname],onChange:k=>K(k,t.fieldname,t.fieldtype)},null,8,["field","value","onChange"]))),128))])):h("",!0),f("div",{class:ne(["flex flex-col",(c.value.length>=2||u.value.length)&&"gap-5"])},[f("div",Ue,[f("span",Ve,[Y(F(l(p)("Subject"))+" ",1),f("span",Ie,F(l(p)("*")),1)]),g(l(R),{modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=t=>c.value=t),type:"text",placeholder:l(p)("A short description")},null,8,["modelValue","placeholder"])]),l(_)?(m(),$(ye,{key:0,query:c.value,class:"shadow"},null,8,["query"])):h("",!0),l(_)?(m(),v("div",Ae,[j(f("h4",{class:"text-p-sm text-gray-500 ml-1"},F(l(p)("Please enter a subject to continue")),513),[[q,c.value.length<=2&&u.value.length===0]]),j(g(P,{ref:"editor",attachments:s.value,"onUpdate:attachments":a[2]||(a[2]=t=>s.value=t),content:u.value,"onUpdate:content":a[3]||(a[3]=t=>u.value=t),placeholder:"Detailed explanation",expand:"",uploadFunction:t=>l(de)(t)},{"bottom-right":T(()=>[g(l(O),{label:l(p)("Submit"),theme:"gray",variant:"solid",disabled:e.$refs.editor.editor.isEmpty||l(S).loading||!c.value,onClick:a[1]||(a[1]=()=>l(S).submit())},null,8,["label","disabled"])]),_:1},8,["attachments","content","uploadFunction"]),[[q,c.value.length>2||u.value.length>0]])])):h("",!0)],2),l(_)?h("",!0):(m(),v("div",Le,[g(P,{ref:"editor",attachments:s.value,"onUpdate:attachments":a[5]||(a[5]=t=>s.value=t),content:u.value,"onUpdate:content":a[6]||(a[6]=t=>u.value=t),placeholder:l(p)("Detailed explanation"),expand:""},{"bottom-right":T(()=>[g(l(O),{label:l(p)("Submit"),theme:"gray",variant:"solid",disabled:e.$refs.editor.editor.isEmpty||l(S).loading||!c.value,onClick:a[4]||(a[4]=()=>l(S).submit())},null,8,["label","disabled"])]),_:1},8,["attachments","content","placeholder"])]))])])}}});export{at as default};
//# sourceMappingURL=TicketNew-a2ed0c8e.js.map
