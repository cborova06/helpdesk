import{aQ as ee,Z as G,c as I,d as j,A as N,q as c,W as te,Q as x,bi as A,k as P,g as m,w as S,h as n,r as O,e as y,l as _,F as T,G as J,t as ae,v as Q,y as M,f as E,bh as W,bj as le,b2 as oe,I as X,bd as ne,a1 as se,bk as re,aW as ie,a as ue,au as ce,X as de,K as me,O as pe,S as ve}from"./index-0570e060.js";import{_ as Z}from"./Avatar.vue_vue_type_script_setup_true_lang-a0f98d49.js";import{u as fe}from"./pageMeta-7d9b9003.js";import{a as _e}from"./TypingIndicator.vue_vue_type_style_index_0_scoped_3f215bd3_lang-f290abcf.js";import"./dayjs-2cebe90e.js";import{L as ge}from"./LayoutHeader-6b26ba5d.js";import{P as ye}from"./PhoneIcon-4fb53441.js";import{_ as Ce}from"./ListViewBuilder.vue_vue_type_script_setup_true_lang-38f9156f.js";import{F as he}from"./FileUploader-6d719bf4.js";import{a as be}from"./Link-3bf01fe5.js";import{s as w}from"./dialogState-cfa974c9.js";import"./Dropdown-1e1fbbdd.js";import"./TabButtons-1f731739.js";import"./description-95dce134.js";import"./DateTimePicker-2f0425b4.js";import"./useDatePicker-b1fa65c5.js";import"./DateRangePicker.vue_vue_type_script_setup_true_lang-237a353f.js";import"./StarRating.vue_vue_type_script_setup_true_lang-ecf3e22e.js";import"./NestedPopover-cbe976a0.js";import"./portal-8b8b74e3.js";import"./MultipleAvatar.vue_vue_type_script_setup_true_lang-1c7f3694.js";import"./ticketStatus-329a9615.js";const Ve=ee("contact",()=>{const g=G({doctype:"Contact",fields:["*"],auto:!0,pageLength:99999});return{options:I(()=>{var v;return((v=g.list)==null?void 0:v.data)||[]})}}),ke={class:"space-y-4"},xe={class:"mb-2 block text-sm leading-4 text-gray-700"},Ne={key:0,class:"place-self-center text-red-500"},Ee={class:"flex justify-end space-x-2"},De=j({__name:"NewContactDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","close","contactCreated"],setup(g,{emit:p}){const v=g,f=p,d=Ve(),l=N({emailID:"",firstName:"",lastName:"",phone:"",selectedCustomer:null}),u=N({emailValidationError:"",firstNameValidationError:"",lastNameValidationError:"",phoneValidationError:"",customerValidationError:""}),k=[{label:c("Email Id"),value:"emailID",error:"emailValidationError",type:"input",required:!0,action:()=>R(l.value.emailID)},{label:c("First Name"),value:"firstName",error:"firstNameValidationError",type:"input",required:!0,action:()=>H(l.value.firstName)},{label:c("Last Name"),value:"lastName",error:"lastNameValidationError",type:"input",required:!1},{label:c("Phone"),value:"phone",error:"phoneValidationError",type:"input",required:!1,action:()=>L(l.value.phone)},{label:c("Customer"),value:"selectedCustomer",error:"customerValidationError",type:"autocomplete",required:!1}],i=I({get:()=>v.modelValue,set:o=>{f("update:modelValue",o),o||f("close")}}),r=G({doctype:"HD Customer",fields:["name"],cache:"customers",transform:o=>o.map(e=>({label:e.name,value:e.name})),auto:!0}),a=te({url:"frappe.client.insert",onSuccess:()=>{l.value={emailID:"",firstName:"",lastName:"",phone:"",selectedCustomer:null},x.success(c("Contact created")),f("contactCreated")}});function D(){if(F())return;let o={doctype:"Contact",first_name:l.value.firstName,last_name:l.value.lastName,email_ids:[{email_id:l.value.emailID,is_primary:!0}],links:[],phone_nos:[]};l.value.phone&&(o.phone_nos=[{phone:l.value.phone}]),l.value.selectedCustomer&&o.links.push({link_doctype:"HD Customer",link_name:l.value.selectedCustomer}),a.submit({doc:o})}function b(o){!o||o.label==="No label"?l.value.selectedCustomer=null:l.value.selectedCustomer=o.value}function F(){let o=R(l.value.emailID);return o+=H(l.value.firstName),o+=L(l.value.phone),o}function R(o){u.value.emailValidationError="";const e=A.string().email().safeParse(o).success;return o?e?U(d.options).includes(o)&&(u.value.emailValidationError="Contact with email already exists"):u.value.emailValidationError="Enter a valid email":u.value.emailValidationError="Email should not be empty",u.value.emailValidationError}function H(o){return u.value.firstNameValidationError="",(!o||o.trim()==="")&&(u.value.firstNameValidationError="First name should not be empty"),u.value.firstNameValidationError}function L(o){return u.value.phoneValidationError="",o&&(!/[0-9]+/.test(o)||o.length<10)&&(u.value.phoneValidationError="Enter a valid phone number"),u.value.phoneValidationError}function U(o){return o.map(e=>e.email_id)}return(o,e)=>{const t=O("Button");return y(),P("div",null,[m(n(X),{modelValue:i.value,"onUpdate:modelValue":e[1]||(e[1]=s=>i.value=s),options:{title:"Create New Contact"}},{"body-content":S(()=>[_("div",ke,[(y(),P(T,null,J(k,s=>_("div",{key:s.label,class:"flex flex-col gap-1"},[_("span",xe,[ae(Q(s.label)+" ",1),s.required?(y(),P("span",Ne," * ")):M("",!0)]),s.type==="input"?(y(),E(n(W),{key:0,modelValue:l.value[s.value],"onUpdate:modelValue":C=>l.value[s.value]=C,type:"text",onBlur:s.action},null,8,["modelValue","onUpdate:modelValue","onBlur"])):(y(),E(n(le),{key:1,modelValue:l.value[s.value],"onUpdate:modelValue":[C=>l.value[s.value]=C,b],options:n(r).data},null,8,["modelValue","onUpdate:modelValue","options"])),m(n(oe),{message:u.value[s.error]},null,8,["message"])])),64)),_("div",Ee,[m(t,{label:n(c)("Create"),loading:n(a).loading,theme:"gray",variant:"solid",onClick:e[0]||(e[0]=s=>D())},null,8,["label","loading"])])])]),_:1},8,["modelValue"])])}}}),$e={__name:"Pill",props:{label:{type:String,default:"Button",require:!0},disabled:{type:Boolean,default:!1}},emits:["click"],setup(g,{emit:p}){const v=p,f=d=>{v("click",d)};return(d,l)=>(y(),E(n(se),{key:g.label,theme:"gray",variant:"outline",label:g.label,disabled:g.disabled},{suffix:S(()=>[m(n(ne),{class:"h-3 w-3",onClick:l[0]||(l[0]=u=>f(g.label))})]),_:1},8,["label","disabled"]))}},we={class:"flex flex-wrap gap-2 rounded-lg bg-gray-100 p-2"},K=j({__name:"MultiSelect",props:{items:{type:Array,required:!0},placeholder:{type:String,required:!1,default:"Type..."},validate:{type:Function,required:!1,default:()=>!1}},emits:["update:items"],setup(g,{emit:p}){const v=g,f=p,{items:d}=re(v),l=N("");function u(i){const r=v.validate(i);if(r){x.error(r);return}const a=[...d.value,i];f("update:items",a),l.value=""}function k(i){const r=d.value.filter(a=>a.value!==i);f("update:items",r)}return(i,r)=>(y(),P("div",we,[(y(!0),P(T,null,J(n(d),a=>(y(),E($e,{key:a.value,label:a.label,onClick:r[0]||(r[0]=D=>k(D))},null,8,["label"]))),128)),m(n(W),{modelValue:l.value,"onUpdate:modelValue":r[1]||(r[1]=a=>l.value=a),class:"w-full",placeholder:g.placeholder,onKeyup:r[2]||(r[2]=ie(a=>u({label:l.value,value:l.value}),["enter"]))},null,8,["modelValue","placeholder"])]))}}),Ie={class:"flex flex-col items-center gap-4 p-6"},Se={class:"text-xl font-medium text-gray-900"},Ue={class:"flex gap-2"},Pe={class:"w-full space-y-2 text-sm text-gray-700"},Be={class:"space-y-1"},qe={class:"space-y-1"},Fe={class:"space-y-1"},Re=j({__name:"ContactDialog",props:{name:{}},emits:["contactUpdated"],setup(g,{emit:p}){const v=g,f=p,d=N(!1),l=I({get(){var t;return(((t=a.doc)==null?void 0:t.email_ids)||[]).map(s=>({label:s.email_id,value:s.email_id}))},set(e){if(e.length===0){x.error(c("At least one email is required"));return}e.length!==a.doc.email_ids.length&&(d.value=!0),a.doc.email_ids=e.map(t=>({email_id:t.value}))}}),u=I({get(){var t;return(((t=a.doc)==null?void 0:t.phone_nos)||[]).map(s=>({label:s.phone,value:s.phone}))},set(e){e.length!==a.doc.phone_nos.length&&(d.value=!0),a.doc.phone_nos=e.map(t=>({phone:t.value}))}}),k=I({get(){var t,s;const e=(s=(t=a.doc)==null?void 0:t.links)==null?void 0:s.find(C=>C.link_doctype==="HD Customer");return(e==null?void 0:e.link_name)||null},set(e){var s,C,$,B,q;const t=($=(C=(s=a.doc)==null?void 0:s.links)==null?void 0:C.find(V=>V.link_doctype==="HD Customer"))==null?void 0:$.link_name;if(e!==t){if(e){const V=(B=a.doc.links)==null?void 0:B.findIndex(h=>h.link_doctype==="HD Customer");V!==-1?a.doc.links[V].link_name=e:a.doc.links.push({link_doctype:"HD Customer",link_name:e})}else a.doc.links=(q=a.doc.links)==null?void 0:q.filter(V=>V.link_doctype!=="HD Customer");d.value=!0}}});G({doctype:"HD Customer",fields:["name"],cache:"customers",transform:e=>e.map(t=>({label:t.name,value:t.name})),auto:!0});const{updateOnboardingStep:i}=_e("helpdesk"),{isManager:r}=ue(),a=ce({doctype:"Contact",name:v.name,auto:!0,setValue:{onSuccess(){f("contactUpdated")}}}),D=I(()=>{var e;return{title:(e=a.doc)==null?void 0:e.name,actions:[{label:c("Save"),theme:"gray",variant:"solid",onClick:()=>b()}]}});function b(){if(!d.value){x.error(c("No changes to save"));return}a.setValue.submit({email_ids:l.value.map(e=>({email_id:e.value,is_primary:e.value===a.doc.email_id})),phone_nos:u.value.map(e=>({phone:e.value,is_primary_phone:e.value===a.doc.phone,is_primary_mobile:e.value===a.doc.phone})),links:a.doc.links}),d.value=!1,f("contactUpdated")}function F(e){a.setValue.submit({image:(e==null?void 0:e.file_url)||null}),d.value=!0}function R(e){if(!A.string().email().safeParse(e.value).success)return"Invalid email"}function H(e){if(!A.string().regex(/^\+[1-9]\d{1,14}$/).min(10).max(15).safeParse(e.value).success)return"Invalid phone number"}function L(e){let t=e.name.split(".").pop().toLowerCase();if(!["png","jpg","jpeg"].includes(t))return x.error(c("Invalid file type, only PNG and JPG images are allowed")),"Invalid file type, only PNG and JPG images are allowed"}const U=N(!1);async function o(){var e;try{U.value=!0;const t=await de("frappe.contacts.doctype.contact.contact.invite_user",{contact:a.doc.name});x.success(c("Contact invited successfully")),await a.setValue.submit({user:t}),i("add_invite_contact")}catch(t){U.value=!1;const $=new DOMParser().parseFromString(((e=t.messages)==null?void 0:e[0])||t.message,"text/html").body.innerText;x.error($)}finally{U.value=!1}}return(e,t)=>{const s=O("Button");return y(),E(n(X),{options:D.value},{"body-main":S(()=>{var C,$,B,q,V;return[_("div",Ie,[_("div",Se,Q((C=n(a).doc)==null?void 0:C.full_name),1),m(n(Z),{size:"2xl",label:($=n(a).doc)==null?void 0:$.full_name,image:(B=n(a).doc)==null?void 0:B.image,class:"cursor-pointer hover:opacity-80"},null,8,["label","image"]),_("div",Ue,[m(n(he),{"validate-file":L,onSuccess:t[0]||(t[0]=h=>F(h))},{default:S(({uploading:h,openFileSelector:Y})=>{var z;return[m(s,{label:(z=n(a).doc)!=null&&z.image?"Change photo":"Upload photo",loading:h,onClick:Y},null,8,["label","loading","onClick"])]}),_:1}),(q=n(a).doc)!=null&&q.image?(y(),E(s,{key:0,label:n(c)("Remove photo"),onClick:t[1]||(t[1]=h=>F(null))},null,8,["label"])):M("",!0),!((V=n(a).doc)!=null&&V.user)&&n(r)?(y(),E(s,{key:1,label:n(c)("Invite as user"),onClick:o,loading:U.value},null,8,["label","loading"])):M("",!0)]),_("div",Pe,[_("div",Be,[t[5]||(t[5]=_("div",{class:"text-xs"},"Emails",-1)),m(K,{items:l.value,"onUpdate:items":t[2]||(t[2]=h=>l.value=h),placeholder:n(c)("john.doe@example.com"),validate:R},null,8,["items","placeholder"])]),_("div",qe,[t[6]||(t[6]=_("div",{class:"text-xs"},"Phone Nos",-1)),m(K,{items:u.value,"onUpdate:items":t[3]||(t[3]=h=>u.value=h),placeholder:n(c)("+91 98765 43210"),validate:H},null,8,["items","placeholder"])]),_("div",Fe,[t[7]||(t[7]=_("div",{class:"text-xs"},"Customer",-1)),m(be,{doctype:"HD Customer",class:"form-control flex-1",placeholder:n(c)("Link to a customer"),modelValue:k.value,"onUpdate:modelValue":t[4]||(t[4]=h=>k.value=h),"hide-me":!0},null,8,["placeholder","modelValue"])])])])]}),_:1},8,["options"])}}}),He={class:"flex flex-col"},rt=j({__name:"Contacts",setup(g){const p=N(!1),v=N(null),f=N(null),d=I(()=>({doctype:"Contact",selectable:!0,showSelectBanner:!0,columnConfig:{full_name:{prefix:({row:i})=>me(Z,{shape:"circle",image:i.image,label:i.name,size:"sm"})},mobile_no:{prefix:ye}},emptyState:{title:c("No Contacts Found")}}));function l(){var i;w.value=!1,(i=f.value)==null||i.reload()}function u(i){v.value=i,p.value=!0}function k(){var i;x.success(c("Contact updated")),p.value=!p.value,(i=f.value)==null||i.reload()}return fe(()=>({title:c("Contacts")})),(i,r)=>{const a=ve,D=O("Button");return y(),P("div",He,[m(n(ge),null,{"left-header":S(()=>[...r[4]||(r[4]=[_("div",{class:"text-lg font-medium text-gray-900"},"Contacts",-1)])]),"right-header":S(()=>[m(D,{label:n(c)("New contact"),theme:"gray",variant:"solid",onClick:r[0]||(r[0]=b=>w.value=!n(w))},{prefix:S(()=>[m(a,{class:"h-4 w-4"})]),_:1},8,["label"])]),_:1}),m(n(Ce),{ref_key:"listViewRef",ref:f,options:d.value,onRowClick:u,onEmptyStateAction:r[1]||(r[1]=b=>w.value=!0)},null,8,["options"]),m(De,{modelValue:n(w),"onUpdate:modelValue":r[2]||(r[2]=b=>pe(w)?w.value=b:null),onContactCreated:l},null,8,["modelValue"]),p.value?(y(),E(Re,{key:v.value,modelValue:p.value,"onUpdate:modelValue":r[3]||(r[3]=b=>p.value=b),name:v.value,onContactUpdated:k},null,8,["modelValue","name"])):M("",!0)])}}});export{rt as default};
//# sourceMappingURL=Contacts-ab059b94.js.map
