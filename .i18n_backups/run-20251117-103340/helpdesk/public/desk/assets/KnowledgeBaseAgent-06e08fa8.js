import{d as D,m as V,n as M,c as U,A as f,a4 as W,f as E,w as h,h as p,q as l,e as S,l as k,ar as j,bb as z,I as L,r as F,t as $,v as J,g as m,u as X,p as Y,W as Z,ah as ee,Q as g,K as B,L as te,N as le,ap as H,k as ae,R as oe,a1 as se,S as re}from"./index-0570e060.js";import{d as ie,a as ne,L as ue,m as ce,n as de,b as ge,c as me}from"./LayoutHeader-6b26ba5d.js";import{_ as pe}from"./ListViewBuilder.vue_vue_type_script_setup_true_lang-38f9156f.js";import{g as fe}from"./TypingIndicator.vue_vue_type_style_index_0_scoped_3f215bd3_lang-f290abcf.js";import"./dayjs-2cebe90e.js";import{a as ye}from"./Link-3bf01fe5.js";import{_ as ve}from"./MoveToCategoryModal.vue_vue_type_script_setup_true_lang-f1d8d4cd.js";import{D as be}from"./Dropdown-1e1fbbdd.js";import{u as Ce}from"./pageMeta-7d9b9003.js";import{L as he}from"./merge-23c56721.js";import"./TabButtons-1f731739.js";import"./description-95dce134.js";import"./DateTimePicker-2f0425b4.js";import"./useDatePicker-b1fa65c5.js";import"./DateRangePicker.vue_vue_type_script_setup_true_lang-237a353f.js";import"./StarRating.vue_vue_type_script_setup_true_lang-ecf3e22e.js";import"./NestedPopover-cbe976a0.js";import"./portal-8b8b74e3.js";import"./MultipleAvatar.vue_vue_type_script_setup_true_lang-1c7f3694.js";import"./Avatar.vue_vue_type_script_setup_true_lang-a0f98d49.js";import"./ticketStatus-329a9615.js";const _e={class:"flex flex-col flex-1 gap-3"},we=["placeholder"],ke=D({__name:"CategoryModal",props:V({title:{type:String,default:""},edit:{type:Boolean,default:!1}},{modelValue:{type:Boolean},modelModifiers:{},title:{},titleModifiers:{}}),emits:V(["update","create"],["update:modelValue","update:title"]),setup(_,{emit:v}){const b=_,a=v,d=M(_,"modelValue"),i=M(_,"title"),o=U(()=>b.edit?"Edit Category":"Create Category"),u=f(null);W(()=>u.value,n=>{n&&(u.value.style.height=(n.scrollHeight>n.clientHeight,n.scrollHeight+"px"))});function c(){const n=[];return b.edit?n.push({label:l("Save"),variant:"solid",onClick:()=>{a("update")}}):n.push({label:l("Create"),variant:"solid",onClick:()=>{a("create")}}),n}return(n,y)=>(S(),E(p(L),{modelValue:d.value,"onUpdate:modelValue":y[2]||(y[2]=C=>d.value=C),options:{title:o.value,actions:c()}},{"body-content":h(()=>[k("div",_e,[j(k("textarea",{class:"text-base rounded py-1.5 px-2 border border-[--surface-gray-2] bg-surface-gray-2 placeholder-ink-gray-4 hover:border-outline-gray-modals hover:bg-surface-gray-3 focus:bg-surface-white focus:border-outline-gray-4 focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-outline-gray-3 text-ink-gray-8 transition-colors w-full block",ref_key:"titleRef",ref:u,placeholder:p(l)("Support Issues"),"onUpdate:modelValue":y[0]||(y[0]=C=>i.value=C),rows:1,maxlength:"50",autofocus:"",onInput:y[1]||(y[1]=C=>{const A=C.target;A.style.height=`${A.scrollHeight}px`})},null,40,we),[[z,i.value]])])]),_:1},8,["modelValue","options"]))}}),Ae={class:"text-p-base text-ink-gray-8 mb-4"},xe={class:"whitespace-nowrap font-semibold"},Ve=D({__name:"MergeCategoryModal",props:V({categoryId:{},categoryTitle:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:V(["merge"],["update:modelValue"]),setup(_,{emit:v}){const b=v,a=M(_,"modelValue"),d=f("");return(i,o)=>{const u=F("Button");return S(),E(p(L),{options:{title:"Merge with another category"},onAfterLeave:o[2]||(o[2]=()=>{d.value=null}),modelValue:a.value,"onUpdate:modelValue":o[3]||(o[3]=c=>a.value=c)},{"body-content":h(()=>[k("p",Ae,[o[4]||(o[4]=$(" This will move all articles of the ",-1)),k("span",xe,J(i.categoryTitle),1),o[5]||(o[5]=$(" category to the selected category. This change is irreversible! ",-1))]),m(p(ye),{class:"form-control",doctype:"HD Article Category",placeholder:p(l)("Select Category"),modelValue:d.value,"onUpdate:modelValue":o[0]||(o[0]=c=>d.value=c),label:p(l)("Category"),"page-length":100},null,8,["placeholder","modelValue","label"])]),actions:h(()=>[m(u,{class:"w-full",variant:"solid",label:p(l)("Merge"),onClick:o[1]||(o[1]=c=>b("merge",i.categoryId,d.value))},null,8,["label"])]),_:1},8,["modelValue"])}}}),Me={class:"flex flex-col"},Fe=D({__name:"KnowledgeBaseAgent",setup(_){const v=X(),{$dialog:b}=fe(),a=Y({title:"",id:""}),d=f(""),i=f(null),o=f(!1),u=f(!1),c=f(!1),n=f(!1),y=Z({url:"helpdesk.api.knowledge_base.get_general_category",auto:!0,cache:["GeneralCategory"]}),C=[{label:l("Category"),icon:"folder",onClick:()=>{x(),o.value=!1,u.value=!0}},{label:l("Article"),icon:"file-text",onClick:()=>{v.push({name:"NewArticle",params:{id:y.data},query:{title:l("General")}})}}],A=[{label:l("Add New Article"),icon:"plus",onClick:e=>{v.push({name:"NewArticle",params:{id:e.group.value},query:{title:e.group.label}})}},{label:l("Edit Title"),icon:"edit",onClick:e=>{o.value=!0,u.value=!0,a.title=e.group.label,a.id=e.group.value,d.value=e.group.label}},{label:l("Merge"),icon:he,onClick:e=>{n.value=!0,a.title=e.group.label,a.id=e.group.value}},{label:l("Share"),icon:"link",onClick:async({group:e})=>{const{label:t,value:r}=e,s=new URL(window.location.href);s.pathname=`/helpdesk/kb-public/${r}`,await ee(s.toString(),`Category <u>'${t}'</u> link copied to clipboard`)}},{label:l("Delete"),icon:"trash-2",onClick:e=>{K(e)}}],w=f(new Set),I=[{label:l("Move To"),icon:"corner-up-right",onClick:e=>{w.value=new Set(e),c.value=!0}},{label:l("Delete"),icon:"trash-2",onClick:e=>{w.value=e,b({title:l("Delete articles?"),message:"Are you sure you want to delete these articles?",actions:[{label:l("Confirm"),variant:"solid",onClick({close:t}){P(),t()}}]})}}];function N(e){ce.submit({category:e,articles:Array.from(w.value)},{onSuccess:()=>{var t,r;c.value=!1,(t=i.value)==null||t.reload(),(r=i.value)==null||r.unselectAll(),w.value.clear(),g.success(l("Articles moved"))},onError:t=>{var s;const r=((s=t==null?void 0:t.messages)==null?void 0:s[0])||t.message;g.error(r),c.value=!1}})}function R(){de.submit({title:a.title},{onSuccess:e=>{i.value.reload(),u.value=!1,v.push({name:"Article",params:{articleId:e.article},query:{category:e.category,title:a.title,isEdit:1}}),g.success(l("Category created")),H("category_created",{data:{category:a.title}}),x()},onError:e=>{g.error(e)}})}function q(){if(a.title===d.value){u.value=!1,o.value=!1;return}ge.submit({doctype:"HD Article Category",name:a.id,fieldname:"category_name",value:a.title},{onSuccess:()=>{i.value.reload(),u.value=!1,o.value=!1,g.success(l("Category updated")),x()},onError:e=>{g.error(e)}})}function K(e){b({title:l("Delete category?"),message:"All articles from this category will move to General category.",actions:[{label:l("Confirm"),variant:"solid",onClick(t){ie.submit({doctype:"HD Article Category",name:e.group.value},{onSuccess:()=>{g.success(l("Category deleted")),i.value.reload()}}),t()}}]})}function P(){ne.submit({articles:Array.from(w.value)},{onSuccess:()=>{var e,t,r;(e=i.value)==null||e.reload(),(t=i.value)==null||t.unselectAll(),(r=w.value)==null||r.clear(),g.success(l("Articles deleted"))}})}function G(e,t){me.submit({source:e,target:t},{onSuccess:()=>{i.value.reload(),g.success(l("Category merged")),n.value=!1,x()},onError:r=>{var T;const s=((T=r==null?void 0:r.messages)==null?void 0:T[0])||r.message;g.error(s)}})}function x(){a.title="",a.id="",d.value=""}const O=U(()=>({doctype:"HD Article",selectable:!0,view:{view_type:"group_by",group_by_field:"category",label_doc:"HD Article Category",label_field:"category_name"},columnConfig:{title:{prefix:()=>B(oe,{name:"file-text",class:"h-4 w-4 flex-shrink-0 text-ink-gray-6"})},status:{custom:({item:e})=>B(te,{...Q[e]})}},rowRoute:{name:"Article",prop:"articleId"},groupByActions:A,showSelectBanner:!0,selectBannerActions:I,default_page_length:100})),Q={Published:{label:"Published",theme:"green"},Draft:{label:"Draft",theme:"orange"},Archived:{label:"Archived",theme:"gray"}};return le(()=>{H("kb_agent_page_viewed")}),Ce(()=>({title:l("Knowledge Base")})),(e,t)=>{const r=re;return S(),ae("div",Me,[m(ue,null,{"left-header":h(()=>[...t[5]||(t[5]=[k("div",{class:"text-lg font-medium text-gray-900"},"Knowledge Base",-1)])]),"right-header":h(()=>[m(p(be),{options:C},{default:h(()=>[m(p(se),{label:p(l)("Add new"),variant:"solid"},{prefix:h(()=>[m(r,{class:"h-4 w-4"})]),_:1},8,["label"])]),_:1})]),_:1}),m(pe,{ref_key:"listViewRef",ref:i,options:O.value,onRowClick:t[0]||(t[0]=s=>e.$router.push(`kb/articles/${s}`))},null,8,["options"]),m(ke,{edit:o.value,modelValue:u.value,"onUpdate:modelValue":t[1]||(t[1]=s=>u.value=s),title:a.title,"onUpdate:title":t[2]||(t[2]=s=>a.title=s),onUpdate:q,onCreate:R},null,8,["edit","modelValue","title"]),m(ve,{modelValue:c.value,"onUpdate:modelValue":t[3]||(t[3]=s=>c.value=s),onMove:N},null,8,["modelValue"]),m(Ve,{categoryTitle:a.title,"category-id":a.id,modelValue:n.value,"onUpdate:modelValue":t[4]||(t[4]=s=>n.value=s),onMerge:G},null,8,["categoryTitle","category-id","modelValue"])])}}});export{Fe as default};
//# sourceMappingURL=KnowledgeBaseAgent-06e08fa8.js.map
