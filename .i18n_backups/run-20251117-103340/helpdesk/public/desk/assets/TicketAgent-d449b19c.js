import{j as re,e as p,k as w,l as d,r as N,h as e,ab as Ke,v as z,D as ve,ac as me,f as D,x as Qe,d as M,m as fe,n as ke,A as j,W as G,Q as ae,q as B,Z as Ye,a4 as ie,w as S,t as ge,g as _,y as F,I as et,a0 as H,$ as be,c as A,ad as tt,F as W,u as He,s as ye,N as he,ae as at,af as st,ag as E,ah as ne,L as ze,a9 as te,ai as nt,K as ot,P as lt,X as Ie,aj as it,ak as xe,G as K,al as rt,C as ct,E as ut,am as dt,M as oe,an as mt,ao as qe,U as Ee,ap as pt,aq as _t,z as se,ar as vt,H as ft,as as gt,a1 as De,at as kt,p as bt,au as yt,a8 as ee,av as ht}from"./index-0570e060.js";import{A as xt,C as Ct,u as $t,a as wt,b as Tt,c as St,d as Vt,e as Lt,_ as Ne,T as At}from"./useActiveTabManager-cf23e65d.js";import{T as Bt,b as X,u as zt,d as Pe,g as We,t as Dt,e as Ut,s as jt,f as Ft}from"./TypingIndicator.vue_vue_type_style_index_0_scoped_3f215bd3_lang-f290abcf.js";import"./dayjs-2cebe90e.js";import{L as Rt}from"./LayoutHeader-6b26ba5d.js";import{_ as ce}from"./EmailIcon-049172ef.js";import{P as Ce}from"./PhoneIcon-4fb53441.js";import{u as ue}from"./telephony-684c26ee.js";import{_ as Ht}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-71e83eb3.js";import{D as pe}from"./Dropdown-1e1fbbdd.js";import{I as Ue}from"./IndicatorIcon-85607ad9.js";import{u as Me}from"./ticketStatus-329a9615.js";import{_ as Oe}from"./MultipleAvatar.vue_vue_type_script_setup_true_lang-1c7f3694.js";import{a as $e}from"./Link-3bf01fe5.js";import{L as Ze}from"./merge-23c56721.js";import{s as It,p as je}from"./formCustomisation-8a41b461.js";import{T as qt}from"./TabButtons-1f731739.js";import{_ as Je}from"./Avatar.vue_vue_type_script_setup_true_lang-a0f98d49.js";import{_ as Et}from"./Section-3817b636.js";import{_ as Fe}from"./UserAvatar.vue_vue_type_script_setup_true_lang-dd648b68.js";import{_ as Nt}from"./Switch.vue_vue_type_script_setup_true_lang-0415a149.js";import{u as Pt}from"./pageMeta-7d9b9003.js";import"./FileUploader-6d719bf4.js";import"./TextEditor.vue_vue_type_script_setup_true_lang-a6c50ac5.js";import"./AttachmentItem.vue_vue_type_script_setup_true_lang-9fe00f85.js";import"./CallLogModal.vue_vue_type_script_setup_true_lang-9ca96f04.js";import"./EmailContent-0985017e.js";import"./StarRating.vue_vue_type_script_setup_true_lang-ecf3e22e.js";import"./DateTimePicker-2f0425b4.js";import"./useDatePicker-b1fa65c5.js";import"./Autocomplete-3ba2dc4c.js";import"./description-95dce134.js";const Wt={},Mt={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Ot(C,t){return p(),w("svg",Mt,[...t[0]||(t[0]=[d("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M13.9996 3.54443V8.771C13.9994 9.32318 13.5518 9.771 12.9996 9.771H12.1802C11.9041 9.771 11.6802 9.99485 11.6802 10.271C11.6803 10.547 11.9042 10.771 12.1802 10.771H12.9996C14.104 10.771 14.9994 9.87546 14.9996 8.771V3.54443C14.9996 2.43986 14.1041 1.54443 12.9996 1.54443H6.72124C5.61667 1.54443 4.72124 2.43986 4.72124 3.54443V4.37158C4.72124 4.64772 4.94509 4.87158 5.22124 4.87158C5.49738 4.87158 5.72124 4.64772 5.72124 4.37158V3.54443C5.72124 2.99215 6.16895 2.54443 6.72124 2.54443H12.9996C13.5518 2.54443 13.9996 2.99215 13.9996 3.54443ZM9.27832 6.22928C9.8306 6.22928 10.2783 6.67699 10.2783 7.22928V12.4558C10.2782 13.008 9.83053 13.4558 9.27832 13.4558H3C2.44779 13.4558 2.00012 13.008 2 12.4558V7.22928C2 6.67699 2.44772 6.22928 3 6.22928H9.27832ZM9.27832 14.4558C10.3828 14.4558 11.2782 13.5603 11.2783 12.4558V7.22928C11.2783 6.12471 10.3829 5.22928 9.27832 5.22928H3C1.89543 5.22928 1 6.12471 1 7.22928V12.4558C1.00012 13.5603 1.89551 14.4558 3 14.4558H9.27832Z",fill:"#525252"},null,-1)])])}const Re=re(Wt,[["render",Ot]]),Zt={},Jt={width:"16",height:"17",viewBox:"0 0 16 17",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Gt(C,t){return p(),w("svg",Jt,[...t[0]||(t[0]=[d("path",{d:"M5.66406 2.25C5.94021 2.25 6.16406 2.47386 6.16406 2.75C6.16406 3.02614 5.94021 3.25 5.66406 3.25H4.25C3.42157 3.25 2.75 3.92157 2.75 4.75V12.25L2.75781 12.4033C2.83461 13.1597 3.47334 13.75 4.25 13.75H11.75C12.5784 13.75 13.25 13.0784 13.25 12.25V10.8359C13.25 10.5598 13.4739 10.3359 13.75 10.3359C14.0261 10.3359 14.25 10.5598 14.25 10.8359V12.25C14.25 13.6307 13.1307 14.75 11.75 14.75H4.25C2.95566 14.75 1.89082 13.7664 1.7627 12.5059L1.75 12.25V4.75C1.75 3.36929 2.86929 2.25 4.25 2.25H5.66406ZM13.75 2.25C13.7827 2.25 13.8155 2.25243 13.8477 2.25879C13.8574 2.26071 13.8665 2.2651 13.876 2.26758C13.9592 2.28923 14.0383 2.33126 14.1035 2.39648C14.2012 2.49413 14.25 2.62202 14.25 2.75V7.25C14.25 7.52608 14.0261 7.74994 13.75 7.75C13.4739 7.75 13.25 7.52611 13.25 7.25V3.95703L6.81152 10.3955C6.61626 10.5908 6.29975 10.5908 6.10449 10.3955C5.90923 10.2002 5.90923 9.88374 6.10449 9.68848L12.543 3.25H9.25C8.97388 3.25 8.75003 3.02611 8.75 2.75C8.75 2.47386 8.97386 2.25 9.25 2.25H13.75Z",fill:"#525252"},null,-1)])])}const Xt=re(Zt,[["render",Gt]]),Kt={},Qt={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Yt(C,t){return p(),w("svg",Qt,[...t[0]||(t[0]=[d("g",{"clip-path":"url(#clip0_11163_86342)"},[d("path",{d:"M8 0.75C12.0041 0.75 15.25 3.99594 15.25 8C15.25 12.0041 12.0041 15.25 8 15.25C3.99594 15.25 0.75 12.0041 0.75 8C0.75 3.99594 3.99594 0.75 8 0.75ZM9.83691 4.24902C9.83246 4.31586 9.82822 4.40482 9.80762 4.49316C9.79115 4.5636 9.76659 4.63202 9.73535 4.69727C9.69606 4.77931 9.64388 4.85125 9.60547 4.90625L9.57715 4.94727C9.53169 5.01237 9.47353 5.10016 9.39648 5.1748C9.33512 5.23421 9.26581 5.2852 9.19141 5.32715C9.09793 5.37982 8.99723 5.41143 8.92188 5.43652L7.01367 6.07227C6.96479 6.08854 6.93927 6.09602 6.92188 6.10254L6.9209 6.10449C6.90952 6.11925 6.89436 6.14042 6.86426 6.18262L6.30859 6.96094C6.25045 7.04245 6.17582 7.15257 6.07422 7.24023C5.99357 7.30979 5.9021 7.36646 5.80371 7.40723C5.67989 7.45842 5.54801 7.47592 5.44922 7.49121L5.38574 7.50098C5.29011 7.51579 5.16346 7.53843 5.03418 7.52832C4.93128 7.52017 4.82895 7.4961 4.7334 7.45703C4.61327 7.40776 4.51037 7.32967 4.43164 7.27344L2.19727 5.67773C1.90962 6.39582 1.75 7.17915 1.75 8C1.75 11.4518 4.54822 14.25 8 14.25C11.4518 14.25 14.25 11.4518 14.25 8C14.25 5.2413 12.4623 2.90124 9.98242 2.07227L9.83691 4.24902ZM7.12207 8.18945C7.27526 7.95989 7.58574 7.89776 7.81543 8.05078L10.6025 9.9082C10.7167 9.98443 10.7942 10.1049 10.8174 10.2402C10.8406 10.3756 10.8069 10.5151 10.7246 10.625L9.33203 12.4824C9.23768 12.6082 9.08888 12.6825 8.93164 12.6826H7.07422C6.83589 12.6826 6.63074 12.514 6.58398 12.2803L6.11914 9.95801C6.09321 9.82809 6.1199 9.69327 6.19336 9.58301L7.12207 8.18945ZM7.13965 9.96484L7.48438 11.6826H8.68164L9.60742 10.4463L7.67676 9.15918L7.13965 9.96484ZM8 1.75C5.72993 1.75 3.74217 2.96003 2.64746 4.77051L5.0127 6.45996C5.06466 6.49708 5.09177 6.51562 5.11133 6.52832L5.1123 6.5293H5.11426C5.13745 6.52677 5.16993 6.52251 5.2334 6.5127L5.2959 6.50293C5.3614 6.49279 5.39526 6.48721 5.41895 6.48242L5.41992 6.48145L5.42188 6.48047C5.4368 6.46146 5.45658 6.43391 5.49512 6.37988L6.0498 5.60156C6.09519 5.53793 6.15408 5.45185 6.23047 5.37891C6.29114 5.32101 6.35945 5.27146 6.43262 5.23047C6.52471 5.17891 6.6241 5.14773 6.69824 5.12305L8.60645 4.4873C8.65567 4.47091 8.68058 4.46266 8.69824 4.45605L8.7002 4.45508L8.70117 4.4541C8.71253 4.43905 8.72714 4.41753 8.75684 4.375L8.78613 4.33398C8.81121 4.29807 8.82337 4.27987 8.83203 4.2666V4.26465L8.83301 4.26367C8.83455 4.24789 8.83595 4.22533 8.83887 4.18164L8.99609 1.83008C8.67167 1.77811 8.33907 1.75 8 1.75Z",fill:"#7C7C7C"})],-1),d("defs",null,[d("clipPath",{id:"clip0_11163_86342"},[d("rect",{width:"16",height:"16",fill:"white"})])],-1)])])}const ea=re(Kt,[["render",Yt]]),Ge={__name:"Icon",props:{icon:{type:[String,Object],required:!0}},setup(C){return(t,i)=>{const l=N("FeatherIcon");return e(Ke)(C.icon)?(p(),w("div",ve(me({key:0},t.$attrs)),z(C.icon),17)):typeof C.icon=="string"?(p(),D(l,me({key:1,name:C.icon},t.$attrs),null,16,["name"])):(p(),D(Qe(C.icon),ve(me({key:2},t.$attrs)),null,16))}}},ta={class:"flex flex-col gap-4"},aa={class:"text-p-base text-ink-gray-8"},sa={class:"whitespace-nowrap font-semibold"},na={class:"flex items-center gap-2 rounded-md p-2 ring-1 ring-gray-200"},oa=M({__name:"TicketMergeModal",props:fe({ticket:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:fe(["update"],["update:modelValue"]),setup(C,{emit:t}){const i=C,l=t,f=ke(C,"modelValue");function g(){const k={status_category:["in",["Open","Paused"]],is_merged:0,name:["!=",i.ticket.name]};return i.ticket.customer&&(k.customer=i.ticket.customer),i.ticket.raised_by&&(k.raised_by=["like",`%${i.ticket.raised_by}%`]),k}const n=j(null),r=j(null),v=G({url:"helpdesk.helpdesk.doctype.hd_ticket.api.merge_ticket",makeParams({source:k,target:m}){return{source:k,target:m}},validate({source:k,target:m}){if(!k)throw{message:"Category is required"};if(!m)throw{message:"Ticket to merged with is required"}},onSuccess:()=>{ae.success(B("Ticket merged successfully")),l("update"),f.value=!1,window.open(window.location.origin+"/helpdesk/tickets/"+n.value,"_blank"),n.value=null}}),h=Ye({doctype:"HD Ticket",filters:{name:["=",n]},fields:["subject"],onSuccess:k=>{k.length>0&&(r.value=k[0].subject)}});ie(()=>n.value,k=>{k&&(h.update({filters:{name:["=",k]}}),h.reload())});function x(){v.submit({source:i.ticket.name,target:n.value})}return(k,m)=>{const b=N("FormControl"),y=N("Button");return p(),D(e(et),{options:{title:"Merge with another ticket"},modelValue:f.value,"onUpdate:modelValue":m[2]||(m[2]=o=>f.value=o)},{"body-content":S(()=>[d("div",ta,[d("p",aa,[m[3]||(m[3]=ge(" All comments and emails of the ticket ",-1)),d("span",sa,"#"+z(k.ticket.name),1),m[4]||(m[4]=ge(" will be moved to the selected ticket. ",-1))]),_(e($e),{class:"form-control",doctype:"HD Ticket",placeholder:e(B)("Select Ticket"),filters:g(),label:e(B)("Ticket"),"page-length":10,value:n.value,"show-description":!0,onChange:m[0]||(m[0]=o=>n.value=String(o))},null,8,["placeholder","filters","label","value"]),n.value?(p(),D(b,{key:0,label:e(B)("Ticket Subject"),type:"text",modelValue:r.value,"onUpdate:modelValue":m[1]||(m[1]=o=>r.value=o),disabled:!0},null,8,["label","modelValue"])):F("",!0),d("div",na,[_(e(Bt),{class:"h-6 w-5 w-min-5 w-max-5 min-h-5 max-w-5 text-yellow-500"}),m[5]||(m[5]=d("div",{class:"text-wrap text-sm text-gray-700"}," This action is irreversible. ",-1))])])]),actions:S(()=>[_(y,{class:"w-full",variant:"solid",label:n.value?`Merge with ticket #${n.value} `:"Select Ticket",loading:e(v).loading,"icon-left":n.value&&e(Ze),onClick:x},null,8,["label","loading","icon-left"])]),_:1},8,["modelValue"])}}}),Q=Symbol("ticket"),we=Symbol("assignees"),Te=Symbol("customizations"),Se=Symbol("ticketContact"),Xe=Symbol("recentSimilarTickets"),le=Symbol("activities"),la={key:1,class:"flex items-center justify-center flex-col mt-20"},ia={class:"text-xl font-medium text-ink-gray-5 absolute top-[50%]"},ra=M({__name:"TicketActivityPanel",setup(C){const t=H(Q),i=H(le),l=j(null),f=j(null),g=ue(),{isCallingEnabled:n}=be(g),r=A(()=>{const m=[{name:"activity",label:B("Activity"),icon:xt},{name:"email",label:B("Emails"),icon:ce},{name:"comment",label:B("Comments"),icon:Ct}];return n.value&&m.push({name:"call",label:B("Calls"),icon:Ce}),m}),{tabIndex:v,changeTabTo:h}=$t(r),x=A(()=>{var U,I,Y,V,T,L,O,Z;if(!((U=i.value)!=null&&U.data))return[];const m=(Y=(I=i.value)==null?void 0:I.data)==null?void 0:Y.communications.map((u,q)=>{var Ve,Le,Ae,Be;const J=((Ve=u.user)==null?void 0:Ve.name)||((Le=u.user)==null?void 0:Le.full_name),de=(Ae=u.user)==null?void 0:Ae.email;return{subject:u.subject,content:u.content,sender:{name:J||de,full_name:J||de,email:de,image:(Be=u.user)==null?void 0:Be.image},to:u.recipients,type:"email",key:u.creation,cc:u.cc,bcc:u.bcc,creation:u.communication_date||u.creation,attachments:u.attachments,name:u.name,deliveryStatus:u.delivery_status,isFirstEmail:q===0}}),b=i.value.data.comments.map(u=>({name:u.name,type:"comment",key:u.creation,commentedBy:u.commented_by,commenter:u.user.name,creation:u.creation,content:u.content,attachments:u.attachments})),y=[...i.value.data.history,...i.value.data.views].map(u=>({type:"history",key:u.creation,content:u.action?u.action:"viewed this",creation:u.creation,user:u.user.name+" "})),o=i.value.data.calls.map(u=>({...u,type:"call",name:u.name,key:u.creation,call_type:u.type,content:`${u.caller||"Unknown"} made a call to ${u.receiver||"Unknown"}`,duration:u.duration?u.duration+"s":"0s"})),a=[...m,...b,...y,...o].sort((u,q)=>new Date(u.creation)-new Date(q.creation)),c=[];let s=0;for(;s<a.length;){const u=a[s];if(u.type==="history"){u.relatedActivities=[u];for(let q=s+1;q<a.length+1;q++){const J=a[q];if(J&&J.user===u.user&&J.content!=="viewed this"&&!J.content.includes("assigned")&&!J.content.includes("unassigned"))u.relatedActivities.push(J);else{c.push(u),s=q-1;break}}}else c.push(u);s++}if(t.value.doc.feedback_rating===0)return c;let $=[{type:"feedback",key:"feedback-activity",feedback_rating:(V=t.value)==null?void 0:V.doc.feedback_rating,feedback_extra:(T=t.value)==null?void 0:T.doc.feedback_extra,feedback:(L=t.value)==null?void 0:L.doc.feedback,sender:{name:(O=t.value)==null?void 0:O.doc.raised_by,full_name:(Z=t.value)==null?void 0:Z.doc.contact}}];return c.push(...$),c});function k(m){return m==="activity"?x.value:x.value.filter(b=>b.type===m)}return(m,b)=>{var y,o,a;return p(),w(W,null,[_(e(Vt),{modelValue:e(v),tabs:r.value,"onUpdate:modelValue":e(h)},{default:S(()=>[_(e(wt)),_(e(Tt),{class:"flex-1"},{default:S(({tab:c})=>[e(i).data?(p(),D(St,{key:0,ref_key:"ticketAgentActivitiesRef",ref:l,activities:k(c.name),title:c.label,"ticket-status":e(t).doc.status,"onEmail:reply":b[0]||(b[0]=s=>{f.value.replyToEmail(s)}),onUpdate:b[1]||(b[1]=()=>{e(i).reload(),l.value.scrollToLatestActivity()})},null,8,["activities","title","ticket-status"])):(p(),w("div",la,[_(e(tt),{scale:8,class:"text-ink-gray-5"}),d("p",ia,z(e(B)("Loading...")),1)]))]),_:1})]),_:1},8,["modelValue","tabs","onUpdate:modelValue"]),(p(),D(e(Lt),{ref_key:"communicationAreaRef",ref:f,ticketId:String((y=e(t).doc)==null?void 0:y.name),"to-emails":[(o=e(t).doc)==null?void 0:o.raised_by],"cc-emails":[],"bcc-emails":[],key:(a=e(t).doc)==null?void 0:a.name,onUpdate:b[2]||(b[2]=()=>{e(i).reload(),l.value.scrollToLatestActivity()})},null,8,["ticketId","to-emails"]))],64)}}}),P=j(0),R=G({url:"helpdesk.helpdesk.doctype.hd_ticket.api.get_navigation_tickets",cache:["ticketsToNavigate"]});function ca(){const C=He(),t=ye();function i(){if(P.value<R.data.length-1){P.value+=1;const v=R.data[P.value];return r(v),v}return null}function l(){if(P.value>0){P.value-=1;const v=R.data[P.value];return r(v),v}return null}function f(){return R.data[P.value]}function g(){return R.data&&P.value<R.data.length-1?R.data[P.value+1]:null}function n(){return R.data&&P.value>0?R.data[P.value-1]:null}function r(v){let h=t.query.view,x={name:"TicketAgent",params:{ticketId:v},hash:""};h&&(x.query={view:h}),C.push(x)}return{currentTicketIndex:P,ticketsToNavigate:R,goToNextTicket:i,goToPreviousTicket:l,getCurrentTicket:f,getNextTicket:g,getPreviousTicket:n,navigateToTicket:r}}const ua={class:"flex gap-1"},da=M({__name:"TicketNavigation",setup(C){const{currentTicketIndex:t,goToNextTicket:i,goToPreviousTicket:l,getNextTicket:f,getPreviousTicket:g}=ca();j(null),j(null);const n=A(()=>{var v;return R.loading||!((v=R.data)!=null&&v.length)?!0:t.value==0}),r=A(()=>{var v;return R.loading||!((v=R.data)!=null&&v.length)||R.data.length<=1?!0:t.value>=R.data.length-1});return he(()=>{X({key:">",shift:!0},()=>{r.value||i()}),X({key:"<",shift:!0},()=>{n.value||l()})}),(v,h)=>{const x=N("Button"),k=N("Tooltip");return p(),w("div",ua,[_(k,{text:e(g)()?`Go to previous ticket: #${e(g)()}`:"No previous ticket",disabled:n.value},{default:S(()=>[_(x,{icon:e(at),variant:"ghost",disabled:n.value,onClick:h[0]||(h[0]=m=>e(l)())},null,8,["icon","disabled"])]),_:1},8,["text","disabled"]),_(k,{text:e(f)()?`Go to next ticket: #${e(f)()}`:"No next ticket",disabled:r.value},{default:S(()=>[_(x,{icon:e(st),variant:"ghost",disabled:r.value,onClick:h[1]||(h[1]=m=>e(i)())},null,8,["icon","disabled"])]),_:1},8,["text","disabled"])])}}}),ma={class:"flex items-center mx-5 md:mr-0 text-p-sm gap-3 text-[14px] mb-[13px]"},pa={class:"flex items-center gap-1"},_a={key:0,class:"text-ink-gray-4 flex items-center"},va={class:"text-ink-gray-4 mr-[6px]"},fa={class:""},ga={key:1,class:"text-ink-gray-4 flex items-center"},ka={class:"text-ink-gray-4 mr-[6px]"},ba={class:"font-medium"},ya={class:"flex items-center gap-1"},ha={class:"flex items-center gap-1"},xa=M({__name:"TicketSLA",setup(C){const t=H(Q),i=A(()=>{var g,n;return(n=(g=t.value)==null?void 0:g.get)!=null&&n.loading?{label:"",color:""}:!t.value.doc.first_responded_on&&E().isBefore(E(t.value.doc.response_by))?{label:`Due in ${f(t.value.doc.response_by)}`,color:"orange"}:E(t.value.doc.first_responded_on).isBefore(E(t.value.doc.response_by))?{label:`Fulfilled in ${f(t.value.doc.first_responded_on,t.value.doc.creation)}`,color:"green"}:{label:`Failed by ${f(String(new Date),t.value.doc.response_by)}`,color:"red"}}),l=A(()=>{var g,n,r,v,h,x,k,m,b,y,o,a,c,s;return(n=(g=t.value)==null?void 0:g.get)!=null&&n.loading?{label:"",color:""}:((r=t.value.doc)==null?void 0:r.status_category)==="Paused"&&((v=t.value.doc)!=null&&v.on_hold_since)&&E((h=t.value.doc)==null?void 0:h.resolution_by).isAfter(E((x=t.value.doc)==null?void 0:x.on_hold_since))?{label:"On Hold",color:"blue"}:!((k=t.value.doc)!=null&&k.resolution_date)&&E().isBefore(E((m=t.value.doc)==null?void 0:m.resolution_by))?{label:`Due in ${f((b=t.value.doc)==null?void 0:b.resolution_by)}`,color:"purple"}:E((y=t.value.doc)==null?void 0:y.resolution_date).isBefore(E((o=t.value.doc)==null?void 0:o.resolution_by))?{label:`Fulfilled in ${f((a=t.value.doc)==null?void 0:a.resolution_date,(c=t.value.doc)==null?void 0:c.creation)}`,color:"green"}:{label:`Failed by ${f(String(new Date),(s=t.value.doc)==null?void 0:s.resolution_by)}`,color:"red"}});function f(g,n){n||(n=E().toString());let r=E(g),v=E.duration(r.diff(E(n))),h=v.days(),x=v.hours(),k=v.minutes();return h>0?`${h}d ${x}h`:x>0?`${x}h ${k}m`:`${k}m`}return X({meta:!0,shift:!0,key:"."},()=>{ne(window.location.href,"Ticket URL copied to clipboard")}),X({meta:!0,key:"."},()=>{ne(t.value.doc.name,`Ticket #${t.value.doc.name} copied to clipboard`)}),(g,n)=>{const r=ce,v=ea;return p(),D(nt,{to:"#app-header"},[d("div",ma,[d("div",pa,[d("p",{onClick:n[0]||(n[0]=h=>e(ne)(e(t).doc.name,`Ticket #${e(t).doc.name} copied to clipboard`)),class:"cursor-copy"}," #"+z(e(t).doc.name),1),e(t).doc.via_customer_portal?(p(),w("div",ga,[d("span",ka,z(e(B)("via")),1),_(v,{class:"size-4 inline-block mr-1"}),d("span",ba,z(e(B)("Portal")),1)])):(p(),w("div",_a,[d("span",va,z(e(B)("via")),1),_(r,{class:"size-4 inline-block mr-1"}),d("span",fa,z(e(B)("Email")),1)]))]),n[1]||(n[1]=d("div",{class:"border-l border-outline-gray-2 h-[13px]"},null,-1)),d("div",ya,[d("span",null,z(e(B)("First Response")),1),_(ze,{label:i.value.label,variant:"subtle",theme:i.value.color},null,8,["label","theme"])]),n[2]||(n[2]=d("div",{class:"border-l border-outline-gray-2 h-[13px]"},null,-1)),d("div",ha,[d("span",null,z(e(B)("Resolution")),1),l.value?(p(),D(ze,{key:0,label:l.value.label,variant:"subtle",theme:l.value.color!=="purple"&&l.value.color,class:te(l.value.color==="purple"&&"!text-[#6B46C1] !bg-[#F3E8FF]")},null,8,["label","theme","class"])):F("",!0)])])])}}}),Ca={class:"flex flex-col flex-1 gap-3"},$a=M({__name:"TicketSubjectModal",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(C){var n,r;const t=H(Q),i=ke(C,"modelValue"),l=j(((r=(n=t.value)==null?void 0:n.doc)==null?void 0:r.subject)||""),f=j(!1);function g(){f.value=!0,t.value.setValue.submit({subject:l.value},{onSuccess(){f.value=!1,i.value=!1}})}return(v,h)=>{const x=N("FormControl"),k=N("Button"),m=N("Dialog");return p(),D(m,{modelValue:i.value,"onUpdate:modelValue":h[1]||(h[1]=b=>i.value=b),options:{title:"Rename Subject"}},{"body-content":S(()=>[d("div",Ca,[_(x,{modelValue:l.value,"onUpdate:modelValue":h[0]||(h[0]=b=>l.value=b),type:"textarea",size:"sm",variant:"subtle",disabled:!1},null,8,["modelValue"]),_(k,{variant:"solid",loading:f.value,label:e(B)("Rename"),onClick:g},null,8,["loading","label"])])]),_:1},8,["modelValue"])}}}),wa={class:"flex flex-col truncate"},Ta={class:"flex gap-2 items-center"},Sa={key:0,class:"flex gap-2"},Va={key:1},La=M({__name:"TicketHeader",props:{viewers:{type:Array,required:!0}},setup(C){var Y;const t=ye(),i=He(),{findView:l}=zt("HD Ticket"),f=Me(),g=H(Q),n=H(Te),r=H(le),v=j(!1),{notifyTicketUpdate:h}=Pe((Y=g.value)==null?void 0:Y.name),x=A(()=>{var T;return(((T=f.statuses.data)==null?void 0:T.filter(L=>L.enabled))||[]).map(L=>({label:L.label_agent,value:L.label_agent,onClick:()=>{h("Status",L.label_agent),g.value.doc.status!==L.label_agent&&g.value.setValue.submit({status:L.label_agent},{onSuccess(){r.value.reload()}})},icon:()=>ot(Ue,{class:L.parsed_color})}))}),k=A(()=>{var T,L,O,Z;let V=[{label:B("Tickets"),route:{name:"TicketsAgent"}}];if(t.query.view){const u=l(t.query.view);u&&V.push({label:(T=u.value)==null?void 0:T.label,icon:lt((L=u.value)==null?void 0:L.icon),route:{name:"TicketsAgent",query:{view:(O=u.value)==null?void 0:O.name}}})}return V.push({label:(Z=g.value.doc)==null?void 0:Z.subject,onClick:()=>{v.value=!0}}),V});function m(V,T,L=()=>{}){g.value.setValue.submit({[V]:T}),L()}const b=j(!1),y=A(()=>!g.value.doc.is_merged&&["Open","Paused"].includes(g.value.doc.status_category)),o=A(()=>{let V=[];return y.value&&V.push({label:B("Merge Ticket"),icon:Ze,condition:()=>!g.value.doc.is_merged,onClick:()=>b.value=!0}),[{group:"Default actions",hideLabel:!0,items:V}]}),a=j([]),c=A(()=>a.value.filter(V=>!V.group)),s=A(()=>{let V=[];return a.value.filter(T=>T.buttonLabel&&T.group).forEach(T=>{let L=V.findIndex(O=>O.label===T.buttonLabel);L>-1?V[L].action.push(T):V.push({label:T.buttonLabel,action:[T]})}),V}),$=A(()=>{let V=[];return V=V.concat(a.value.filter(T=>T.group&&!T.buttonLabel)),V}),U=A(()=>{var V;return{doc:(V=g==null?void 0:g.value)==null?void 0:V.doc,call:Ie,router:i,toast:ae,$dialog:We().$dialog,updateField:m,createToast:ae.create}});it(async()=>{var V,T,L;(V=n.value)!=null&&V.data&&(await It(n.value.data,U.value),a.value=[...o.value,...((L=(T=n.value)==null?void 0:T.data)==null?void 0:L._customActions)||[]])});const I=xe("statusRef");return he(()=>{X("s",()=>{var V,T,L;(L=(T=(V=I.value)==null?void 0:V.$el)==null?void 0:T.nextElementSibling)==null||L.click()})}),(V,T)=>{const L=Ge,O=N("FeatherIcon"),Z=N("Button");return p(),w(W,null,[_(Rt,null,{"left-header":S(()=>[d("div",wa,[_(e(Ht),{items:k.value,class:"breadcrumbs"},{prefix:S(({item:u})=>[u.icon?(p(),D(L,{key:0,icon:u.icon,class:"mr-1 h-4 flex items-center justify-center self-center"},null,8,["icon"])):F("",!0)]),_:1},8,["items"]),_(xa)])]),"right-header":S(()=>[d("div",Ta,[_(e(Oe),{avatars:JSON.stringify(C.viewers),size:"md","hide-name":!0},null,8,["avatars"]),(p(),D(da,{key:e(g).name})),c.value.length?(p(),w("div",Sa,[(p(!0),w(W,null,K(c.value,u=>(p(),D(Z,{key:u.label,label:u.label,onClick:q=>u.onClick()},rt({_:2},[u.icon?{name:"prefix",fn:S(()=>[_(O,{name:u.icon,class:"h-4 w-4"},null,8,["name"])]),key:"0"}:void 0]),1032,["label","onClick"]))),128))])):F("",!0),s.value.length?(p(),w("div",Va,[(p(!0),w(W,null,K(s.value,u=>(p(),w("div",{key:u.label},[_(e(pe),{options:u.action},{default:S(({open:q})=>[_(Z,{label:u.label},{suffix:S(()=>[_(O,{name:q?"chevron-up":"chevron-down",class:"h-4"},null,8,["name"])]),_:2},1032,["label"])]),_:2},1032,["options"])]))),128))])):F("",!0),_(e(pe),{options:x.value,placement:"right"},{default:S(({open:u})=>[_(Z,{label:e(g).doc.status,ref_key:"statusRef",ref:I},{prefix:S(()=>{var q;return[_(e(Ue),{class:te((q=e(f).getStatus(e(g).doc.status))==null?void 0:q.parsed_color)},null,8,["class"])]}),_:1},8,["label"])]),_:1},8,["options"]),$.value.length?(p(),D(e(pe),{key:2,options:$.value,placement:"right"},{default:S(()=>[_(Z,{icon:"more-horizontal"})]),_:1},8,["options"])):F("",!0)])]),_:1}),b.value?(p(),D(oa,{key:0,ticket:e(g).doc,modelValue:b.value,"onUpdate:modelValue":T[0]||(T[0]=u=>b.value=u),onUpdate:T[1]||(T[1]=u=>e(g).reload())},null,8,["ticket","modelValue"])):F("",!0),v.value?(p(),D($a,{key:1,modelValue:v.value,"onUpdate:modelValue":T[2]||(T[2]=u=>v.value=u)},null,8,["modelValue"])):F("",!0)],64)}}});const Aa={__name:"Resizer",props:{defaultWidth:{type:Number,default:352},minWidth:{type:Number,default:16*16},maxWidth:{type:Number,default:30*16},side:{type:String,default:"left"},parent:{type:Object,default:null}},setup(C){const t=C,i=j(!1),l=j(t.defaultWidth);function f(){document.addEventListener("mousemove",g),document.addEventListener("mouseup",()=>{document.body.classList.remove("select-none"),document.body.classList.remove("cursor-col-resize"),document.querySelectorAll(".select-text1").forEach(r=>{r.classList.remove("select-text1"),r.classList.add("select-text")}),localStorage.setItem("sidebarWidth",l.value),i.value=!1,document.removeEventListener("mousemove",g)})}function g(r){i.value=!0,document.body.classList.add("select-none"),document.body.classList.add("cursor-col-resize"),document.querySelectorAll(".select-text").forEach(x=>{x.classList.remove("select-text"),x.classList.add("select-text1")}),l.value=t.side=="left"?r.clientX:window.innerWidth-r.clientX;let v=t.parent?n():0;l.value=l.value-v;let h=[t.defaultWidth-10,t.defaultWidth+10];l.value>h[0]&&l.value<h[1]&&(l.value=t.defaultWidth),l.value<t.minWidth&&(l.value=t.minWidth),l.value>t.maxWidth&&(l.value=t.maxWidth)}function n(){return t.parent?t.parent.getBoundingClientRect()[t.side]:0}return(r,v)=>(p(),w("div",{class:"relative",style:dt({width:`${l.value}px`})},[ct(r.$slots,"default",ve(ut({sidebarResizing:i.value,sidebarWidth:l.value}))),d("div",{class:te(["absolute z-1 h-full w-1 cursor-col-resize bg-surface-gray-4 opacity-0 transition-opacity hover:opacity-100",{"opacity-100":i.value,"left-0":C.side=="right","right-0":C.side=="left"}]),onMousedown:f},null,34)],4))}},Ba={key:0},za={class:"flex gap-3 items-center px-5 py-2.5"},Da={class:"text-ink-gray-8 font-medium text-xl max-w-full truncate"},Ua={class:"px-5 text-ink-gray-5 pb-2"},ja={class:"flex gap-2 items-center p-1.5"},Fa={class:"text-p-sm text-ink-gray-6 hover:underline cursor-pointer"},Ra={key:0,class:"flex gap-2 items-center p-1.5"},Ha={class:"text-p-sm text-ink-gray-6 hover:underline cursor-pointer"},Ia={class:"px-5 border-t pb-2.5"},qa={class:"flex gap-2.5 items-center py-[13px] justify-between"},Ea=["onClick"],Na=["onClick"],Pa={class:"text-base text-ink-gray-8 max-w-[60%] truncate"},Wa={class:"flex items-end justify-between"},Ma={class:"text-base text-ink-gray-5"},Oa={class:"transition duration-400 hover:underline"},Za=M({__name:"TicketContactTab",setup(C){const t=ue(),{isCallingEnabled:i}=be(t),l=H(Se),f=H(Xe),g=window.date_format,{getStatus:n,colorMap:r}=Me();function v(m){let{color:b}=n(m);return r[b]?r[b]:r.Default}const h=A(()=>{var o,a,c,s;if(f.value.loading||!f.value.data)return[];const m=((a=(o=f.value)==null?void 0:o.data)==null?void 0:a.recent_tickets)||[],b=((s=(c=f.value)==null?void 0:c.data)==null?void 0:s.similar_tickets)||[],y=[];return m.length&&y.push({label:B("Recent Tickets"),tooltipMessage:"Tickets recently raised by this contact/customer",hideLabel:!1,opened:!0,tickets:m}),b.length&&y.push({label:B("Similar Tickets"),tooltipMessage:"Tickets with similar queries",hideLabel:!1,opened:!0,tickets:b}),y});function x(m){return mt(m).format(g.toUpperCase())}function k(m){let b=window.location.origin+"/helpdesk/tickets/"+m;window.open(b,"_blank")}return(m,b)=>{const y=qe;return p(),w("div",null,[e(l).loading?F("",!0):(p(),w("div",Ba,[d("div",za,[_(e(Je),{label:e(l).data.name,image:e(l).data.image,size:"2xl"},null,8,["label","image"]),d("p",Da,z(e(l).data.name),1)]),d("div",Ua,[d("div",ja,[_(ce,{class:"size-4"}),d("p",Fa,z(e(l).data.email_id),1),_(e(Re),{class:"size-4 cursor-pointer",onClick:b[0]||(b[0]=o=>e(ne)(e(l).data.email_id,`'${e(l).data.email_id}' copied to clipboard`))})]),e(i)&&(e(l).data.mobile_no||e(l).data.phone)?(p(),w("div",Ra,[_(Ce,{class:"size-4"}),d("p",Ha,z(e(l).data.mobile_no||e(l).data.phone),1),e(l).data.mobile_no||e(l).data.phone?(p(),D(e(Re),{key:0,class:"size-4 cursor-pointer",onClick:b[1]||(b[1]=o=>e(ne)(e(l).data.mobile_no||e(l).data.phone,`'${e(l).data.mobile_no||e(l).data.phone}' copied to clipboard`))})):F("",!0)])):F("",!0)])])),e(f).loading?F("",!0):(p(!0),w(W,{key:1},K(h.value,o=>(p(),w("div",Ia,[(p(),D(Et,{key:o.label,label:o.label,hideLabel:o.hideLabel,opened:o.opened},{header:S(({opened:a,hide:c,toggle:s})=>[d("div",qa,[_(e(oe),{text:o.tooltipMessage},{default:S(()=>[d("span",{class:"text-ink-gray-8 font-medium text-base cursor-pointer select-none",onClick:s},z(o.label),9,Ea)]),_:2},1032,["text"]),_(y,{class:te(["size-4 text-ink-gray-6 cursor-pointer",{"rotate-180":a}]),onClick:s},null,8,["class","onClick"])])]),default:S(()=>[d("ul",null,[(p(!0),w(W,null,K(o.tickets,a=>(p(),w("li",{key:a.name,class:"py-2.5 cursor-pointer",onClick:c=>k(a.name)},[d("p",Pa,z(a.subject),1),d("div",Wa,[d("p",Ma,[ge(z(x(a.creation)+" Â· ")+" ",1),d("span",Oa,z("#"+a.name),1)]),d("p",{class:te(["px-1.5 py-[3px] text-sm rounded-sm max-w-[80px] text-center truncate h-5",v(a.status)])},z(a.status),3)])],8,Na))),128))])]),_:2},1032,["label","hideLabel","opened"]))]))),256))])}}}),Ja={class:"flex flex-col gap-2 my-2 w-[470px] rounded-lg bg-surface-modal shadow-2xl ring-1 ring-black p-3 ring-opacity-5 focus:outline-none"},Ga={class:"text-base text-ink-gray-5"},Xa=["onClick"],Ka={class:"ml-1"},Qa={class:"cursor-pointer text-ink-gray-9"},Ya={class:"flex items-center justify-between gap-2"},es={__name:"AssignToBody",props:fe({doctype:{type:String,default:""},docname:{type:String,default:null},open:{type:Boolean,default:!1},onUpdate:{type:Function,default:null}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(C){const t=C,i=ke(C,"modelValue"),l=j([]),f=j(!1),g=j(""),{users:n,getUser:r}=Ee(),v=y=>{y===r("").name&&(f.value=!1),i.value=i.value.filter(o=>o.name!==y)},h=y=>{if(!y)return;y===r("").name&&(f.value=!0),g.value="";let o={name:y,image:r(y).user_image,label:r(y).full_name};i.value.find(a=>a.name===y)||i.value.push(o)};ie(f,y=>{let o=r("");y?h(o.name):v(o.name)}),ie(()=>t.open,y=>{y?(l.value=[...i.value||[]],f.value=i.value.some(o=>o.name===r("").name)):x()},{immediate:!0});async function x(){const y=i.value.map(s=>s.name),o=l.value.map(s=>s.name);if(JSON.stringify(o)===JSON.stringify(y))return;const a=l.value.filter(s=>!i.value.find($=>$.name===s.name)).map(s=>s.name),c=i.value.filter(s=>!l.value.find($=>$.name===s.name)).map(s=>s.name);if(c.length||a.length){let s=`${c.length?`assigned ${c.join(", ")}`:""} ${c.length&&a.length?" & ":""} ${a.length?`unassigned ${a.join(", ")}`:""}`;Ie("frappe.client.insert",{doc:{doctype:"HD Ticket Activity",ticket:t.docname,action:s}})}t.onUpdate?t.onUpdate(c,a,k,m):(a.length&&await m.submit(a),c.length&&await k.submit(c))}const k=G({url:"frappe.desk.form.assign_to.add",makeParams:y=>({doctype:t.doctype,name:t.docname,assign_to:y}),onSuccess:()=>{pt("assign_to",{doctype:t.doctype})}}),m=G({url:"helpdesk.api.doc.remove_assignments",makeParams:y=>({doctype:t.doctype,name:t.docname,assignees:y})}),b=xe("input");return _t(()=>{b.value.click()}),(y,o)=>{const a=N("FeatherIcon"),c=N("Button");return p(),w("div",Ja,[d("div",Ga,z(e(B)("Assign to")),1),_($e,{class:"form-control",value:"",doctype:"HD Agent",onChange:o[2]||(o[2]=s=>h(s)&&(y.$refs.input.value="")),placeholder:e(B)("John Doe"),filters:{is_active:!0,name:["not in",i.value.map(s=>s.name)]},hideMe:!0},{target:S(({togglePopover:s})=>[d("div",{class:"w-full min-h-12 flex flex-wrap items-center gap-1.5 p-1.5 pb-5 rounded-lg bg-surface-gray-2 cursor-text",onClick:se(s,["stop"]),ref:"input"},[(p(!0),w(W,null,K(i.value,$=>(p(),D(e(oe),{text:$.name,key:$.name,onClick:o[1]||(o[1]=se(()=>{},["stop"]))},{default:S(()=>[d("div",{class:"flex items-center text-sm p-0.5 text-ink-gray-6 border border-outline-gray-1 bg-surface-modal rounded-full cursor-pointer",onClick:o[0]||(o[0]=se(()=>{},["stop"]))},[_(Fe,{name:$.name,size:"sm"},null,8,["name"]),d("div",Ka,z(e(r)($.name).full_name),1),_(c,{variant:"ghost",class:"rounded-full !size-4 m-1",onClick:se(U=>v($.name),["stop"])},{icon:S(()=>[_(a,{name:"x",class:"h-3 w-3 text-ink-gray-6"})]),_:1},8,["onClick"])])]),_:2},1032,["text"]))),128))],8,Xa)]),"item-prefix":S(({option:s})=>[_(Fe,{class:"mr-2",name:s.value,size:"sm"},null,8,["name"])]),"item-label":S(({option:s})=>[_(e(oe),{text:s.value},{default:S(()=>[d("div",Qa,z(e(r)(s.value).full_name),1)]),_:2},1032,["text"])]),_:1},8,["placeholder","filters"]),d("div",Ya,[d("div",{class:"text-base text-ink-gray-5 cursor-pointer select-none",onClick:o[3]||(o[3]=s=>f.value=!f.value)},z(e(B)("Assign to me")),1),_(e(Nt),{modelValue:f.value,"onUpdate:modelValue":o[4]||(o[4]=s=>f.value=s),onClick:o[5]||(o[5]=se(()=>{},["stop"]))},null,8,["modelValue"])])])}}},ts={class:"flex flex-col gap-1.5 w-full"},as={class:"block text-xs text-gray-600"},ss={key:0},ns={key:1,class:"flex gap-1.5 items-center"},os={key:0,class:"ml-2 text-sm text-ink-gray-8"},ls=M({__name:"AssignTo",setup(C){const t=H(Q),i=H(we),l=H(le);async function f(n,r,v,h){r.length&&await h.submit(r),n.length&&await v.submit(n),l.value.reload()}const g=xe("assigneeButton");return X("a",()=>{var n,r,v;(v=(r=(n=g.value)==null?void 0:n.$el)==null?void 0:r.nextElementSibling)==null||v.click()}),(n,r)=>{const v=Ge,h=N("Button");return p(),D(e(ft),{class:"flex w-full",placement:"bottom-end"},{target:S(({open:x,close:k,togglePopover:m})=>[d("div",ts,[d("span",as,z(e(B)("Assignee")),1),_(h,{variant:"outline",class:"!flex !justify-start w-full active:!bg-inherit hover:shadow-sm",ref:"assigneeButton",onClick:b=>m()},{suffix:S(()=>[_(v,{icon:e(qe),class:"h-4 w-4 ml-auto text-ink-gray-5"},null,8,["icon"])]),default:S(()=>{var b,y,o,a;return[e(i).loading||((b=e(i).data)==null?void 0:b.length)===0?(p(),w("p",ss,z(e(B)("No assignees")),1)):((y=e(i).data)==null?void 0:y.length)>=1?(p(),w("div",ns,[_(Oe,{avatars:e(i).data.map(c=>c.name),size:"sm"},null,8,["avatars"]),((o=e(i).data)==null?void 0:o.length)>1?(p(),w("p",os,z((a=e(i).data)==null?void 0:a.length)+" assignees ",1)):F("",!0)])):F("",!0)]}),_:1},8,["onClick"])])]),body:S(({isOpen:x})=>[vt(_(es,{modelValue:e(i).data,"onUpdate:modelValue":r[0]||(r[0]=k=>e(i).data=k),doctype:"HD Ticket",docname:e(t).name,open:x,onUpdate:f},null,8,["modelValue","docname","open"]),[[gt,x]])]),_:1})}}}),is={key:0,class:"my-4 flex items-center justify-start gap-5"},rs={class:"flex flex-col gap-1.5"},cs={class:"flex gap-2.5 items-center"},us={class:"text-ink-gray-8 font-medium text-xl max-w-[170px] truncate"},ds={class:"flex gap-1.5"},ms=M({__name:"TicketContact",setup(C){const t=ue(),{getUser:i}=Ee(),{isCallingEnabled:l}=be(t),f=j(!1),g=H(Q),n=H(Se),r=A(()=>{var x,k,m,b,y;return((k=(x=n.value)==null?void 0:x.data)==null?void 0:k.image)||((y=i((b=(m=n.value)==null?void 0:m.data)==null?void 0:b.email_id))==null?void 0:y.user_image)||null});function v(x){let k=window.location.origin+"/app/contact/"+x;window.open(k,"_blank")}const h=()=>{if(!n.value.data.mobile_no&&!n.value.data.phone){f.value=!0;return}t.makeCall({number:n.value.data.mobile_no||n.value.data.phone,doctype:"HD Ticket",docname:g.value.name})};return(x,k)=>e(n).loading?F("",!0):(p(),w("div",is,[_(e(Je),{label:e(n).data.name,image:r.value,size:"2xl"},null,8,["label","image"]),d("div",rs,[_(e(oe),{text:e(n).data.name||e(n).data.email_id},{default:S(()=>[d("div",cs,[d("p",us,z(e(n).data.name||e(n).data.email_id),1),_(e(Xt),{class:"size-4 text-ink-gray-6 cursor-pointer",onClick:k[0]||(k[0]=m=>v(e(n).data.name))})])]),_:1},8,["text"]),d("div",ds,[_(e(oe),{text:e(n).data.email_id},{default:S(()=>[_(e(De),{size:"sm",onClick:k[1]||(k[1]=m=>e(Dt)())},{icon:S(()=>[_(ce,{class:"size-4"})]),_:1}),e(l)?(p(),D(e(De),{key:0,size:"sm",onClick:h},{icon:S(()=>[_(Ce,{class:"size-4"})]),_:1})):F("",!0)]),_:1},8,["text"])])]),_(Ne,{modelValue:f.value,"onUpdate:modelValue":k[2]||(k[2]=m=>f.value=m),name:e(n).data.name,onOnUpdate:e(n).reload},null,8,["modelValue","name","onOnUpdate"])]))}}),ps={class:"h-full overflow-y-hidden flex flex-1 flex-col justify-between overflow-hidden max-h-full"},_s={class:"px-5 pb-4 flex flex-col"},vs={class:"border-t flex flex-col flex-1 h-full pb-3 overflow-y-hidden"},fs={class:"overflow-y-scroll max-h-[80%]"},gs=M({__name:"TicketDetailsTab",setup(C){var y;const t=H(Q),i=H(we),l=H(Te),f=H(le),{getFields:g,getField:n}=kt("HD Ticket"),{notifyTicketUpdate:r}=Pe((y=t.value)==null?void 0:y.name),v=A(()=>{const o=g();if(!o||o.length===0)return[];const a=[{group:!0,fields:[n("ticket_type"),n("priority")]},{group:!1,fields:[n("customer")]},{group:!0,fields:[n("agent_group")]}];return a.forEach(c=>{c.fields=c.fields.map(s=>(s=je(s,t.value.doc),s.required=s.reqd,s.ref=s.fieldname,s=x(s,s),s.visible=!0,s))}),a}),h=A(()=>{var $;const o=g();if(!o||o.length===0)return[];if(!l.value.data||l.value.loading)return[];let a=(($=l.value.data)==null?void 0:$.custom_fields)||[];const c=["ticket_type","priority","customer","agent_group","subject","status"];return a=a.filter(U=>!c.includes(U.fieldname)),a.map(U=>{let I=n(U.fieldname);return I=je(I,t.value.doc),I.required=I.reqd||U.required,x(U,I)})});function x(o,a){return{label:(a==null?void 0:a.label)||o.fieldname,value:t.value.doc[o.fieldname],fieldtype:a==null?void 0:a.fieldtype,doctype:(a==null?void 0:a.options)||"",options:(a==null?void 0:a.options)||"",placeholder:o.placeholder||`Enter ${(a==null?void 0:a.label)||o.fieldname}`,readonly:!!a.read_only,disabled:!!a.read_only,url_method:o.url_method||"",fieldname:o.fieldname,required:o.required||(a==null?void 0:a.required)||!1,visible:a.display_via_depends_on&&!a.hidden}}function k(o,a,c=!1){var s;if(t.value.doc[o]!=a){if(c){const $=((s=n(o))==null?void 0:s.label)||o;r($,a)}t.value.setValue.submit({[o]:a},{onSuccess:()=>{o==="agent_group"&&i.value.reload(),f.value.reload()}})}}const m=j({}),b=(o,a)=>{a&&(m.value[o]=a)};return X("t",()=>{var o,a,c,s;(s=(c=(a=(o=m.value)==null?void 0:o.ticket_type)==null?void 0:a.$el)==null?void 0:c.querySelector("button"))==null||s.click()}),X("p",()=>{var o,a,c,s;(s=(c=(a=(o=m.value)==null?void 0:o.priority)==null?void 0:a.$el)==null?void 0:c.querySelector("button"))==null||s.click()}),X({key:"t",shift:!0},()=>{var o,a,c,s;(s=(c=(a=(o=m.value)==null?void 0:o.agent_group)==null?void 0:a.$el)==null?void 0:c.querySelector("button"))==null||s.click()}),(o,a)=>(p(),w("div",ps,[d("div",_s,[_(ms),d("div",null,[(p(!0),w(W,null,K(v.value,(c,s)=>(p(),w("div",{key:s,class:te(c.group?"flex gap-2 items-center w-full mb-3":"mb-3")},[(p(!0),w(W,null,K(c.fields,$=>(p(),w(W,null,[$.visible?(p(),D(e($e),{key:$.fieldname,ref_for:!0,ref:U=>b($.fieldname,U),class:te(["form-control-core",c.group?"flex-1":"w-full"]),id:$.fieldname,"page-length":10,label:$.label,placeholder:$.placeholder,doctype:$.doctype,modelValue:$.value,required:$.required,"onUpdate:modelValue":U=>k($.fieldname,U,!0)},null,8,["id","class","label","placeholder","doctype","modelValue","required","onUpdate:modelValue"])):F("",!0)],64))),256))],2))),128)),_(ls)])]),d("div",vs,[d("div",fs,[(p(!0),w(W,null,K(h.value,c=>(p(),w(W,null,[c.visible?(p(),D(At,{key:c.fieldname,field:c,value:c.value,onChange:a[0]||(a[0]=({fieldname:s,value:$})=>k(s,$))},null,8,["field","value"])):F("",!0)],64))),256))])])]))}});const ks=re(gs,[["__scopeId","data-v-419c42cd"]]),bs={class:"flex-1 max-h-full"},ys=M({__name:"TicketSidebar",setup(C){const t=j("details"),i=[{label:B("Details"),value:"details"},{label:B("Contact"),value:"contact"}];return(l,f)=>(p(),D(Aa,{class:"flex flex-col justify-between border-l",side:"right"},{default:S(()=>[_(e(qt),{buttons:i,modelValue:t.value,"onUpdate:modelValue":f[0]||(f[0]=g=>t.value=g),class:"tab-buttons mb-1 px-5 mt-3.5"},null,8,["modelValue"]),d("div",bs,[t.value==="details"?(p(),D(ks,{key:0})):(p(),D(Za,{key:1}))])]),_:1}))}});const _e=bt({}),hs=C=>{let t=!1;return _e[C]||(_e[C]={ticket:yt({doctype:"HD Ticket",name:C,whitelistedMethods:{markSeen:"mark_seen"},setValue:{onSuccess:()=>{ae.success(__("Ticket updated")),t=!1},onError:i=>{if(t)return;t=!0;const l=i.exc_type?(i.messages||i.message||[]).join(", "):i.message;ae.error(l)}}}),assignees:G({url:"helpdesk.helpdesk.doctype.hd_ticket.api.get_ticket_assignees",params:{ticket:C},auto:!0,transform:i=>JSON.parse(i).map(l=>({name:l}))}),contact:G({url:"helpdesk.helpdesk.doctype.hd_ticket.api.get_ticket_contact",params:{ticket:C},auto:!0}),recentSimilarTickets:G({url:"helpdesk.helpdesk.doctype.hd_ticket.api.get_recent_similar_tickets",params:{ticket:C},auto:!0}),activities:G({url:"helpdesk.helpdesk.doctype.hd_ticket.api.get_ticket_activities",params:{ticket:C},auto:!0})}),_e[C]},xs={key:0,class:"flex-1"},Cs={class:"h-full flex overflow-hidden"},$s={class:"flex-1 flex flex-col overflow-hidden"},sn=M({__name:"TicketAgent",props:{ticketId:{type:String,required:!0}},setup(C){const t=ue(),{$socket:i}=We(),l=C,f=ye(),g=j(!1),n=A(()=>hs(l.ticketId)),r=A(()=>n.value.ticket),v=()=>{r.value.reload(),n.value.activities.reload()},h=G({url:"helpdesk.helpdesk.doctype.hd_ticket.api.get_ticket_customizations",cache:["HD Ticket","customizations"],auto:!0});ee(Q,r),ee(we,A(()=>n.value.assignees)),ee(Se,A(()=>n.value.contact)),ee(Te,A(()=>h)),ee(Xe,A(()=>n.value.recentSimilarTickets)),ee(le,A(()=>n.value.activities)),ee("makeCall",()=>{var c,s,$,U;if(!((c=n.value.contact.data)!=null&&c.mobile_no)&&!((s=n.value.contact.data)!=null&&s.phone)){g.value=!0;return}t.makeCall({number:(($=n.value.contact.data)==null?void 0:$.phone)||((U=n.value.contact.data)==null?void 0:U.mobile_no),doctype:"HD Ticket",docname:l.ticketId})});const x=A(()=>Ut(r.value.name)),k=A(()=>x.value.currentViewers[l.ticketId]||[]),{startViewing:m,stopViewing:b}=x.value;ie(()=>f.params.ticketId,(c,s)=>{c!==s&&(s&&b(s),m(c))},{immediate:!0});const y=c=>{var s;String(c)===String((s=r.value)==null?void 0:s.name)&&v()},o=c=>{var s;String(c.ticket_id)===String((s=r.value)==null?void 0:s.name)&&(ae.info(`User ${c.user} updated ${c.field} to ${c.value}`),v())},a=c=>{var s;String(c.ticket)===String((s=r.value)==null?void 0:s.name)&&v()};return he(()=>{R.update({params:{ticket:l.ticketId,current_view:f.query.view}}),R.reload(),r.value.markSeen.reload(),i.on("ticket_update",o),i.on("helpdesk:ticket-update",y),i.on("helpdesk:ticket-communication",a)}),ht(()=>{b(l.ticketId),jt.value=!1,Ft.value=!1,i.off("ticket_update",o),i.off("helpdesk:ticket-update",y),i.off("helpdesk:ticket-communication",a)}),Pt(()=>({title:l.ticketId})),(c,s)=>{var $,U,I;return($=r.value.doc)!=null&&$.name?(p(),w("div",xs,[_(La,{viewers:k.value},null,8,["viewers"]),d("div",Cs,[d("div",$s,[_(ra)]),_(ys)]),_(Ne,{modelValue:g.value,"onUpdate:modelValue":s[0]||(s[0]=Y=>g.value=Y),name:(I=(U=r.value.data)==null?void 0:U.contact)==null?void 0:I.name,onOnUpdate:r.value.reload},null,8,["modelValue","name","onOnUpdate"])])):F("",!0)}}});export{sn as default};
//# sourceMappingURL=TicketAgent-d449b19c.js.map
